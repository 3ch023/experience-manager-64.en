<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="Preventing CSRF attacks" name="jcr:title" /> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="2016-02-05T03:27:00.000-0500" name="topicBrowsingSortDate" /> 
  <meta content="false" name="isReadyForLocalization" /> 
  <meta content="Activate" name="cq:lastReplicationAction" /> 
  <meta content="2016-05-31T07:02:31.268-0400" name="acrolinxDate" /> 
  <meta content="http://checkstyle.corp.adobe.com:8031/output/en/preventing_csrf_attacks_admin_5e12de0b318c6865_2352_report.xml" name="acrolinxReportURL" /> 
  <meta content="not_checked" name="acrolinxStatus" /> 
  <meta content="admin" name="contentOwner" /> 
  <meta content="AEMForms/6.1/AdminHelp/WS83e2a195e488af795a3f001a12fb77e5bcd-8000.2,AEMForms/6.1/AdminHelp/WS83e2a195e488af796a55b9b12fc153ac7b-8000.2,AEMForms/6.1/AdminHelp/WS83e2a195e488af796a55b9b12fc153ac7b-7fff.2,AEMForms/6.1/AdminHelp/WS83e2a195e488af796a55b9b12fc153ac7b-7ffe.2,AEMForms/6.1/AdminHelp/WS83e2a195e488af796a55b9b12fc153ac7b-7ffd.2" name="cq:gepId" /> 
  <meta content="a8d5970e-2661-4aa8-ba2f-58a4e6825eb4" name="jcr:uuid" /> 
  <meta content="https://helpx.adobe.com/experience-manager/6-3/forms/using/admin-help/preventing-csrf-attacks.html" name="publishExternalURL" /> 
  <meta content="red" name="acrolinxPageStatus" /> 
  <meta content="carlino" name="cq:lastReplicatedBy" /> 
  <meta content="content_type:reference;geptopics:SG_AEMFORMS/categories/configuring_user_management;products:SG_EXPERIENCEMANAGER/6.4/FORMS" name="cq:tags" /> 
  <meta content="2017-10-31T16:32:02.497-0400" name="lastPublishExternalDate" /> 
  <meta content="false" name="doNotLocalize" /> 
  <meta content="true" name="jcr:isCheckedOut" /> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
  <meta content="Learn how to prevent Cross-site request forgery (CSRF) attacks and safeguard user data from being compromised." name="seoDescription" /> 
  <meta content="2017-10-31T16:32:02.497-0400" name="publishExternalDate" /> 
  <meta content="2016-02-05T03:27:00.000-0500" name="sortDate" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/FORMS" name="primaryProductTag" /> 
  <meta content="" name="jcr:primaryType" /> 
  <meta content="Preventing CSRF attacks" name="navTitle" /> 
  <meta content="2017-12-01T19:05:53.897-0500" name="jcr:created" /> 
  <meta content="2016-04-20T10:07:42.679-0400" name="firstPublishExternalDate" /> 
  <meta content="admin" name="lr_lastModifiedBy" /> 
  <meta content="admin" name="lr_creator" /> 
  <meta content="left" name="sideColumn" /> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="2018-04-03T09:10:25.272-0400" name="cq:lastReplicated" /> 
  <meta content="55" name="acrolinxSentences" /> 
  <meta content="carlino" name="cq:lastModifiedBy" /> 
  <meta content="" name="jcr:baseVersion" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
  <meta content="vishgupt" name="acrolinxLastCheckedBy" /> 
  <meta content="9fc9f086-4b3d-4088-912e-3ee4fada1be9" name="jcr:predecessors" /> 
  <meta content="video" name="pageLayout" /> 
  <meta content="light" name="heroGradient" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="head1_20111213" name="gep_conversion_script_version" /> 
  <meta content="2016-02-05T03:27:29.237-0500" name="lr_lastModified" /> 
  <meta content="wmyersta@adobe.com" name="lr_lastReplicatedBy" /> 
  <meta content="mix:versionable" name="jcr:mixinTypes" /> 
  <meta content="" name="jcr:versionHistory" /> 
  <meta content="940" name="acrolinxWords" /> 
  <meta content="2018-04-26T04:22:59.632-0400" name="cq:lastModified" /> 
  <meta content="2018-04-26T04:22:59.631-0400" name="locHandOffDate" /> 
 </head> 
 <body> 
  <h2 id="how_csrf_attacks_work">How CSRF attacks work</h2> 
  <p></p> 
  <p>Cross-site request forgery (CSRF) is a web site vulnerability where a valid user’s browser is used to send a malicious request, possibly via an iFrame. Because the browser sends cookies on a domain basis, if the user is currently logged in to an application, the user’s data may be compromised. </p> 
  <p>For example, consider a scenario where you are logged in to administration console in a browser. You receive an email message containing a link. You click the link, which opens a new tab in your browser. The page that you opened contains a hidden iFrame that makes a malicious request to the forms server using the cookie from your authenticated AEM forms session. Because User Management receives a valid cookie, it passes the request.</p> 
  <h2 id="csrf_related_terms">CSRF-related terms</h2> 
  <p></p> 
  <p><strong>Referer:</strong> The address of the source page from which a request is coming. For example, a web page on site1.com contains a link to site2.com. Clicking the link posts a request to site2.com. The referer of this request is site1.com because the request is made from a page whose source is site1.com.</p> 
  <p><strong>Whitelisted URIs:</strong> URIs identify resources on the forms server that are being requested, for example, /adminui or /contentspace. Some resources may allow a request to enter the application from external sites. These resources are considered whitelisted URIs. The forms server never performs a referer check from whitelisted URIs.</p> 
  <p><strong>Null referer:</strong> When you open a new browser window or tab, then type an address and press Enter, the referer is null. The request is entirely new and not originating from a parent web page; therefore, there is no referer for the request. The forms server can receive a null referer from:</p> 
  <ul> 
   <li><p>requests made on SOAP or REST endpoints from Acrobat</p> </li> 
   <li><p>any desktop client making an HTTP request on a AEM forms SOAP or REST endpoint</p> </li> 
   <li><p>when a new browser window is opened and the URL for any AEM forms web application login page is entered</p> </li> 
  </ul> 
  <p>Allow a null referer on SOAP and REST endpoints. Also allow a null referer on all URI login pages such as /adminui and /contentspace and their corresponding mapped resources. For example, the mapped servlet for /contentspace is /contentspace/faces/jsp/login.jsp, which should be a null referer exception. This exception is required only if you enable GET filtering for your web application. Your applications can specify whether to allow null referers. (See “Protecting from Cross-Site Request Forgery attacks” in Hardening and Security for AEM forms on <a href="/forms/using/topics" target="_blank">Help and Tutorials</a> page.)</p> 
  <p><strong>Allowed Referer Exception:</strong> Allowed Referer Exception is a sublist of the list of allowed referers, from which requests are blocked. Allowed Refer Exceptions are particular to a web application. If a subset of the Allowed Referers should not be allowed to invoke a particular web application, you can blacklist the referers via Allowed Referer Exceptions. Allowed Referer Exceptions are specified in the web.xml file for your application. (See “Protecting from Cross-Site Request Forgery attacks” in Hardening and Security for AEM forms on Help and Tutorials page.)</p> 
  <h2 id="how_allowed_referers_work">How allowed referers work</h2> 
  <p></p> 
  <p>AEM forms provides referer filtering, which can help prevent CSRF attacks. Here is how referer filtering works:</p> 
  <ol> 
   <li><p>The forms server checks the HTTP method used for invocation:</p> 
    <ul> 
     <li><p>If it is POST, the forms server performs the referer header check.</p> </li> 
     <li><p>If it is GET, the forms server bypasses the referer check, unless CSRF_CHECK_GETS is set to true, in which case it performs the referer header check. CSRF_CHECK_GETS is specified in the web.xml file for your application. (See “Protecting from Cross-Site Request Forgery attacks” in <a href="http://help.adobe.com/en_US/livecycle/11.0/HardeningSecurity/index.html" target="_blank">Hardening and Security guide</a>.)</p> </li> 
    </ul>  </li> 
   <li><p>The forms server checks whether the requested URI is whitelisted:</p> 
    <ul> 
     <li><p>If the URI is whitelisted, the server passes the request.</p> </li> 
     <li><p>If the requested URI is not whitelisted, the server retrieves the referer of the request.</p> </li> 
    </ul> </li> 
   <li><p>If there is a referer in the request, the server checks whether it is an allowed referer. If it is allowed, the server checks for a referer exception:</p> 
    <ul> 
     <li><p>If it is an exception, the request is blocked.</p> </li> 
     <li><p>If it is not an exception, the request is passed.</p> </li> 
    </ul>  </li> 
   <li><p>If there is no referer in the request, the server checks whether a null referer is allowed.</p> 
    <ul> 
     <li><p>If a null referer is allowed, the request is passed.</p> </li> 
     <li><p>If a null referer is not allowed, the server checks whether the requested URI is an exception for null referer and handles the request accordingly.</p> </li> 
    </ul> </li> 
  </ol> 
  <p> </p> 
  <h2 id="configure_allowed_referers">Configure allowed referers</h2> 
  <p></p> 
  <p>When you run Configuration Manager, the default host and IP address or the forms server are added to the Allowed Referer list. You can edit this list in administration console.</p> 
  <ol> 
   <li><p>In administration console, click Settings &amp;gt; User Management &amp;gt; Configuration &amp;gt; Configure Allowed Referer URL’s. The Allowed Referer list appears at the bottom of the page.</p></li> 
   <li><p>To add an allowed referer:</p> 
    <ul> 
     <li><p>Type a host name or IP address in the Allowed Referers box. To add more than one allowed referer at a time, type each host name or IP address on a new line. </p></li> 
     <li><p>In the HTTP Port and HTTPS Ports boxes, specify which ports to allow for HTTP, HTTPS, or both. If you leave those boxes empty, the default ports (port 80 for HTTP and port 443 for HTTPS) are used. If you enter <span class="code">0</span> (zero) in the boxes, all ports on that server are enabled. You can also enter a specific port number to enable only that port.</p></li> 
     <li><p>Click Add.</p></li> 
    </ul></li> 
   <li><p>To remove entry from the Allowed Referer list, select the item from the list and click Delete.</p><p>If the Allowed Referer List is empty, the CSRF feature stops working and the system becomes insecure.</p></li> 
   <li><p>After changing the Allowed Referer list, restart the AEM forms server.</p></li> 
  </ol> 
 </body> 
</html>