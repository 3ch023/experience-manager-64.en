<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="vishgupt" name="acrolinxLastCheckedBy" /> 
  <meta content="2018-03-23T07:28:41.337-0400" name="jcr:created" /> 
  <meta content="2018-05-03T06:24:28.971-0400" name="topicBrowsingSortDate" /> 
  <meta content="vishgupt" name="cq:lastReplicatedBy" /> 
  <meta content="" name="jcr:versionHistory" /> 
  <meta content="en" name="pageCreatedAt" /> 
  <meta content="http://acrolinx.corp.adobe.com:8031/output/en/document_security_handling_user_data_krs_workflow_0eaa5f398ed6741b_626_report.xml" name="acrolinxReportURL" /> 
  <meta content="" name="jcr:baseVersion" /> 
  <meta content="video" name="pageLayout" /> 
  <meta content="" name="jcr:primaryType" /> 
  <meta content="vishgupt@adobe.com" name="lr_lastReplicatedBy" /> 
  <meta content="true" name="jcr:isCheckedOut" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
  <meta content="left" name="sideColumn" /> 
  <meta content="Document Security | Handling user data" name="jcr:title" /> 
  <meta content="2018-05-03T06:24:28.971-0400" name="publishExternalDate" /> 
  <meta content="2018-04-19T10:46:12.853-0400" name="acrolinxDate" /> 
  <meta content="mix:versionable" name="jcr:mixinTypes" /> 
  <meta content="933" name="acrolinxWords" /> 
  <meta content="2018-05-03T06:24:28.971-0400" name="lastPublishExternalDate" /> 
  <meta content="false" name="doNotLocalize" /> 
  <meta content="checked_not_improved" name="acrolinxStatus" /> 
  <meta content="2018-05-03T06:24:28.985-0400" name="cq:lastModified" /> 
  <meta content="79" name="acrolinxSentences" /> 
  <meta content="topic_tags:grdp;products:SG_EXPERIENCEMANAGER/6.4/FORMS" name="cq:tags" /> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="Activate" name="cq:lastReplicationAction" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="2018-04-30T03:14:51.791-0400" name="locHandOffDate" /> 
  <meta content="/content/help/en/experience-manager/6-4/morehelp/grdp;/content/help/en/experience-manager/6-4/forms/morehelp/grdp" name="moreHelpPaths" /> 
  <meta content="2018-04-06T04:29:04.771-0400" name="firstPublishExternalDate" /> 
  <meta content="https://helpx.adobe.com/experience-manager/6-4/forms/using/document-security-handling-user-data.html" name="publishExternalURL" /> 
  <meta content="e9211a44-0605-4c43-a96d-c3f6899d2b83" name="jcr:uuid" /> 
  <meta content="green" name="acrolinxPageStatus" /> 
  <meta content="128d18b8-4100-42fd-8153-1cf15140a013" name="jcr:predecessors" /> 
  <meta content="2018-05-03T06:24:29.155-0400" name="cq:lastReplicated" /> 
  <meta content="light" name="heroGradient" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4" name="primaryProductTag" /> 
  <meta content="vishgupt" name="cq:lastModifiedBy" /> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
 </head> 
 <body> 
  <p>AEM Forms document security allows you to create, store, and apply predefined security settings to your documents. It ensures that only authorized users can use the documents. You can protect documents by using policies. A policy is a collection of information that includes security settings and a list of authorized users. You can apply a policy to one or more documents and authorizes users who are added in AEM Forms JEE user management.</p> 
  <p>For more information about how document security works, see <a href="/forms/using/admin-help/topics" target="_blank">AEM Forms JEE administration help</a>.</p> 
  <h2>User data and data stores</h2> 
  <p>Document security stores policies and data related to protected documents including user data in a database, such as My Sql, Oracle, MS SQL Server, and IBM DB2. In addition, the data for authorized users in a policy in store in user management. For information about data stored in user management, see <a href="../../forms/using/user-management-handling-user-data.md" target="_blank">Forms User Management | Handling user data</a>.</p> 
  <p>The following table maps how document security organizes data in database tables.</p> 
  <table border="1" cellpadding="1" cellspacing="0" width="100%"> 
   <tbody> 
    <tr> 
     <td>Database table</td> 
     <td>Description</td> 
    </tr> 
    <tr> 
     <td><span class="code">EdcPrincipalKeyEntity</span></td> 
     <td>Stores information about principal keys for the users. The keys are used in offline document security workflows.</td> 
    </tr> 
    <tr> 
     <td><span class="code">EdcAuditEntity</span></td> 
     <td>Stores information about auditing event like user events, document events, and policy events.</td> 
    </tr> 
    <tr> 
     <td><p><span class="code">EdcLicenseEntity</span></p> </td> 
     <td>Stores record of a protected document. It stores license details for every protected document.</td> 
    </tr> 
    <tr> 
     <td><p><span class="code">EdcDocumentEntity</span></p> </td> 
     <td>Stores document name for every license created in the system.</td> 
    </tr> 
    <tr> 
     <td><p><span class="code">EdcRevokationEntity</span></p> </td> 
     <td>Stores information about revocation and reinstatement of protected documents.</td> 
    </tr> 
    <tr> 
     <td><span class="code">EdcMyPolicyListEntity</span></td> 
     <td>Stores information about users who can create personal policies that appear under the My Policies tab on the Policies page. </td> 
    </tr> 
    <tr> 
     <td><span class="code">EdcPolicyEntity</span></td> 
     <td>Stores information about policies. Each policy corresponds to a row in this table.</td> 
    </tr> 
    <tr> 
     <td><span class="code">EdcPolicyXmlEntity</span></td> 
     <td>Stores XML files for active policies. A policy XML<sup> </sup>contains references to principal IDs of users associated with the policy. Policy XML is stored as a Blob object.</td> 
    </tr> 
    <tr> 
     <td><span class="code">EdcPolicyArchiveEntity</span></td> 
     <td>Stores information about archived policies. An archived policy contains its policy XML stored as a Blob object.</td> 
    </tr> 
    <tr> 
     <td><p><span class="code">EdcPolicySetPrincipalEntity</span></p> <p><span class="code">EdcPolicySetPrincipalEnt</span><br /> (Oracle and MS SQL databases)</p> </td> 
     <td>Stores the mapping between policy set and users.</td> 
    </tr> 
    <tr> 
     <td><span class="code">EdcInvitedUserEntity</span></td> 
     <td>Stores information about invited User.</td> 
    </tr> 
   </tbody> 
  </table> 
  <h2>Access and delete user data</h2> 
  <p>You can access and export document security data for users in the databases, and if required, delete it permanently.</p> 
  <p>To export or delete user data from a database, you need to connect to the database using a database client and find out the principal ID based on some personally identifiable information of the user. For example, to retrieve the principal ID of a user using a login ID, run the following <span class="code">select</span> command on the database.</p> 
  <p>In the <span class="code">select</span> command, replace the <span class="code">&amp;lt;user_login_id&amp;gt;</span> with the login ID of the user whose principal ID you want to retrieve from the <span class="code">EdcPrincipalUserEntity</span> database table.</p> 
  <codeblock gutter="true" class="syntax sql">
    select&amp;nbsp;refprincipalid&amp;nbsp;from&amp;nbsp;EdcPrincipalUserEntity&amp;nbsp;where&amp;nbsp;uidstring&amp;nbsp;=&amp;nbsp;&lt;user_login_id&gt; 
  </codeblock> 
  <p>Once you know the principal ID, you can export or delete the user data.</p> 
  <h3>Export user data</h3> 
  <p>Run the following database commands to export user data for a principal ID from database tables. In the <span class="code">select</span> command, replace <span class="code">&amp;lt;principal_id&amp;gt;</span> with the principal ID of the user whose data you want to export.</p> 
  <note> 
   <p>The following commands use database table names in My SQL and IBM DB2 databases. When running these commands on Oracle and MS SQL databases, replace <span class="code">EdcPolicySetPrincipalEntity</span> with <span class="code">EdcPolicySetPrincipalEnt</span> in the commands.</p> 
  </note> 
  <codeblock class="syntax sql">
    Select&amp;nbsp;*&amp;nbsp;from&amp;nbsp;EdcPrincipalKeyEntity&amp;nbsp;where&amp;nbsp;principalid&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;';!!discoiqbr!!!!discoiqbr!!Select&amp;nbsp;*&amp;nbsp;from&amp;nbsp;EdcLicenseEntity&amp;nbsp;where&amp;nbsp;publisherId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;';!!discoiqbr!!!!discoiqbr!!Select&amp;nbsp;*&amp;nbsp;from&amp;nbsp;EdcDocumentEntity&amp;nbsp;where&amp;nbsp;id&amp;nbsp;in&amp;nbsp;(Select&amp;nbsp;documentid&amp;nbsp;from&amp;nbsp;EdcLicenseEntity&amp;nbsp;where&amp;nbsp;publisherId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;');!!discoiqbr!!!!discoiqbr!!Select&amp;nbsp;*&amp;nbsp;from&amp;nbsp;EdcRevokationEntity&amp;nbsp;where&amp;nbsp;licenseid&amp;nbsp;in&amp;nbsp;(Select&amp;nbsp;id&amp;nbsp;from&amp;nbsp;EdcLicenseEntity&amp;nbsp;where&amp;nbsp;publisherId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;');!!discoiqbr!!!!discoiqbr!!Select&amp;nbsp;*&amp;nbsp;from&amp;nbsp;EdcMyPolicyListEntity&amp;nbsp;where&amp;nbsp;principalId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;';!!discoiqbr!!!!discoiqbr!!Select&amp;nbsp;*&amp;nbsp;from&amp;nbsp;edcpolicyentity&amp;nbsp;where&amp;nbsp;policyownerId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;';!!discoiqbr!!!!discoiqbr!!Select&amp;nbsp;*&amp;nbsp;from&amp;nbsp;edcpolicyxmlentity&amp;nbsp;where&amp;nbsp;policyidref&amp;nbsp;in&amp;nbsp;(Select&amp;nbsp;id&amp;nbsp;from&amp;nbsp;edcpolicyentity&amp;nbsp;where&amp;nbsp;policyownerId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;');!!discoiqbr!!!!discoiqbr!!Select&amp;nbsp;*&amp;nbsp;from&amp;nbsp;edcpolicyarchiveentity&amp;nbsp;where&amp;nbsp;policyownerId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;';!!discoiqbr!!!!discoiqbr!!Select&amp;nbsp;*&amp;nbsp;from&amp;nbsp;edcpolicysetprincipalentity&amp;nbsp;where&amp;nbsp;principalId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;';!!discoiqbr!!!!discoiqbr!!Select&amp;nbsp;*&amp;nbsp;from&amp;nbsp;edcinviteduserentity&amp;nbsp;where&amp;nbsp;principalId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;'; 
  </codeblock> 
  <note> 
   <p>To export data from the <span class="code">EdcAuditEntity</span> table, use the <a href="https://helpx.adobe.com/experience-manager/6-4/forms/ProgramLC/javadoc/index.html?com/adobe/livecycle/rightsmanagement/client/EventManager.html" target="_blank">EventManager.exportEvents</a> API that takes <a href="https://helpx.adobe.com/experience-manager/6-4/forms/ProgramLC/javadoc/com/adobe/livecycle/rightsmanagement/client/infomodel/EventSearchFilter.html" target="_blank">EventSearchFilter</a> as a parameter to export audit data based on <span class="code">principalId</span>, <span class="code">policyId</span>, or <span class="code">licenseId</span>.</p> 
  </note> 
  <p>To get complete data about a user in the system, you must access and export data from user management database. For more information, see <a href="../../forms/using/user-management-handling-user-data.md" target="_blank">Forms user management | Handling user data</a>.</p> 
  <h3>Delete user data</h3> 
  <p>Do the following to delete document security data for a principal ID from database tables.</p> 
  <ol> 
   <li><p>Shut down the AEM Forms server.</p> </li> 
   <li><p>Run the following database commands to delete data for the principal ID from database tables for document security. In the <span class="code">Delete</span> command, replace <span class="code">&amp;lt;principal_id&amp;gt;</span> with the principal ID of the user whose data you want to delete.</p> 
    <codeblock class="syntax sql">
      Delete&amp;nbsp;from&amp;nbsp;EdcPrincipalKeyEntity&amp;nbsp;where&amp;nbsp;principalid&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;';!!discoiqbr!!!!discoiqbr!!Delete&amp;nbsp;from&amp;nbsp;EdcMyPolicyListEntity&amp;nbsp;where&amp;nbsp;principalId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;';!!discoiqbr!!!!discoiqbr!!Delete&amp;nbsp;from&amp;nbsp;edcpolicyarchiveentity&amp;nbsp;where&amp;nbsp;policyownerId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;';!!discoiqbr!!!!discoiqbr!!Delete&amp;nbsp;from&amp;nbsp;edcpolicysetprincipalentity&amp;nbsp;where&amp;nbsp;principalId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;';!!discoiqbr!!!!discoiqbr!!Delete&amp;nbsp;from&amp;nbsp;edcinviteduserentity&amp;nbsp;where&amp;nbsp;principalId&amp;nbsp;=&amp;nbsp;'&lt;principal_id&gt;'; 
    </codeblock> 
    <note> 
     <p>To delete data from the <span class="code">EdcAuditEntity</span> table, use the <a href="https://helpx.adobe.com/experience-manager/6-4/forms/ProgramLC/javadoc/index.html?com/adobe/livecycle/rightsmanagement/client/EventManager.html" target="_blank">EventManager.deleteEvents</a> API that takes <a href="https://helpx.adobe.com/experience-manager/6-4/forms/ProgramLC/javadoc/com/adobe/livecycle/rightsmanagement/client/infomodel/EventSearchFilter.html" target="_blank">EventSearchFilter</a> as a parameter to delete audit data based on <span class="code">principalId</span>, <span class="code">policyId</span>, or <span class="code">licenseId</span>.</p> 
    </note></li> 
   <li><p>Active and archived policy XML files are stored in the <span class="code">EdcPolicyXmlEntity</span> and <span class="code">EdcPolicyArchiveEntity</span> database tables, respectively. To delete data for a user from these tables, do the following:</p> 
    <ol> 
     <li>Open the XML blob of each row in the <span class="code">EdcPolicyXMLEntity</span> or <span class="code">EdcPolicyArchiveEntity</span> table and extract the XML file. The XML file is similar to the one shown below. </li> 
     <li>Edit the XML file to remove the blob for the principal ID.</li> 
     <li>Repeat steps 1 and 2 for the other file.</li> 
    </ol> 
    <note> 
     <p>You must remove the complete blob within the <span class="code">Principal</span> tag for a principal ID or the policy XML may get corrupt or unusable.</p> 
    </note> 
    <codeblock gutter="true" class="syntax xml">
      &lt;ns2:Principal&amp;nbsp;PrincipalNameType="USER"&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;ns2:PrincipalDomain&gt;OID&lt;/ns2:PrincipalDomain&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;ns2:PrincipalName&gt;56F33FEB-098A-1036-A651-00000A2A2656&lt;/ns2:PrincipalName&gt;!!discoiqbr!!&lt;/ns2:Principal&gt;!!discoiqbr!!&lt;/ns2:PolicyEntry&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;ns2:Property&amp;nbsp;PropertyName="isCertified"&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;ns2:PropertyValue&amp;nbsp;xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&amp;nbsp;xmlns:xs="http://www.w3.org/2001/XMLSchema"&amp;nbsp;xsi:type="xs:string"&gt;false&lt;/ns2:PropertyValue&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/ns2:Property&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;ns2:Property&amp;nbsp;PropertyName="encryptionAlgorithm"&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;ns2:PropertyValue&amp;nbsp;xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&amp;nbsp;xmlns:xs="http://www.w3.org/2001/XMLSchema"&amp;nbsp;xsi:type="xs:string"&gt;AES128&lt;/ns2:PropertyValue&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/ns2:Property&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;ns2:Property&amp;nbsp;PropertyName="AccessDeniedErrorMessage"&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;ns2:PropertyValue&amp;nbsp;xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&amp;nbsp;xmlns:xs="http://www.w3.org/2001/XMLSchema"&amp;nbsp;xsi:type="xs:string"&gt;&lt;/ns2:PropertyValue&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/ns2:Property&gt;!!discoiqbr!!&lt;ns2:PolicyEntry&gt;!!discoiqbr!!&lt;ns2:Permission&amp;nbsp;PermissionName="ns3:com.adobe.aps.onlineOpen"&amp;nbsp;Access="ALLOW"/&gt;!!discoiqbr!!&lt;ns2:Permission&amp;nbsp;PermissionName="ns3:com.adobe.aps.pdf.copy"&amp;nbsp;Access="ALLOW"/&gt;!!discoiqbr!!&lt;ns2:Permission&amp;nbsp;PermissionName="ns3:com.adobe.aps.offlineOpen"&amp;nbsp;Access="ALLOW"/&gt;!!discoiqbr!!&lt;ns2:Permission&amp;nbsp;PermissionName="ns3:com.adobe.aps.pdf.accessible"&amp;nbsp;Access="ALLOW"/&gt;!!discoiqbr!!&lt;ns2:Permission&amp;nbsp;PermissionName="ns3:com.adobe.aps.pdf.editNotes"&amp;nbsp;Access="ALLOW"/&gt;!!discoiqbr!!&lt;ns2:Permission&amp;nbsp;PermissionName="ns3:com.adobe.aps.pdf.edit"&amp;nbsp;Access="ALLOW"/&gt;!!discoiqbr!!&lt;ns2:Permission&amp;nbsp;PermissionName="ns3:com.adobe.aps.pdf.fillAndSign"&amp;nbsp;Access="ALLOW"/&gt;!!discoiqbr!!&lt;ns2:Permission&amp;nbsp;PermissionName="ns3:com.adobe.aps.pdf.printHigh"&amp;nbsp;Access="ALLOW"/&gt;!!discoiqbr!!&lt;ns2:Permission&amp;nbsp;PermissionName="ns3:com.adobe.aps.pdf.printLow"&amp;nbsp;Access="ALLOW"/&gt; 
    </codeblock><p>In addition to deleting data directly from the <span class="code">EdcPolicyXmlEntity</span> table, there are two more ways you can achieve this:</p>  
    <ol> 
     <li>As an administrator, log into the Forms JEE administration console at http://[<em>server</em>]:[<em>port</em>]/adminui.</li> 
     <li>Navigate to <span class="uicontrol">Services &amp;gt; Document Security &amp;gt; Policy Sets</span>.</li> 
     <li>Open a policy set and delete the user from the policy.</li> 
    </ol>  <p>Document security users who have permissions to create personal policies can delete user data from their policies. To do so: </p> 
    <ol> 
     <li>Users who have personal policies log into their document security web page at http://[<em>server</em>]:[<em>port</em>]/edc.</li> 
     <li>Navigate to <span class="uicontrol">Services &amp;gt; Document Security &amp;gt; My Policies</span>.</li> 
     <li>Open a policy and delete the user from the policy.</li> 
    </ol> <p><strong>Note</strong>: Administrators can search, access, and delete user data from personal policies of other users in <span class="uicontrol">Services &amp;gt; Document Security &amp;gt; My Policies</span> using administration console. </p> </li> 
   <li><p>Delete the data for the principal ID from user management database. For detailed steps, see <a href="../../forms/using/user-management-handling-user-data.md">Forms User Management | Handling user data</a>.</p> </li> 
   <li><p>Start the AEM Forms server.</p> </li> 
  </ol> 
 </body> 
</html>