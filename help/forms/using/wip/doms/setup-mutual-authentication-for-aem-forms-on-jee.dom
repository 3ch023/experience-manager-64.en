<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="khsingh" name="contentOwner" /> 
  <meta content="http://acrolinx.corp.adobe.com:8031/output/en/setup_mutual_authentication_for_aem_forms_on_jee_krs_workflow_27a21c3e5e538b90_217_report.xml" name="acrolinxReportURL" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="yellow" name="acrolinxPageStatus" /> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
  <meta content="khsingh" name="acrolinxLastCheckedBy" /> 
  <meta content="checked_not_improved" name="acrolinxStatus" /> 
  <meta content="97" name="acrolinxSentences" /> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="[DO NOT PUBLISH] Set up Mutual Authentication for AEM Forms on JEE" name="jcr:title" /> 
  <meta content="true" name="preview" /> 
  <meta content="khsingh" name="cq:lastModifiedBy" /> 
  <meta content="en" name="pageCreatedAt" /> 
  <meta content="2018-12-05T07:32:20.957-0500" name="acrolinxDate" /> 
  <meta content="2019-01-15T15:36:11.639-0500" name="jcr:created" /> 
  <meta content="2019-02-06T05:03:36.085-0500" name="cq:lastModified" /> 
  <meta content="" name="jcr:primaryType" /> 
  <meta content="1150" name="acrolinxWords" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
 </head> 
 <body> 
  <p>Mutual authentication is a security process in which both the clients and server authenticate each other's identities before actual communication occurs. With mutual authentication, a connection can occur only when the client trusts the digital certificate of the server and the server trusts the certificate of the client. In this way, a client and a server are certain that they are connecting with legitimate entities and severing content for legitimate purposes. For more information about mutual authentication, see <a href="https://www.codeproject.com/Articles/326574/An-Introduction-to-Mutual-SSL-Authentication">an Introduction to Mutual Authentication</a>.</p> 
  <p>You can use mutual authentication in AEM Form to:</p> 
  <ul> 
   <li>Provide secure communication for logging to AEM Forms on JEE web interfaces like admin console and HTML Workspace.</li> 
   <li>Authenticate users using CAC cards to log on to an AEM Forms server.</li> 
   <li>Configure Microsoft SharePoint Connector Web to enable authenticate via a system user certificate instead of a pre-configured user name and password</li> 
   <li>Secure communication between AEM Forms, Adobe Acrobat, Acrobat Reader, and Microsoft office. For example, securing communication while opening a policy protected documents using Adobe Reader or Adobe Acrobat.</li> 
   <li>Allow indexing protected documents in AEM Forms Document Security iFilter.</li> 
   <li>Securely logging in to AEM Forms Workbench.</li> 
  </ul> 
  <h2>Configure Mutual Authentication for AEM Forms</h2> 
  <p>Configure application server and AEM Forms on JEE server to provide secure logging and secure communication between AEM Forms, Adobe Acrobat, Acrobat Reader, and Microsoft office. </p> 
  <ul> 
   <li><a href="../../../forms/using/wip/setup-mutual-authentication-for-aem-forms-on-jee.md#main-pars-header-1346705516">Configure application server</a></li> 
   <li><a href="/content/help/en/livecycle/kb/cac-mutual-authentication#main-pars_header_3" target="_blank">Configure AEM Forms on JEE server</a></li> 
  </ul> 
  <p>Perform the following additional configurations to enable authenticate via a system user certificate instead of a pre-configured user name and password for Microsoft SharePoint, authenticate users using CAC cards, allow indexing protected documents, securely logging in to AEM Forms Workbench: </p> 
  <ul> 
   <li><a href="/content/help/en/livecycle/kb/cac-mutual-authentication#main-pars_header_4" target="_blank">Configure Microsoft SharePoint Connector Web part changes</a></li> 
   <li><a href="/content#main-pars_header_5" target="_blank">Configure document security iFilter</a></li> 
   <li><a href="/content#main-pars_header_29601462" target="_blank">Provide access to HTML Workspace through CAC authentication</a></li> 
   <li>Configure Workbench</li> 
  </ul> 
  <h3>Pre-requisites</h3> 
  <p>Before you start, </p> 
  <ul> 
   <li>Obtain certificates from a trusted certifying authority (CA) or create <a href="../../../forms/using/wip/setup-mutual-authentication-for-aem-forms-on-jee.md#main-pars-header-680942598">self-signed the certificates</a>. These certificates are required to identify the server and clients in a mutual authentication environment.<br /> </li> 
   <li>Create and deploy the custom user management auth provider (AuthProvider) SPI to enable mutual authentication on the AEM Forms server. For detailed instructions, see <a href="/content/help/en/livecycle/kb/cac-mutual-authentication#main-pars_header_3" target="_blank">Server Configuration</a>.<br /> </li> 
  </ul> 
  <h3>Configure application server</h3> 
  <p>Each application server has a separate set of instructions to enable mutual authentication. See application server documentation to enable <strong>2-way Mutual Authentication. </strong>For AEM 6.4 Forms running on JBoss 7.0.6 application server perform the following steps: <strong></strong></p> 
  <ol> 
   <li><p>Create the server.truststore file:</p> <p>Open command line or terminal and run the below commands in listed sequence to generate the server.truststore file at <span class="kbd">\Adobe\Adobe_Experience_Manager_Forms\jboss\standalone\configuration</span>:</p> 
    <ol> 
     <li><span class="kbd">\Adobe\Adobe_Experience_Manager_Forms\Java\jdk&amp;lt;version&amp;gt;\bin\keytool.exe -import -alias server-cert -file &amp;lt;client-certificate&amp;gt;.cer -keystore server.truststore C:\Adobe</span></li> 
     <li><span class="code">\Adobe_Experience_Manager_Forms\Java\jdk&amp;lt;version&amp;gt;\bin\keytool.exe -import -alias adobe-cert-auth-root -file &amp;lt;servert-certificate&amp;gt;.cer -keystore server.truststore</span></li> 
    </ol> </li> 
   <li><p>Open AEM Forms admin console and whitelist the common name. The default URL of admin console is http://&amp;lt;server&amp;gt;:&amp;lt;port&amp;gt;/adminui.</p> <p>In the admin console, navigate to Settings &amp;gt; User Management &amp;gt; Configuration &amp;gt;Configure Allowed Referer URL's. In the <strong>Referer Whitelist</strong> field, type the common name assigned to the certificate. For example, Paul Smith. In the <strong>HTTP port</strong> and <strong>HTTPs port</strong> field, type 0 and click <strong>Add</strong>. </p> </li> 
   <li><p>Stop the AEM Forms server.</p> </li> 
   <li><p>Configure SSL settings: <br /> </p> 
    <ol> 
     <li><p>Open the [AEM Forms on JEE installation Folder]\jboss\standalone\configuration\lc_turnkey.xml file for editing. </p> </li> 
     <li><p>Add the following in the &amp;lt;subsystem xmlns="urn:jboss:domain:undertow:3.1"&amp;gt; tag:</p> 
      <codeblock lineWrap="true" class="syntax js">
        &lt;https-listener&amp;nbsp;name="default-secure"&amp;nbsp;socket-binding="https"&amp;nbsp;security-realm="SSLRealm"&amp;nbsp;verify-client="REQUIRED"/&gt; 
      </codeblock></li> 
     <li><p>Add the following in the &amp;lt;security-realms&amp;gt; tag:</p> 
      <codeblock lineWrap="true" class="syntax js">
        &lt;security-realm&amp;nbsp;name="SSLRealm"&gt;!!discoiqbr!!&lt;server-identities&gt;!!discoiqbr!!&lt;ssl&gt;!!discoiqbr!!&lt;keystore&amp;nbsp;path="C:/Adobe/Adobe_Experience_Manager_Forms/jboss/standalone/configuration/server.keystore"&amp;nbsp;keystore-password="servercert"&amp;nbsp;alias="servercert"/&gt;!!discoiqbr!!&lt;/ssl&gt;&amp;nbsp;!!discoiqbr!!&lt;/server-identities&gt;!!discoiqbr!!&lt;authentication&gt;&amp;nbsp;!!discoiqbr!!&lt;truststore&amp;nbsp;path="C:/Adobe/Adobe_Experience_Manager_Forms/jboss/standalone/configuration/server.truststore"&amp;nbsp;keystore-password="servercert"&amp;nbsp;/&gt;!!discoiqbr!!&lt;/authentication&gt;!!discoiqbr!!&lt;/security-realm&gt;!!discoiqbr!! 
      </codeblock> 
      <note> 
       <p>Modify the path of truststore, keystore, and passwords, if required.</p> 
      </note></li> 
     <li><p>Save and close the file. </p> </li>  
    </ol></li> 
   <li><p>Restart the JBoss application server. </p> <p>After the server restarts, create a <a href="https://helpx.adobe.com/in/experience-manager/6-4/forms/using/admin-help/adding-domains.html#add_a_hybrid_domain">Hybrid Domain</a>. Choose the Auth Provider for the domain as <span class="uicontrol">Custom </span>and select <span class="uicontrol">SSLMutualAuthProvider</span>. In the hybrid domain, create a user with the name similar to user created in the previous step. For example, Paul Smith.</p> </li> 
   <li><p>Configure certificate for the server. </p> <p>Open page <a>https://[AEM-Forms-JEE-Server]:8443/</a> in a browser window. If multiple certificates are installed, a certificate selection pop-up dialog is displayed. Select the appropriate certificate.</p> </li> 
   <li><p>Add certificates to AEM truststore and keystore:<br /> </p> 
    <ol> 
     <li><p>Login to <a>http://[server]:[port]/lc/libs/granite/security/content/useradmin.html</a> as an administrator.</p> </li> 
     <li><p>Tap <span class="uicontrol">Administrator</span>. The <strong>Edit User Settings</strong> page opens.</p> </li> 
     <li><p>Tap <span class="uicontrol">Create trustStore</span> and set an access password for trustStore. For more information, see <a href="/content/help/en/experience-manager/6-3/sites/administering/using/saml-2-0-authenticationhandler#main-pars_title_0" target="_blank">Add the IdP Certificate to the AEM TrustStore</a>.</p> </li> 
     <li><p>Tap <span class="uicontrol">Create keyStore</span> and set a password for keyStore. For more information, see <a href="/content/help/en/experience-manager/6-3/sites/administering/using/saml-2-0-authenticationhandler#main-pars_title_1971190167" target="_blank">Add the Service Provider key and certificate chain to the AEM keystore</a>.</p> </li>  
    </ol></li> 
   <li><p>Logout of AEM Forms. Access the workspace with port :8443. You should be able to access the workspace with a CAC card.</p> </li>   
  </ol> 
  <h2>Use OpenSSL to create and sign certificates</h2> 
  <p>You can perform the following steps to create, sign, and export certificates using OpenSSL. The instructions below are for Windows Server 2016. You can perform similar steps for Linux and other versions of Microsoft Windows. To create and sign certificates: </p> 
  <ol> 
   <li><p>Install OpenSSL and prepare directory structure: </p> 
    <ol> 
     <li><p>Download and install OpenSSL at C:\OpenSSL. Use default settings while installing OpenSSL. <br /> </p> </li> 
     <li><p>Create a directory C:\certificate. This directory is working directory to create and sign certificates. Create the following directory structure in C:\certificate: </p> 
      <ul> 
       <li>C:\certificate\demoCA</li> 
       <li>C:\certificate\demoCA\newcerts</li> 
      </ul> </li> 
     <li><p>Create an empty (zero-byte) file, index.txt at C:\certificates\demoCA\</p> </li> 
     <li><p>Create a plain ASCII file containing the string "01" on the first line named serial at C:\certificates\demoCA\.</p> </li>  
    </ol></li> 
   <li><p>Create Root Certificate (CA)</p> 
    <ol> 
     <li><p>Create a private key. For example, create CA.key:<br /> </p>  <p>Specify and keep a note of the pass phrase. This procedure assumes pass phrase 123456 is used. You can use any certifying authority.</p> </li> 
     <li><p>Create the root certificate based on the private key. For example ADOBECERTAUTHROOT.cer</p>  <p>Enter the pass phrase, when prompted.</p> </li> 
     <li><p>Create an end-user certificate and sign the certificate using the issuer certificate. The instructions below assumes that the certificate is being issued for a user named Paul Smith: </p> 
      <ol> 
       <li><p>Run the below command to create the private key for Paul Smith:<br /> <span class="code">C:\certificates&amp;gt;openssl.exe genrsa -des3 -out Paul.key 1024</span><br /> Enter the pass phrase, when prompted.</p> </li> 
       <li><p>Run the below command to create a Certificate Signing Request (CSR), Paul.csc<br /> <span class="code">C:\certificates&amp;gt;openssl.exe req -new -key Paul.key -out Paul.csr -subj "/C=US/ST=California/L=San Jose/O=Adobe Systems Inc./OU=EDBU/CN=Paul <a href="mailto:Smith/emailAddress=paulsmith@adobe.com">Smith/emailAddress=paulsmith@adobe.com</a>"</span></p> <p>Enter the pass phrase, when prompted</p> </li> 
       <li><p> Sign the certificate request to obtain Paul’s certificate, PaulSmith.cer:</p>  <p>Enter Y or Yes, when prompted.</p> </li> 
       <li><p>Export the certificate in PKCS12 format (PaulSmith.p12):</p>  <p>Do not specify export password. Your certificate is ready. </p> </li>  
      </ol></li>   
    </ol></li>    
  </ol> 
 </body> 
</html>