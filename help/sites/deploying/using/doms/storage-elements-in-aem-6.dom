<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="2018-04-30T03:29:10.055-0400" name="locHandOffDate" /> 
  <meta content="2018-08-07T10:32:02.594-0400" name="publishExternalDate" /> 
  <meta content="40852134-668b-4c85-bbba-4650102ad16a" name="jcr:predecessors" /> 
  <meta content="2017-10-12T21:46:00.000-0400" name="qaDate" /> 
  <meta content="true" name="jcr:isCheckedOut" /> 
  <meta content="mix:versionable" name="jcr:mixinTypes" /> 
  <meta content="Storage Elements in AEM 6.4" name="jcr:title" /> 
  <meta content="Activate" name="cq:lastReplicationAction" /> 
  <meta content="Storage Elements in AEM 6.4" name="navTitle" /> 
  <meta content="" name="jcr:baseVersion" /> 
  <meta content="2018-08-07T10:32:02.594-0400" name="lastPublishExternalDate" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES;topic_tags:platform;content_type:reference" name="cq:tags" /> 
  <meta content="/content/docs/en/aem/6-0/deploy/upgrade/microkernels-in-aem-6-0" name="legacyPath" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="raiman@adobe.com" name="lr_lastReplicatedBy" /> 
  <meta content="Storage Elements in AEM 6.4" name="seoTitle" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
  <meta content="4f05d6e3-1460-4498-b563-862ca5fbf3f8" name="jcr:uuid" /> 
  <meta content="2017-10-12T21:46:58.665-0400" name="mwpw_migration_script_version" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES" name="primaryProductTag" /> 
  <meta content="2018-10-27T23:47:08.517-0400" name="cq:lastReplicated" /> 
  <meta content="raiman" name="cq:lastModifiedBy" /> 
  <meta content="false" name="isReadyForLocalization" /> 
  <meta content="" name="jcr:versionHistory" /> 
  <meta content="jsyal" name="cq:lastReplicatedBy" /> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="2017-12-01T19:03:25.429-0500" name="jcr:created" /> 
  <meta content="2017-10-31T16:17:34.574-0400" name="firstPublishExternalDate" /> 
  <meta content="https://helpx.adobe.com/experience-manager/6-4/sites/deploying/using/storage-elements-in-aem-6.html" name="publishExternalURL" /> 
  <meta content="audience:deploying" name="primaryAudienceTag" /> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="" name="jcr:primaryType" /> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
  <meta content="/content/help/en/experience-manager/6-4/sites/deploying/morehelp/platform;/content/help/en/experience-manager/6-4/sites/deploying/morehelp/platform" name="moreHelpPaths" /> 
  <meta content="/content/docs/en/aem/6-3/deploy/platform/storage-elements-in-aem-6" name="qaNotes" /> 
  <meta content="2018-08-07T10:32:02.594-0400" name="topicBrowsingSortDate" /> 
  <meta content="User" name="contentOwner" /> 
  <meta content="2018-08-07T10:32:02.601-0400" name="cq:lastModified" /> 
  <meta content="Learn about the node storage implementations available in AEM 6.4 and how to maintain the repository." name="seoDescription" /> 
 </head> 
 <body> 
  <p>In this article, we will cover:</p> 
  <ul> 
   <li><a href="../../../sites/deploying/using/storage-elements-in-aem-6.md#main-pars-title">Overview of Storage in AEM 6</a></li> 
   <li><a href="../../../sites/deploying/using/storage-elements-in-aem-6.md#main-pars-title-4">Maintaining the Repository</a><br /> </li> 
  </ul> 
  <h2>Overview of Storage in AEM 6</h2> 
  <p>One of the most important changes in AEM 6 are the innovations at the repository level.</p> 
  <p>Currently, there are two node storage implementations available in AEM6: Tar storage, and MongoDB storage.</p> 
  <h3>Tar Storage</h3> 
  <h4>Running a freshly installed AEM instance with Tar Storage</h4> 
  <note> 
   <p>The PID for the Segment node store has changed from org.apache.jackrabbit.oak.<strong>plugins</strong>.segment.SegmentNodeStoreService in previous versions of AEM 6 to org.apache.jackrabbit.oak.segment.SegmentNodeStoreService in AEM 6.3. Make sure you make the necessary configuration adjustments to reflect this change.</p> 
  </note> 
  <p>By default, AEM 6 uses the Tar storage to store nodes and binaries, using the default configuration options. To manually configured its storage settings, follow the below procedure:</p> 
  <ol> 
   <li><p>Download the AEM 6 quickstart jar and place it in a new folder.</p> </li> 
   <li><p>Unpack AEM by running:</p>  </li> 
   <li><p>Create a folder named <span class="code">crx-quickstart\install</span> in the installation directory.<br /> </p> </li> 
   <li><p>Create a file called <span class="code">org.apache.jackrabbit.oak.segment.SegmentNodeStoreService.cfg</span> in the newly created folder.<br /> </p> </li> 
   <li><p>Edit the file and set the configuration options. The following options are available for Segment Node Store, which is the basis of AEM's Tar storage implementation:</p> 
    <ul> 
     <li><span class="code">repository.home</span>: Path to repository home under which various repository related data is stored. By default segment files would be stored under the crx-quickstart/segmentstore directory.</li> 
     <li><span class="code">tarmk.size</span>: Maximum size of a segment in MB. The default is 256MB.</li> 
    </ul> </li> 
   <li><p>Start AEM.<br /> </p> </li> 
  </ol> 
  <h3>Mongo Storage</h3> 
  <h4>Running a freshly installed AEM instance with Mongo Storage</h4> 
  <p>AEM 6 can be configured to run with MongoDB storage by following the below procedure:<br /> </p> 
  <ol> 
   <li><p>Download the AEM 6 quickstart jar and place it into a new folder.</p> </li> 
   <li><p>Unpack AEM by running the following command:</p>  </li> 
   <li><p>Make sure that MongoDB is installed and an instance of <span class="code">mongod</span> is running. For more info, see <a href="http://docs.mongodb.org/manual/installation/">Installing MongoDB</a>.</p> </li> 
   <li><p>Create a folder named <span class="code">crx-quickstart\install</span> in the installation directory.</p> </li> 
   <li><p>Configure the node store by creating a configuration file with the name of the configuration you want to use in the <span class="code">crx-quickstart\install</span> directory.</p> <p>The Document Node Store (which is the basis for AEM's MongoDB storage implementation) uses a file called <span class="code">org.apache.jackrabbit.oak.plugins.document.DocumentNodeStoreService.cfg</span></p> </li> 
   <li><p>Edit the file and set your configuration options. The following options are available:</p> 
    <ul> 
     <li><span class="code">mongouri</span>: The <a href="http://docs.mongodb.org/manual/reference/connection-string/">MongoURI</a> required to connect to Mongo Database. The default is <span class="code">mongodb://localhost:27017</span><br /> </li> 
     <li><span class="code">db</span>: Name of the Mongo database. By default new AEM 6 installations use <strong>aem-author</strong> as the database name.<br /> </li> 
     <li><span class="code">cache</span>: The cache size in MB. This is distributed among various caches used in DocumentNodeStore. The default is 256<br /> </li> 
     <li><span class="code">changesSize</span>: Size in MB of capped collection used in Mongo for caching the diff output. The default is 256<br /> </li> 
     <li><span class="code">customBlobStore</span>: Boolean value indicating that a custom data store will be used. The default is false.</li> 
    </ul> </li> 
   <li><p>Create a configuration file with the PID of the data store you wish to use and edit the file in order to set the configuration options. For more info, please see <a href="../../../sites/deploying/using/data-store-config.md">Configuring Node Stores and Data Stores</a>.<br /> </p> </li> 
   <li><p>Start the AEM 6 jar with a MongoDB storage backend by running:</p> 
    <codeblock class="syntax shell">
      java&amp;nbsp;-jar&amp;nbsp;cq-quickstart-6.jar&amp;nbsp;-r&amp;nbsp;crx3,crx3mongo 
    </codeblock><p>Where <strong><span class="code">-r</span></strong> is the backend runmode. In this example, it will start with MongoDB support.</p> </li> 
  </ol> 
  <h4>Disabling Transparent Huge Pages</h4> 
  <p>Red Hat Linux uses a memory management algorithm called Transparent Huge Pages (THP). While AEM performs fine-grained reads and writes, THP is optimized for large operations. Because of this, it is recommended that you disable THP both on Tar and Mongo storage. To disable the algorithm, follow these steps:</p> 
  <ol> 
   <li><p>Open the <span class="code">/etc/grub.conf</span> file in the text editor of your choice.</p> </li> 
   <li><p>Add the following line to the <strong>grub.conf</strong> file:</p> 
    <codeblock gutter="true" class="syntax plain">
      transparent_hugepage=never 
    </codeblock></li> 
   <li><p>Finally, check if the setting has taken effect by running:</p> 
    <codeblock gutter="true" class="syntax plain">
      cat&amp;nbsp;/sys/kernel/mm/redhat_transparent_hugepage/enabled 
    </codeblock><p>If THP is disabled, the output of the above command should be:</p> 
    <codeblock class="syntax plain">
      always&amp;nbsp;madvise&amp;nbsp;[never] 
    </codeblock></li> 
  </ol> 
  <note> 
   <p>Addtionally, you can also consult the following resources:</p> 
   <ul> 
    <li>For more information regarding Transparent Huge Pages on Red Hat Linux, see this <a href="https://access.redhat.com/solutions/46111">article</a>.</li> 
    <li>For Linux tuning tips, see this <a href="https://helpx.adobe.com/experience-manager/kb/performance-tuning-tips.html">article</a>.</li> 
   </ul> 
  </note> 
  <h2>Maintaining the Repository</h2> 
  <p>Each update to the repository creates a new content revision. As a result, with each update the size of the repository grows. To avoid uncontrolled repository growth, old revisions need to be be cleaned up to free disk resources. This maintenance functionality is called Revision Cleanup. The Revision Cleanup mechanism will reclaim disk space by removing obsolete data from the repository. For further details about Revision Cleanup, read the <a href="../../../sites/deploying/using/revision-cleanup.md" target="_blank">Revision Cleanup page</a>.</p>                                     
 </body> 
</html>