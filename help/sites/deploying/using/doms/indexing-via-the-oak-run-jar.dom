<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="Indexing via the Oak-run Jar" name="jcr:title" /> 
  <meta content="2018-04-03T08:43:48.053-0400" name="firstPublishExternalDate" /> 
  <meta content="true" name="jcr:isCheckedOut" /> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="2018-10-17T10:18:22.514-0400" name="topicBrowsingSortDate" /> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="" name="jcr:primaryType" /> 
  <meta content="Activate" name="cq:lastReplicationAction" /> 
  <meta content="2e9b3327-a0f5-4f8c-93ec-2a8c0f3b9591" name="jcr:predecessors" /> 
  <meta content="2018-10-17T10:18:22.522-0400" name="cq:lastModified" /> 
  <meta content="" name="jcr:versionHistory" /> 
  <meta content="mix:versionable" name="jcr:mixinTypes" /> 
  <meta content="2018-10-17T10:18:22.562-0400" name="cq:lastReplicated" /> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
  <meta content="raiman@adobe.com" name="lr_lastReplicatedBy" /> 
  <meta content="Learn how to perform indexing via the Oak-run Jar." name="seoDescription" /> 
  <meta content="2018-04-06T10:13:52.867-0400" name="firstPublishInternalDate" /> 
  <meta content="https://helpx.adobe.com/experience-manager/6-4/sites/deploying/using/indexing-via-the-oak-run-jar.html" name="publishExternalURL" /> 
  <meta content="raiman" name="cq:lastReplicatedBy" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES;content_type:reference;topic_tags:deploying" name="cq:tags" /> 
  <meta content="2018-04-06T15:03:54.144-0400" name="publishInternalDate" /> 
  <meta content="a45b5e39-2800-4c95-86e5-e5cd195ac794" name="jcr:uuid" /> 
  <meta content="2018-10-17T10:18:22.514-0400" name="lastPublishExternalDate" /> 
  <meta content="2018-03-27T07:29:13.544-0400" name="jcr:created" /> 
  <meta content="2018-10-17T10:18:22.514-0400" name="publishExternalDate" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="" name="jcr:baseVersion" /> 
  <meta content="en" name="pageCreatedAt" /> 
  <meta content="/content/help/en/experience-manager/6-4/sites/deploying/morehelp/deploying" name="moreHelpPaths" /> 
  <meta content="2018-04-30T03:27:22.115-0400" name="locHandOffDate" /> 
  <meta content="raiman" name="cq:lastModifiedBy" /> 
  <meta content="https://helpx-internal.corp.adobe.com/content/help/en/experience-manager/6-4/sites/deploying/using/indexing-via-the-oak-run-jar.html" name="publishInternalURL" /> 
  <meta content="audience:deploying" name="primaryAudienceTag" /> 
  <meta content="2018-04-06T15:03:54.144-0400" name="lastPublishInternalDate" /> 
 </head> 
 <body> 
  <p>Oak-run supports all indexing use cases on the command line without having to operate from the JMX level. Advantages of the oak-run approach are:</p> 
  <ol> 
   <li>It is a new indexing toolset for AEM 6.4</li> 
   <li>It decreases time-to-reindex which beneficially impacts re-index times on larger repositories</li> 
   <li>It is reducing resource consumption during re-indexing in AEM which results in better system performance for other AEM activities</li> 
   <li>Oak-run provides Out-of-band support: If production conditions doesn't allow to run re-index on production instances, a cloned environment can be used for re-indexing to avoid critical performance impact. <br /> </li> 
  </ol> 
  <p> </p> 
  <p>Below you will find a list of use cases that can be leveraged when performing indexing operations via the <span class="code">oak-run</span> tool.<br /> </p> 
  <h2 id="IndexConsistencyChecks">Index Consistency Checks</h2> 
  <note> 
   <p>For more detailed information regarding this scenario, see <a href="../../../sites/deploying/using/oak-run-indexing-usecases.md#main-pars-header">Use Case 1 - Index Consistency Check</a>.</p> 
  </note> 
  <ul> 
   <li><span class="code">oak-run.jar </span>quickly determines if lucene oak indexes are corrupt.</li> 
   <li>It is safe to run on an in-use AEM instance for consistency check levels 1 and 2.</li> 
  </ul> 
  <img imageRotate="0" src="assets/screen_shot_2017-12-14at135758.png" /> 
  <h2 id="IndexStatistics">Index Statistics</h2> 
  <note> 
   <p>For more detailed information regarding this scenario, see <a href="../../../sites/deploying/using/oak-run-indexing-usecases.md#main-pars-header-2069837756" target="_blank">Use Case 2 - Index Statistics</a></p> 
  </note> 
  <ul> 
   <li><span class="code">oak-run.jar</span> dumps all index definitions, important index stats and index contents for offline analysis.<br /> </li> 
   <li>Safe to execute on an in-use AEM instance.</li> 
  </ul> 
  <img imageRotate="0" src="assets/image2017-12-19_9-47-40.png" /> 
  <h2 id="ReindexingApproachDecisionTree">Re-indexing Approach Decision Tree</h2> 
  <p>This diagram is a decision tree for when to use the various re-indexing approaches.</p> 
  <img imageRotate="0" src="assets/oak_-_reindexingwithoak-run.png" /> 
  <h2 id="ReindexingMongoMK">Re-indexing MongoMK / RDMBMK</h2> 
  <note> 
   <p>For more detailed information regarding this scenario, see <a href="../../../sites/deploying/using/oak-run-indexing-usecases.md#main-pars-header-1966814117" target="_blank">Use Case 3 - Reindexing</a>.</p> 
  </note> 
  <h3 id="TextPre-extraction">Text Pre-extraction for SegmentNodeStore and DocumentNodeStore</h3> 
  <p><a href="../../../sites/deploying/using/best-practices-for-queries-and-indexing.md#howtoperformtextpreextraction">Text pre-extraction</a> (a feature that has existed with AEM 6.3) can be used to reduce the time to re-index. Text pre-extraction can be used in conjunction with all re-indexing approaches.</p> 
  <p>Depending on the <span class="code">oak-run.jar</span> indexing approach there will be various steps on either side of the Perform Re-index step in the diagram below.</p> 
  <img imageRotate="0" src="assets/4.png" /> 
  <note> 
   <p>Orange denotes activities where AEM must be in a maintenance window.</p> 
  </note> 
  <h3 id="Onlinere-indexingforMongoMK">Online re-indexing for MongoMK or RDBMK using oak-run.jar</h3> 
  <note> 
   <p>For more detailed information regarding this scenario, see <a href="../../../sites/deploying/using/oak-run-indexing-usecases.md#main-pars-header-1264240815" target="_blank">Reindex - DocumentNodeStore</a>.</p> 
  </note> 
  <p>This is the recommended method for reindexing MongoMK (and RDBMK) AEM installations. No other method should be used.</p> 
  <p>This process needs to be executed only against a single AEM instance in the cluster.</p> 
  <img imageRotate="0" src="assets/5.png" /> 
  <h2 id="Re-indexingTarMK">Re-indexing TarMK</h2> 
  <note> 
   <p>For more detailed information regarding this scenario, see <a href="../../../sites/deploying/using/oak-run-indexing-usecases.md#main-pars-header-833164464" target="_blank">Reindex - SegmentNodeStore</a>.</p> 
  </note> 
  <ul> 
   <li><strong> Cold Standby considerations (TarMK)</strong> 
    <ul> 
     <li>There are no special consideration for Cold Standby; the Cold Standby instances will sync changes as usual.</li> 
    </ul> </li> 
   <li><strong>AEM Publish Farms (AE Publish Farms should always be TarMK)</strong> 
    <ul> 
     <li>For publish farm it needs to be done for all OR execute the steps on a single publish and then clone the setup for others (taking all the usual precations when cloning AEM instances; sling.id - should link to something here)</li> 
    </ul> </li> 
  </ul> 
  <h3 id="OnlineRe-IndexingforTarMK">Online Re-Indexing for TarMK</h3> 
  <note> 
   <p>For more detailed information regarding this scenario, see <a href="../../../sites/deploying/using/oak-run-indexing-usecases.md#main-pars-header-1140524246" target="_blank">Online Reindex - SegmentNodeStore</a>.</p> 
  </note> 
  <p>This is the method used before te introudction of the new indexing capabilities of oak-run.jar. It can done by setting the <span class="code">reindex=true</span> property on the Oak index.</p> 
  <p>This approach can be used if the time and performance effects to index are acceptable to the customer. This is often the case for small to medium sized AEM installations.</p> 
  <img imageRotate="0" src="assets/6.png" /> 
  <h3 id="OnlineRe-IndexingTarMKusingoak-run.jar">Online Re-Indexing TarMK using oak-run.jar</h3> 
  <note> 
   <p>For more detailed information regarding this scenario, see <a href="../../../sites/deploying/using/oak-run-indexing-usecases.md#main-pars-header-1975944462" target="_blank">Online Reindex - SegmentNodeStore - The AEM Instance is Running</a>.<br /> </p> 
  </note> 
  <p>Online-reindexing of TarMK is faster than the Online TarkMK reindexing decribed above. However, it also requires execution during a maintenance window, with the methion that the window will be shorter, and more steps are required to perform the re-indexing.</p> 
  <note> 
   <p>Orange denotes operations where AEM must be performed in a maintenance period.</p> 
  </note> 
  <img imageRotate="0" src="assets/7.png" /> 
  <h3 id="OfflineRe-IndexingTarMKusingoak-run.jar">Offline Re-Indexing TarMK using oak-run.jar</h3> 
  <note> 
   <p>For more detailed information regarding this scenario, see <a href="../../../sites/deploying/using/oak-run-indexing-usecases.md#main-pars-header-1014954409" target="_blank">Online Reindex - SegmentNodeStore - The AEM Instance is Shut Down</a>.</p> 
  </note> 
  <p>Offline re-indexing of TarMK is the simplest <span class="code">oak-run.jar</span> based re-indexing approach for TarMK as it requires a single <span class="code">oak-run.jar</span> comment. However, it requires the AEM instance to be shutdown.</p> 
  <note> 
   <p>Red denotes operations where AEM must be shut down.</p> 
  </note> 
  <img imageRotate="0" src="assets/8.png" /> 
  <h3 id="Out-of-bandRe-IndexingTarMKusingoak-run.jar ">Out-of-band Re-Indexing TarMK using oak-run.jar </h3> 
  <note> 
   <p>For more detailed information regarding this scenario, see <a href="../../../sites/deploying/using/oak-run-indexing-usecases.md#main-pars-header-703104640" target="_blank">Out of Band Reindex - SegmentNodeStore</a>.</p> 
  </note> 
  <p>Out-of-band re-indexing minimizes the impact of re-indexing on in-use AEM instances.</p> 
  <note> 
   <p>Red denotes operations where AEM may be shut down.</p> 
  </note> 
  <img imageRotate="0" src="assets/9.png" /> 
  <h2 id="UpdatingIndexingDefinitions">Updating Indexing Definitions</h2> 
  <note> 
   <p>For more detailed information about this scenario, see <a href="../../../sites/deploying/using/oak-run-indexing-usecases.md#main-pars-header-2126383393" target="_blank">Use Case 4 - Updating Index Definitions</a>.<br /> </p> 
  </note> 
  <h3 id="CreatingandUpdatingindexdefinitionsonTarMKusingACSEnsureIndex">Creating and Updating index definitions on TarMK using ACS Ensure Index</h3> 
  <note> 
   <p>ACS Ensure Index is a community supported project, and is not supported by Adobe Support.</p> 
  </note> 
  <p>This allows shipping index definition via content package which later results in re-indexing via setting the reindex flag to <span class="code">true</span>. This works for smaller setups where reindexing does not take long time.</p> 
  <p>For more info, see the <a href="https://adobe-consulting-services.github.io/acs-aem-commons/features/ensure-oak-index/index.html" target="_blank">ACS Ensure Index documentation</a> for details.</p> 
  <h3 id="CreatingandUpdatingindexdefinitionsonTarMKusingoak-run.jar">Creating and Updating index definitions on TarMK using oak-run.jar</h3> 
  <p>If the time or performance impact of re-indexing using non <span class="code">oak-run.jar</span> methods is too high, the following <span class="code">oak-run.jar</span> based approach can be used to import and re-index Lucene Index definitions in a TarMK based AEM installation.</p> 
  <img imageRotate="0" src="assets/10.png" /> 
  <h3 id="CreatingandUpdatingIndexDefinitionsonMonogMKusingoak-run.jar">Creating and Updating Index Definitions on MonogMK using oak-run.jar</h3> 
  <p>If the time or performance impact of re-indexing using non <span class="code">oak-run.jar</span> methods is too high, the following <span class="code">oak-run.jar</span> based approach can be used to import and re-index Lucene Index definitions in MongoMK based AEM installations.</p> 
  <img imageRotate="0" src="assets/11.png" /> 
 </body> 
</html>