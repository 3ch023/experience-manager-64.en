<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="2018-04-03T08:39:29.040-0400" name="cq:lastReplicated" /> 
  <meta content="https://helpx.adobe.com/experience-manager/6-4/sites/deploying/using/app-server-upgrade.html" name="publishExternalURL" /> 
  <meta content="e3a8a0ab-3304-42bf-9d04-9c50413bde3f" name="jcr:uuid" /> 
  <meta content="2018-04-30T03:29:23.398-0400" name="cq:lastModified" /> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="" name="jcr:primaryType" /> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="2018-04-30T03:29:23.397-0400" name="locHandOffDate" /> 
  <meta content="msm-service" name="cq:lastModifiedBy" /> 
  <meta content="2018-04-03T08:39:27.755-0400" name="lastPublishExternalDate" /> 
  <meta content="false" name="isReadyForLocalization" /> 
  <meta content="2018-04-03T08:39:27.755-0400" name="publishExternalDate" /> 
  <meta content="true" name="jcr:isCheckedOut" /> 
  <meta content="Activate" name="cq:lastReplicationAction" /> 
  <meta content="Upgrade Steps for Application Server Installations" name="seoTitle" /> 
  <meta content="Learn how to upgrade instances of AEM that are deployed via Application Servers." name="seoDescription" /> 
  <meta content="audience:deploying" name="primaryAudienceTag" /> 
  <meta content="Upgrade Steps for Application Server Installations" name="jcr:title" /> 
  <meta content="sarchiz" name="contentOwner" /> 
  <meta content="carlino" name="cq:lastReplicatedBy" /> 
  <meta content="2018-04-03T08:39:27.755-0400" name="topicBrowsingSortDate" /> 
  <meta content="" name="jcr:baseVersion" /> 
  <meta content="2018-02-15T08:03:17.486-0500" name="jcr:created" /> 
  <meta content="2017-11-29T07:07:09.232-0500" name="firstPublishExternalDate" /> 
  <meta content="mix:versionable" name="jcr:mixinTypes" /> 
  <meta content="950cfcd2-6a40-4e00-b2d9-bf28056bac32" name="jcr:predecessors" /> 
  <meta content="/content/help/en/experience-manager/6-4/sites/deploying/morehelp/upgrading;/content/help/en/experience-manager/6-4/sites/deploying/morehelp/upgrading" name="moreHelpPaths" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="carlino@adobe.com" name="lr_lastReplicatedBy" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES;topic_tags:upgrading;content_type:reference" name="cq:tags" /> 
  <meta content="en" name="pageCreatedAt" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES" name="primaryProductTag" /> 
  <meta content="" name="jcr:versionHistory" /> 
 </head> 
 <body> 
  <p>This section describes the procedure that needs to be followed in order to update AEM for Application Server installations.</p> 
  <p>All the examples in this procedure use JBoss as the Application Server and imply that you have a working version of AEM already deployed. The procedure is meant to document upgrades performed from <strong>AEM version 5.6 to 6.3</strong>.</p> 
  <ol> 
   <li><p>First, start JBoss. In most situations, you can do this by running the <span class="code">standalone.sh</span> startup script, by running this command from the terminal:<br /> </p> 
    <codeblock gutter="true" class="syntax shell">
      jboss-install-folder/bin/standalone.sh 
    </codeblock></li> 
   <li><p>If AEM 5.6 is already deployed, check that the bundles are functioning correctly by running:<br /> </p> 
    <codeblock gutter="true" class="syntax shell">
      wget&amp;nbsp;http://&lt;serveraddress:port&gt;/cq/system/console/bundles 
    </codeblock></li> 
   <li><p>Next, undeploy AEM 5.6:<br /> </p> 
    <codeblock gutter="true" class="syntax shell">
      rm&amp;nbsp;jboss-install-folder/standalone/deployments/cq.war 
    </codeblock></li> 
   <li><p>Stop JBoss.<br /> </p> </li> 
   <li><p>Now, migrate the repository using the crx2oak migration tool:<br /> </p> 
    <codeblock gutter="true" class="syntax shell">
      java&amp;nbsp;-jar&amp;nbsp;crx2oak.jar&amp;nbsp;crx-quickstart/repository/&amp;nbsp;crx-quickstart/oak-repository 
    </codeblock> 
    <note> 
     <p>In this example, oak-repository is the temporary directory where the newly converted repository will reside. Before performing this step, make sure you have the latest crx2oak.jar version.</p> 
    </note></li> 
   <li><p>Delete the necessary properties in the sling.properties file by doing the following:</p> 
    <ol> 
     <li> Open the file located at <span class="code">crx-quickstart/launchpad/sling.properties</span></li> 
     <li>Step text Remove the following properties and save the file:<br /> 
      <ol> 
       <li><span class="code"> sling.installer.dir</span><br /> </li> 
       <li><span class="code">felix.cm.dir</span><br /> </li> 
       <li><span class="code">granite.product.version</span><br /> </li> 
       <li><span class="code">org.osgi.framework.system.packages</span><br /> </li> 
       <li><span class="code">osgi-core-packages</span><br /> </li> 
       <li><span class="code">osgi-compendium-services</span><br /> </li> 
       <li><span class="code">jre-*</span><br /> </li> 
       <li><span class="code">sling.run.mode.install.options</span></li> 
      </ol> </li> 
    </ol> </li> 
   <li><p>Remove the files and folders that are no longer necessary. The items you need to specifically remove are:</p> 
    <ul> 
     <li> The <strong>launchpad/startup folder</strong>. You can delete it by running the following command in the terminal: <span class="code">rm -rf crx-quickstart/launchpad/startup</span><br /> </li> 
     <li>The <strong>base.jar file</strong>: <span class="code"> find crx-quickstart/launchpad -type f -name "org.apache.sling.launchpad.base.jar*" -exec rm -f {} \</span><br /> </li> 
     <li>The <strong>BootstrapCommandFile_timestamp.txt file</strong>: <span class="code">rm -f crx-quickstart/launchpad/felix/bundle0/BootstrapCommandFile_timestamp.txt</span></li> 
    </ul> </li> 
   <li><p>Copy the newly migrated segmentstore to its proper location:<br /> </p> 
    <codeblock gutter="true" class="syntax shell">
      mv&amp;nbsp;crx-quickstart/oak-repository/segmentstore&amp;nbsp;crx-quickstart/repository/segmentstore 
    </codeblock></li> 
   <li><p>Copy the datastore as well:</p> 
    <codeblock gutter="true" class="syntax shell">
      mv&amp;nbsp;crx-quickstart/repository/repository/datastore&amp;nbsp;crx-quickstart/repository/datastore 
    </codeblock></li> 
   <li><p>Next, you need to create the folder that will contain the OSGi configurations that will be used with the new upgraded instance. More specifically, a folder named install needs to be created under <strong>crx-quickstart</strong>.<br /> </p> </li> 
   <li><p>Now, create the node store and data store that will be used with AEM 6.3. You can do this by creating two files with the following names under <strong>crx-quickstart\install</strong>:</p> 
    <ul> 
     <li><span class="code"> org.apache.jackrabbit.oak.segment.SegmentNodeStoreService.cfg</span><br /> </li> 
     <li><span class="code">org.apache.jackrabbit.oak.plugins.blob.datastore.FileDataStore.cfg</span></li> 
    </ul> <p>These two files will configure AEM to use a TarMK node store and a File data store.</p> </li> 
   <li><p>Edit the configuration files to make them ready for use. More specifically:</p> 
    <ul> 
     <li> Add the following line to <strong>org.apache.jackrabbit.oak.segment.SegmentNodeStoreService.config</strong>:<br /> <span class="code">customBlobStore=true</span><br /> </li> 
     <li>Then add the following lines to <strong>org.apache.jackrabbit.oak.plugins.blob.datastore.FileDataStore.config</strong>:<br /> <code class="code">path=./crx-quickstart/repository/datastore
       <discoiqbr /> minRecordLength=4096</code><br /> </li> 
    </ul> </li> 
   <li><p>Remove the crx2 runmode by running:<br /> </p> 
    <codeblock gutter="true" class="syntax shell">
      find&amp;nbsp;crx-quickstart/launchpad&amp;nbsp;-type&amp;nbsp;f&amp;nbsp;-name&amp;nbsp;"sling.options.file"&amp;nbsp;-exec&amp;nbsp;rm&amp;nbsp;-rf&amp;nbsp;{}&amp;nbsp;\ 
    </codeblock></li> 
   <li><p>You now need to change the run modes in the AEM 6.3 war file. In order to do that, first create a temporary folder that will be housing the AEM 6.3 war. The name of the folder in this example will be <strong>temp</strong>. Once the war file has been copied over, extract its contents by running from inside the temp folder:<br /> </p> 
    <codeblock gutter="true" class="syntax shell">
      jar&amp;nbsp;xvf&amp;nbsp;aem-quickstart-6.3.0.war 
    </codeblock></li> 
   <li><p>Once the contents have been extracted, go to the <strong>WEB-INF</strong> folder and edit the <span class="code">web.xml</span> file to change the run modes. To find the location where they are set in the XML, look for the <span class="code">sling.run.modes</span> string. Once you find it, change the run modes in the next line of code, which by default is set to author:<br /> </p> 
    <codeblock gutter="true" class="syntax shell">
      &lt;param-value&amp;nbsp;&gt;author&lt;/param-value&gt; 
    </codeblock></li> 
   <li><p>Change the above author value and set the run modes to: author,crx3,crx3tar The final block of code should look like this: <br /> </p> 
    <codeblock gutter="true" class="syntax plain">
      &lt;init-param&gt;!!discoiqbr!!&lt;param-name&gt;sling.run.modes&lt;/param-name&gt;!!discoiqbr!!&lt;param-value&gt;author,crx3,crx3tar&lt;/param-value&gt;!!discoiqbr!!&lt;/init-param&gt;!!discoiqbr!!&lt;load-on-startup&gt;100&lt;/load-on-startup&gt;!!discoiqbr!!&lt;/servlet&gt; 
    </codeblock></li> 
   <li><p>Recreate the jar with the modified contents:<br /> </p> 
    <codeblock gutter="true" class="syntax shell">
      jar&amp;nbsp;cvf&amp;nbsp;aem62.war 
    </codeblock></li> 
   <li><p>Finally, deploy the new war file:<br /> </p> 
    <codeblock gutter="true" class="syntax shell">
      cp&amp;nbsp;temp/aem62.war&amp;nbsp;jboss-install-folder/standalone/deployments/aem61.war 
    </codeblock></li> 
  </ol> 
 </body> 
</html>