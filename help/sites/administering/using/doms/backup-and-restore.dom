<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
  <meta content="2018-04-03T07:01:52.258-0400" name="cq:lastReplicated" /> 
  <meta content="utf-8" name="Encoding" /> 
  <meta content="2018-04-26T10:14:05.430-0400" name="locHandOffDate" /> 
  <meta content="false" name="isReadyForLocalization" /> 
  <meta content="2018-04-03T07:01:49.900-0400" name="publishExternalDate" /> 
  <meta content="" name="jcr:versionHistory" /> 
  <meta content="/apps/docsdaycom/templates/standarddocpage" name="Template" /> 
  <meta content="mix:versionable" name="jcr:mixinTypes" /> 
  <meta content="Guillaume Carlino" name="contentOwner" /> 
  <meta content="2017-10-31T16:25:45.356-0400" name="firstPublishExternalDate" /> 
  <meta content="Backup and Restore" name="seoTitle" /> 
  <meta content="" name="jcr:baseVersion" /> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="carlino" name="cq:lastReplicatedBy" /> 
  <meta content="https://helpx.adobe.com/experience-manager/6-4/sites/administering/using/backup-and-restore.html" name="publishExternalURL" /> 
  <meta content="true" name="jcr:isCheckedOut" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES;topic_tags:operations;content_type:reference" name="cq:tags" /> 
  <meta content="Activate" name="cq:lastReplicationAction" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="/content/help/en/experience-manager/6-4/sites/administering/morehelp/operations;/content/help/en/experience-manager/6-4/sites/administering/morehelp/operations" name="moreHelpPaths" /> 
  <meta content="78ff3f4e-91d4-49b5-a7ac-53abd5893ffb" name="jcr:uuid" /> 
  <meta content="2017-10-12T21:46:58.665-0400" name="qaDate" /> 
  <meta content="14.01.2009 16:51:25 [alvawb]" name="CmgrLastModified" /> 
  <meta content="" name="jcr:primaryType" /> 
  <meta content="Learn how to backup and restore your AEM content." name="seoDescription" /> 
  <meta content="/content/docs/en/aem/6-3/administer/operations/backup-and-restore" name="qaNotes" /> 
  <meta content="2017-12-01T19:06:31.085-0500" name="jcr:created" /> 
  <meta content="6112a8ba-7149-4f97-a897-8af48b656a6d" name="jcr:predecessors" /> 
  <meta content="Backup and Restore" name="navTitle" /> 
  <meta content="carlino" name="cq:lastModifiedBy" /> 
  <meta content="carlino@adobe.com" name="lr_lastReplicatedBy" /> 
  <meta content="Backup and Restore" name="jcr:title" /> 
  <meta content="true" name="converted" /> 
  <meta content="audience:administering" name="primaryAudienceTag" /> 
  <meta content="2017-10-12T21:46:58.665-0400" name="mwpw_migration_script_version" /> 
  <meta content="2018-04-03T07:01:49.900-0400" name="topicBrowsingSortDate" /> 
  <meta content="2018-04-26T10:14:05.430-0400" name="cq:lastModified" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES" name="primaryProductTag" /> 
  <meta content="2018-04-03T07:01:49.900-0400" name="lastPublishExternalDate" /> 
 </head> 
 <body> 
  <p>There are two ways to back up and restore repository content in AEM: </p> 
  <ul> 
   <li>You can create an external backup of the repository and store it in a safe location. If the repository breaks down, you can restore it to the previous state.</li> 
   <li>You can create internal versions of the repository content. These versions are stored in the repository along with the content, so you can quickly restore nodes and trees you have changed or deleted.</li> 
  </ul> 
  <h3>General</h3> 
  <p>The approach described here applies for system backup and recovery.</p> 
  <p>If you need to backup and/or recover a small amount of content, which is lost, a recovery of the system is not necessarily required:</p> 
  <ul> 
   <li>Either you can fetch the data from another system via a package</li> 
   <li>or you restore the backup on a temporary system, create a content package and deploy it on the system, where this content is missing.</li> 
  </ul> 
  <p>For details, see <a href="../../../sites/administering/using/backup-and-restore.md#packagebackup">Package Backup</a> below.<br /> </p> 
  <h3>Timing</h3> 
  <p>Do not run backup in parallel with the datastore garbage collection, as it might harm the results of both processes.</p> 
  <p> </p> 
  <h2>Offline Backup</h2> 
  <p>You can always do an offline backup. This requires a downtime of AEM, but can be quite efficient in terms of required time compared to an online backup.</p> 
  <p>In most cases you will use a filesystem snapshot to create a read-only copy of the storage at that time. To create a offline backup perform these steps:</p> 
  <ul> 
   <li>stop the application<br /> </li> 
   <li>make a snapshot backup</li> 
   <li>start the application<br /> </li> 
  </ul> 
  <p>As the snapshot backup usually takes only a few seconds, the entire downtime is less than a few minutes.</p>  
  <h2>Online Backup</h2> 
  <p>This backup method creates a backup of the entire repository, including any applications deployed under it, such as AEM. The backup includes content, version history, configuration, software, hotfixes, custom applications, log files, search indexes, and so on. If you are using clustering and if the shared folder is a subdirectory of <span class="code">crx-quickstart</span> (either physically, or using a softlink), the shared directory is also backed up.<br /> </p> 
  <p>You can restore the entire repository (and any applications) at a later point.</p> 
  <p>This method operates as a "hot" or "online" backup so it can be performed while the repository is running. Therefore the repository is usable while the backup is running. This method works for the default, Tar storage based, repository instances.</p> 
  <p>When creating a backup, you have the following options:</p> 
  <ul> 
   <li>Backing up to a directory using AEM's integrated backup tool.<br /> </li> 
   <li>Backing up to a directory using a filesystem snapshot</li> 
  </ul> 
  <p>In any case, the backup creates an image (or snapshot) of the repository. Then the systems backup agent should take care to actually transfer this image to a dedicated backup system (tape drive).<br /> </p> 
  <note> 
   <p>If AEM Online Backup feature is used on an AEM instance which has a custom blobstore configuration, it is recommended to configure the path of datastore to be outside the "<span class="code">crx-quickstart</span>" directory and backup the datastore separately.</p> 
  </note> 
  <note> 
   <p>The online backup only backs up the file system. If you store the repository content and/or the repository files in a database, that database needs to backed up separately. If you are using AEM with MongoDB, see documentation on how to use the <a href="http://docs.mongodb.org/manual/tutorial/backup-with-mongodump/">MongoDB native backup tools</a>.</p> 
  </note> 
  <h3>AEM Online Backup</h3> 
  <p>An online backup of your repository lets you create, download, and delete backup files. It is a "hot" or "online" backup feature, so can be executed while the repository is being used normally in the read-write mode.</p> 
  <note> 
   <p>Do not run AEM Online Backup concurrently with <a href="../../../sites/administering/using/data-store-garbage-collection.md" target="_blank">Datastore Garbage Collection</a> or <a href="../../../sites/deploying/using/storage-elements-in-aem-6.md#performingofflinerevisioncleanup" target="_blank">Revision Cleanup</a>. It will negatively affect the system performance.</p> 
  </note> 
  <p>When starting a backup you can specify a<strong> Target Path</strong> and/or a <strong>Delay</strong>.</p> 
  <p><strong>Target Path</strong> The backup files are usually saved in the parent folder of the folder holidng the quickstart jar file (.jar). For example, if you have the AEM jar file located under /InstallationKits/AEM, then the backup will be generated under /InstallationKits. You can also specify a target to a location of your choice.</p> 
  <p>If the <strong>TargetPath</strong> is a directory, the image of the repository is created in this directory. If the same directory is used multiple times (or always) to storing backup,</p> 
  <ul> 
   <li>modified files in the repository are modified accordingly in the TargetPath</li> 
   <li>deleted files in the repository are deleted in the TargetPath</li> 
   <li>created files in the repository are created in the TargetPath</li> 
  </ul> 
  <note> 
   <p>If <strong>TargetPath</strong> is set to filename with the extension <strong>.zip</strong>, the repository is backed up to a temporary directory and then the content of this temporary directory is compressed and stored in the ZIP file.</p> 
   <p>This approach is discouraged, because</p> 
   <ul> 
    <li>it requires additional disk storage during the backup process (temporary directory plus the zip file)</li> 
    <li>the compression process is done by the repository and might influence its performance.</li> 
    <li>It delays the backup process.</li> 
    <li>Up to Java 1.6 Java is only able to create ZIP files up to a size of 4 gigabytes.</li> 
   </ul> 
   <p>If you need to create a ZIP as backup format, you should backup to a directory and then use a compression program to create the zip file.<br /> </p> 
  </note> 
  <p><strong>Delay</strong> Indicates a time delay (in milliseconds), so that repository performance is not affected. By default, the repository backup runs at full speed. You can slow down creating an online backup, so that it does not slow down other tasks.</p> 
  <p>When using a very large delay, ensure that online backup does not take more than 24 hours. If it did, discard this backup, as it may not contain all binaries.<br /> A delay of 1 millisecond typically results in 10% CPU usage, and a delay of 10 milliseconds usually results in less than 3% CPU usage. The total delay in seconds can be estimated as follows: Repository size in MB, multiplied by delay in milliseconds, divided by 2 (if the zip option is used), or divided by 4 (when backing up to a directory). That means a backup to a directory of a 200 MB repository with 1 ms delay increases the backup time by about 50 seconds.</p> 
  <note> 
   <p> See <a href="#howaemonlinebackupworks">How AEM Online Backup Works</a> for internal details of the process.<br /> </p> 
  </note> 
  <p>To create a backup:</p> 
  <ol> 
   <li><p>Log in to AEM as the administrator.<br /> </p> </li> 
   <li><p>Go to <strong>Tools - Operations - Backup.</strong></p> </li> 
   <li><p>Click <strong>Create</strong>. The backup console will open.</p> <img imageRotate="0" src="assets/chlimage_1-2.png" /></li> 
   <li><p>On the backup console, specify the <strong><a href="#targetpath">Target Path</a></strong> and <strong><a href="#path">Delay</a></strong>.</p> <img imageRotate="0" src="assets/chlimage_1-3.png" /> 
    <note> 
     <p>The backup console is also available using:<br /> </p> 
     <p><span class="code"> http://&amp;lt;<i>hostname</i>&amp;gt;:&amp;lt;<i>port-number</i>&amp;gt;/libs/granite/backup/content/admin.html</span></p> 
    </note></li> 
   <li><p>Click <strong>Save</strong>, a progress bar will indicate the progress of the backup.<br /> </p> 
    <note> 
     <p>You can <strong>Cancel</strong> a running backup at any time.</p> 
    </note></li> 
   <li><p>When the backup is complete, the zip files are listed in the backup window.</p> <img imageRotate="0" src="assets/chlimage_1-4.png" /> 
    <note> 
     <p>Backup files that are no longer needed can be removed using the console. Select the backup file in the left pane then click <strong>Delete</strong>.</p> 
    </note> 
    <note> 
     <p>If you have backed up to a directory: after the backup process is finished AEM will not write to the target directory.</p> 
    </note> </li> 
  </ol> 
  <h3>Automating AEM Online Backup</h3> 
  <p>If possible, the online backup should be run when there is little load on the system, for example in the morning. </p> 
  <p>Backups can be automated using the <span class="code">wget</span> or <span class="code">curl</span> HTTP clients. The following show examples of how to automate backup by using curl.</p> 
  <h4>Backing up to the default Target Directory</h4> 
  <note> 
   <p>In the following example various parameters in the <span class="code">curl</span> command might need to be configured for your instance; for example, the hostname (<span class="code">localhost</span>), port (<span class="code">4502</span>), admin password (<span class="code">xyz</span>) and file name (<span class="code">backup.zip</span>).<br /> </p> 
  </note> 
  <codeblock gutter="true" class="syntax shell">
    curl&amp;nbsp;-u&amp;nbsp;admin:admin&amp;nbsp;-X&amp;nbsp;POST&amp;nbsp;http://localhost:4502/system/console/jmx/com.adobe.granite:type=Repository/op/startBackup/java.lang.String?target=backup.zip 
  </codeblock> 
  <p>The backup file/directory is created on the server in the parent folder of the folder containing the <span class="code">crx-quickstart</span> folder (the same as if you were creating the backup using the browser). For example, if you have installed AEM in the directory <span class="code">/InstallationKits/crx-quickstart/</span>, then the backup is created in the <span class="code">/InstallationKits</span> directory.</p> 
  <p>The curl command returns immediately, so you must monitor this directory to see when the zip file is ready. While the backup is being created a temp directory (with the name based on that of the final zip file) can be seen, at the end this will be zipped. For example:</p> 
  <ul> 
   <li>name of resulting zip file: <span class="code">backup.zip</span></li> 
   <li>name of temporary directory: <span class="code">backup.f4d5.temp</span></li> 
  </ul> 
  <h4>Backing up to a non-default Target Directory</h4> 
  <p>Usually the backup file/directory is created on the server in the parent folder of the folder containing the <span class="code">crx-quickstart</span> folder.</p> 
  <p>If you want to save your backup (of either sort) to a different location you can set an absolute path <span class="code"></span>to the <span class="code">target</span> parameter in the <span class="code">curl</span> command.<br /> </p> 
  <p>For example, to generate <span class="code">backupJune.zip</span> in the directory <span class="code">/Backups/2012</span>:</p> 
  <codeblock gutter="true" class="syntax shell">
    curl&amp;nbsp;-u&amp;nbsp;admin:admin&amp;nbsp;-X&amp;nbsp;POST&amp;nbsp;http://localhost:4502/system/console/jmx/com.adobe.granite:type=Repository/op/startBackup/java.lang.String?target=/Backups/2012/backupJune.zip"!!discoiqbr!! 
  </codeblock> 
  <note> 
   <p>When using a different application server (such as JBoss), the online backup may not work as expected, because the target directory is not writable. In this case, please contact Support.</p> 
  </note> 
  <note> 
   <p>A backup can also be triggered <a href="../../../sites/administering/using/jmx-console.md#startbackup" target="_blank">using the MBeans provided by AEM</a>.</p> 
  </note> 
  <h3>Filesystem Snapshot Backup</h3> 
  <p>The process described here is specially suited for large repositories.</p> 
  <note> 
   <p>If you want to use this backup approach, your system must support filesystem snapshots. For example, for Linux this means your filesystems should be placed on a logical volume.<br /> </p> 
  </note> 
  <ol> 
   <li><p>Do a snapshot of the filesystem AEM is deployed on.<br /> </p> </li> 
   <li><p>Mount the filesystem snapshot.</p> </li> 
   <li><p>Perform a backup and unmount the snapshot.</p> </li> 
  </ol>      
  <h3>How AEM Online Backup Works</h3> 
  <p>AEM Online Backup is comprised of a series of internal actions to ensure the integrity of the data being backed up and the backup file(s) being created. These are listed below for those interested.<br /> </p> 
  <p>The online backup uses the following algorithm:</p> 
  <ol> 
   <li>When creating a zip file, the first step is to create or locate the target directory.<br /> 
    <ul> 
     <li>If backing up to a zip file, a temporary directory is created. The directory name starts with <span class="code">backup.</span> and ends with <span class="code">.temp</span>; for example <span class="code">backup.f4d3.temp</span>.</li> 
     <li>If backing up to a directory, the name specified in the target path is used. An existing directory can be used, otherwise a new directory will be created.<br /> An empty file named <span class="code">backupInProgress.txt</span> is created in the target directory when the backup starts. This file is deleted when the backup is finished.</li> 
    </ul> </li> 
   <li>The files are copied from the source directory to the target directory (or temporary directory when creating a zip file). The segmentstore is copied before the datastore to avoid repository corruption. The index and cache data are omitted when creating the backup. As a result, data from <span class="code">crx-quickstart/repository/cache</span> and <span class="code">crx-quickstart/repository/index</span> is not included in the backup. The progress bar indicator of the process is between 0% - 70% when creating a zip file, or 0% - 100% if no zip file is created. </li> 
   <li>If the backup is being made to a pre-existing directory, then "old" files in the target directory are deleted. Old files are files that do not exist in the source directory.</li> 
  </ol> 
  <p>The files are copied to the target directory in four stages:</p> 
  <ol> 
   <li>In the first copy stage (progress indicator 0% - 63% when creating a zip file or 0% - 90% if no zip file is created), all files are copied while the repository is running normally. The process has two phases: 
    <ul> 
     <li>Phase A - everything is copied except for the datastore (with delay).</li> 
     <li>Phase B - only the datastore is copied (with delay).</li> 
    </ul> </li> 
   <li>In the second copy stage (progress indicator 63% - 65.8% when creating a zip file or 90% - 94% if no zip file is created) only files that were created or modified in the source directory since the first copy stage was started are copied. Depending on the activity of the repository, this might range from no files at all, up to a significant number of files (because the first file copy stage usually takes a lot of time). The copy process is similar to the first stage (Phase A and Phase B with delay).</li> 
   <li>In the third copy stage (progress indicator 65.8% - 68.6% when creating a zip file or 94% - 98% if no zip file is created) only files that were created or modified in the source directory since the second copy stage was started are copied. Depending on the activity of the repository, there might be no files to copy, or a very small number of files (because the second file copy stage is usually fast). The copy process is similar to the second stage - Phase A and Phase B but without delay.</li> 
   <li>File copy stages one to three are all done concurrently while the repository is running. Only files that were created or modified in the source directory since the third copy stage was started are copied. Depending on the activity of the repository, there might be no files to copy, or a very, very small number of files (because the second file copy stage usually is very fast). Progress indicator 68.6% - 70% when creating a zip file or 98% - 100% if no zip file is created. The copy process is similar to the third stage.</li> 
   <li>Depending on the target: 
    <ul> 
     <li>If a zip file was specified, this is now created from the temporary directory. Progress indicator 70% - 100%. The temporary directory is then deleted.</li> 
     <li>If the target was a directory, the empty file named <span class="code">backupInProgress.txt</span> is deleted to indicate that the backup is finished.</li> 
    </ul> </li> 
  </ol>   
  <h2>Restoring the Backup</h2>  
  <p>You can restore a backup as follows:</p> 
  <ul> 
   <li>In case you performed a Filesystem Snapshot Backup, you can simply restore an image of the system.</li> 
   <li>In case you created the backup as a zip file, just unzip the contents in a new folder and start AEM from that location.</li> 
  </ul>     
  <h2>Package Backup</h2> 
  <p>To back up and restore content, you can use one of the Package Manager, which uses the Content Package format to back up and restore content. The Package Manager provides more flexibility in defining and managing packages.<br /> </p> 
  <p>For details on the features and tradeoffs of each of these individual content package formats, see <a href="../../../sites/administering/using/package-manager.md" target="_blank">How to Work With Packages</a>.</p> 
  <h3>Scope of Backup</h3> 
  <p>When you back up nodes using either the Package Manager or the Content Zipper, CRX saves the following information: </p> 
  <ul> 
   <li>The repository content below the tree you have selected.</li> 
   <li>The Node type definitions that are used for the content you back up.</li> 
   <li>The Namespace definitions that are used for the content you back up.</li> 
  </ul> 
  <p>When backing up, AEM loses the following information: </p> 
  <ul> 
   <li>The version history.</li> 
  </ul>       
 </body> 
</html>