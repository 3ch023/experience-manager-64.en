<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="aheimoz" name="cq:lastModifiedBy" /> 
  <meta content="2017-10-31T16:16:47.943-0400" name="firstPublishExternalDate" /> 
  <meta content="2018-06-28T10:23:21.002-0400" name="cq:lastReplicated" /> 
  <meta content="" name="jcr:versionHistory" /> 
  <meta content="/content/docs/en/aem/6-3/develop/extending/sitecatalyst/sc-framework" name="qaNotes" /> 
  <meta content="2018-06-28T10:23:20.953-0400" name="topicBrowsingSortDate" /> 
  <meta content="audience:developing" name="primaryAudienceTag" /> 
  <meta content="bbe6315f-3dff-4318-a2ba-4b89ba3b7ea6" name="jcr:uuid" /> 
  <meta content="2017-10-12T21:46:00.000-0400" name="qaDate" /> 
  <meta content="2018-06-28T10:23:20.953-0400" name="publishExternalDate" /> 
  <meta content="2017-12-01T19:05:43.237-0500" name="jcr:created" /> 
  <meta content="Activate" name="cq:lastReplicationAction" /> 
  <meta content="225859ec-be18-4a04-8f5a-a5079292fb07" name="jcr:predecessors" /> 
  <meta content="Customizing the Adobe Analytics Framework" name="seoTitle" /> 
  <meta content="" name="jcr:primaryType" /> 
  <meta content="true" name="jcr:isCheckedOut" /> 
  <meta content="2018-06-28T10:23:20.953-0400" name="lastPublishExternalDate" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="aheimoz" name="cq:lastReplicatedBy" /> 
  <meta content="2018-05-08T12:43:09.485-0400" name="locHandOffDate" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
  <meta content="2018-06-28T10:23:20.962-0400" name="cq:lastModified" /> 
  <meta content="User" name="contentOwner" /> 
  <meta content="/content/help/en/experience-manager/6-4/sites/developing/morehelp/extending-aem;/content/help/en/experience-manager/6-4/sites/developing/morehelp/extending-aem" name="moreHelpPaths" /> 
  <meta content="" name="jcr:baseVersion" /> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
  <meta content="Customizing the Adobe Analytics Framework" name="navTitle" /> 
  <meta content="Customizing the Adobe Analytics Framework" name="jcr:title" /> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES" name="primaryProductTag" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES;topic_tags:extending-aem;content_type:reference" name="cq:tags" /> 
  <meta content="2017-10-12T21:46:58.665-0400" name="mwpw_migration_script_version" /> 
  <meta content="aheimoz@adobe.com" name="lr_lastReplicatedBy" /> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="https://helpx.adobe.com/experience-manager/6-4/sites/developing/using/extending-analytics-framework.html" name="publishExternalURL" /> 
  <meta content="mix:versionable" name="jcr:mixinTypes" /> 
 </head> 
 <body> 
  <p>The Adobe Analytics framework determines the information that is tracked with Adobe Analytics. To customize the default framework, you use javascript to add custom tracking, integrate Adobe Analytics plugins, and change general settings within the framework used for tracking.</p> 
  <h3>About the Generated javascript for Frameworks</h3> 
  <p>When a page is associated with a Adobe Analytics framework, and the page includes <a href="../../../sites/administering/using/adobeanalytics.md#main-pars-title-25">references to the Analytics module</a>, a analytics.sitecatalyst.js file is automatically generated for the page. <br /> </p> 
  <p>The javascript in the page creates an <span class="code">s_gi </span>object (that the s_code.js Adobe Analytics library defines) and assigns values to its properties. The name of the object instance is <span class="code">s</span>. The code examples that are presented in this section makes several references to this <span class="code">s</span> variable. </p> 
  <p>The following example code is similar to the code in an analytics.sitecatalyst.js file:</p> 
  <codeblock gutter="true" class="syntax js">
    var&amp;nbsp;s_account&amp;nbsp;=&amp;nbsp;"my_sitecatalyst_account";!!discoiqbr!!var&amp;nbsp;s&amp;nbsp;=&amp;nbsp;s_gi(s_account);!!discoiqbr!!s.fpCookieDomainPeriods&amp;nbsp;=&amp;nbsp;"3";!!discoiqbr!!s.currencyCode=&amp;nbsp;'USD';!!discoiqbr!!s.trackInlineStats=&amp;nbsp;true;!!discoiqbr!!s.linkTrackVars=&amp;nbsp;'None';!!discoiqbr!!s.charSet=&amp;nbsp;'UTF-8';!!discoiqbr!!s.linkLeaveQueryString=&amp;nbsp;false;!!discoiqbr!!s.linkExternalFilters=&amp;nbsp;'';!!discoiqbr!!s.linkTrackEvents=&amp;nbsp;'None';!!discoiqbr!!s.trackExternalLinks=&amp;nbsp;true;!!discoiqbr!!s.linkDownloadFileTypes=&amp;nbsp;'exe,zip,wav,mp3,mov,mpg,avi,wmv,doc,pdf,xls';!!discoiqbr!!s.linkInternalFilters=&amp;nbsp;'javascript:,'+window.location.hostname;!!discoiqbr!!s.trackDownloadLinks=&amp;nbsp;true;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;!!discoiqbr!!s.visitorNamespace&amp;nbsp;=&amp;nbsp;"mynamespace";!!discoiqbr!!s.trackingServer&amp;nbsp;=&amp;nbsp;"xxxxxxx.net";!!discoiqbr!!s.trackingServerSecure&amp;nbsp;=&amp;nbsp;"xxxxxxx.net";!!discoiqbr!!!!discoiqbr!!/*&amp;nbsp;Plugin&amp;nbsp;Config&amp;nbsp;*/!!discoiqbr!!/*!!discoiqbr!!s.usePlugins=false;!!discoiqbr!!function&amp;nbsp;s_doPlugins(s)&amp;nbsp;{!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//add&amp;nbsp;your&amp;nbsp;custom&amp;nbsp;plugin&amp;nbsp;code&amp;nbsp;here!!discoiqbr!!}!!discoiqbr!!s.doPlugins=s_doPlugins;!!discoiqbr!!*/ 
  </codeblock> 
  <p>When you use custom javascript code to customize the framework, you alter the content of this file.</p> 
  <h3>Configuring Adobe Analytics Properties</h3> 
  <p>There are a number of predefined variables within Adobe Analytics that are configurable on a framework<strong>. </strong>The <strong>charset</strong>, <strong>cookieLifetime</strong>, <strong>currencyCode</strong> and <strong>trackInlineStats</strong> variables are included in the <strong>General Analytics Settings</strong> list by default.</p> 
  <img imageRotate="0" src="assets/aa-22.png" />  
  <p>You can add variable names and values to the list. These predefined variables and any variables that you add are used to configure the properties of the <span class="code">s</span> object in the analytics.sitecatalyst.js file. The following example shows how the added <span class="code">prop10</span> property of value <span class="code">CONSTANT</span> is represented in the javascript code:</p> 
  <codeblock gutter="true" class="syntax js">
    var&amp;nbsp;s_account&amp;nbsp;=&amp;nbsp;"my_sitecatalyst_account";!!discoiqbr!!var&amp;nbsp;s&amp;nbsp;=&amp;nbsp;s_gi(s_account);!!discoiqbr!!s.fpCookieDomainPeriods&amp;nbsp;=&amp;nbsp;"3";!!discoiqbr!!s.currencyCode=&amp;nbsp;'USD';!!discoiqbr!!s.trackInlineStats=&amp;nbsp;true;!!discoiqbr!!s.linkTrackVars=&amp;nbsp;'None';!!discoiqbr!!s.charSet=&amp;nbsp;'UTF-8';!!discoiqbr!!s.linkLeaveQueryString=&amp;nbsp;false;!!discoiqbr!!s.linkExternalFilters=&amp;nbsp;'';!!discoiqbr!!s.linkTrackEvents=&amp;nbsp;'None';!!discoiqbr!!s.trackExternalLinks=&amp;nbsp;true;!!discoiqbr!!s.linkDownloadFileTypes=&amp;nbsp;'exe,zip,wav,mp3,mov,mpg,avi,wmv,doc,pdf,xls';!!discoiqbr!!s.prop10=&amp;nbsp;'CONSTANT';!!discoiqbr!!s.linkInternalFilters=&amp;nbsp;'javascript:,'+window.location.hostname;!!discoiqbr!!s.trackDownloadLinks=&amp;nbsp;true;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;!!discoiqbr!!s.visitorNamespace&amp;nbsp;=&amp;nbsp;"mynamespace";!!discoiqbr!!s.trackingServer&amp;nbsp;=&amp;nbsp;"xxxxxxx.net";!!discoiqbr!!s.trackingServerSecure&amp;nbsp;=&amp;nbsp;"xxxxxxx.net"; 
  </codeblock> 
  <p>Use the following procedure to add variables to the list:</p> 
  <ol> 
   <li>On your Adobe Analytics framework page, expand the <strong>General Analytics Settings</strong> area.</li> 
   <li>Below the list of variables, click Add Item to add a new variable to the list.</li> 
   <li>In the left-hand cell, enter a name<strong> </strong>for the variable, for example <span class="code">prop10</span>.</li> 
   <li>In the right-hand column, enter a value<strong> </strong>for the variable, for example <span class="code">CONSTANT</span>.</li> 
   <li>To remove a variable, click the (-) button next to the variable.</li> 
  </ol> 
  <note> 
   <p>When entering variables and values, make sure they are correctly formatted and spelled, or the <strong>calls will not be sent</strong> with the correct value/variable pair. Misspelled variables and values can even prevent calls from occurring.</p> 
   <p>Consult with your Adobe Analytics representative to make sure these variables are correctly set.</p> 
  </note> 
  <note> 
   <p>Some of the variables in this list are <strong>mandatory</strong> in order for Adobe Analytics calls to function correctly, (e.g. <strong>currencyCode</strong>, <strong>charSet</strong>)</p> 
   <p>So, even if they are removed from the framework itself, they will still be attached with a default value when the Adobe Analytics call is made.</p> 
  </note> 
  <h3>Adding custom javascript to an Adobe Analytics Framework</h3> 
  <p>The free-from javascript box in the <strong>General Analytics Settings</strong> area enables you to add custom code to a Adobe Analytics framework. </p> 
  <img imageRotate="0" src="assets/aa-21.png" /> 
  <p>The code that you add is appended to the analytics.sitecatalyst.js file. Therefore, you can access the <span class="code">s</span> variable, which is an instance of the <span class="code">s_gi</span> javascript object that is defined in <span class="code">s_code.js</span>. For example, adding the following code is equivalent to adding a variable named <span class="code">prop10</span> of value <span class="code">CONSTANT</span>, which is the example in the previous section:</p> 
  <p><span class="code">s.prop10= 'CONSTANT';</span></p> 
  <p>The code in the <a href="../../../sites/developing/using/extending-analytics-components.md#includingthesitecatalystmoduleinapagecomponent">analytics.sitecatalyst.js</a> file (which includes the content of the Adobe Analytics <span class="code">s_code.js</span> file) contains the following code:</p> 
  <p><span class="code">if (s.usePlugins) s.doPlugins(s)</span></p> 
  <p>The following procedure demonstrates how to use the javascript box to customize Adobe Analytics tracking. If your javascript needs to use Adobe Analytics plugins, <a href="../../../sites/administering/using/adobeanalytics.md#main-pars-title-29">integrate them</a> into AEM.<br /> </p> 
  <ol> 
   <li><p>Add the following javascript code to the box so that <span class="code">s.doPlugins</span> is executed:</p> 
    <codeblock gutter="true" class="syntax js">
      s.usePlugins=true;!!discoiqbr!!function&amp;nbsp;s_doPlugins(s)&amp;nbsp;{!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//add&amp;nbsp;your&amp;nbsp;custom&amp;nbsp;code&amp;nbsp;here!!discoiqbr!!}!!discoiqbr!!s.doPlugins=s_doPlugins; 
    </codeblock> 
    <note> 
     <p>This code is necessary if you want to send variables in a Adobe Analytics call that have been customized in some way that cannot be done through the basic drag&amp;drop interface OR through inline javascript in Adobe Analytics View.<br /> <br /> If the custom variables are outside of the s_doPlugins function they will be sent as <em>undefined </em>in the Adobe Analytics call<br /> </p> 
    </note></li> 
   <li><p>Add your javascript code in the <strong>s_doPlugins</strong> function.</p> </li> 
  </ol> 
  <p>The following example concatenates the data captured on a page in hierarchical order, using a common separator of “|”.</p> 
  <p>A Adobe Analytics framework has the following configruations:</p> 
  <ul> 
   <li>The <span class="code">prop2</span> Adobe Analytics variable is mapped to the <span class="code">pagedata.sitesection</span> site property.</li> 
   <li>The <span class="code">prop3</span> Adobe Analytics variable is mapped to the <span class="code">pagedata.subsection</span> site property.</li> 
   <li>The following code is added to the free-from javascript box: </li> 
   <li>When the webpage that uses the framework is visited (or, in edit mode the page is reloaded or previewed), the calls to Adobe Analytics are performed.</li> 
  </ul> 
  <p>For example, the following values are generated in Adobe Analytics:</p> 
  <img imageRotate="0" src="assets/aa-20.png" />  
  <h3>Adding Global Custom Code for All Adobe Analytics Frameworks</h3> 
  <p>Provide custom javascript code that is integrated into all Adobe Analytics frameworks. When a page's Adobe Analytics framework contains no custom <a href="../../../sites/administering/using/adobeanalytics.md#main-pars-title-28">free-form javascript</a>, the javascript that the /libs/cq/analytics/components/sitecatalyst/config.js.jsp script generates is appended to the <a href="../../../sites/administering/using/adobeanalytics.md#main-pars-codelisting-sh">analytics.sitecatalyst.js</a> file. By default, the script has no effect because it is commented out. The code also sets <span class="code">s.usePlugins</span> to <span class="code">false</span>: </p> 
  <codeblock class="syntax js">
    /*&amp;nbsp;Plugin&amp;nbsp;Config&amp;nbsp;*/!!discoiqbr!!/*!!discoiqbr!!s.usePlugins=false;!!discoiqbr!!function&amp;nbsp;s_doPlugins(s)&amp;nbsp;{!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//add&amp;nbsp;your&amp;nbsp;custom&amp;nbsp;plugin&amp;nbsp;code&amp;nbsp;here!!discoiqbr!!}!!discoiqbr!!s.doPlugins=s_doPlugins;!!discoiqbr!!*/ 
  </codeblock> 
  <p>Code in the analytics.sitecatalyst.js file (which includes the content of the Adobe Analytics s_code.js file) contains the following code:</p> 
  <p>if (s.usePlugins) s.doPlugins(s)</p> 
  <p>Therefore, your javascript should set <span class="code">s.usePlugins</span> to <span class="code">true</span> so that any code in the <span class="code">s_doPlugins</span> function is executed. To customize the code, overlay the config.js.jsp file with one that uses your own javascript. If your javascript needs to use Adobe Analytics plugins, <a href="../../../sites/administering/using/adobeanalytics.md#main-pars-title-29">integrate them</a> into AEM.</p> 
  <note> 
   <p>Do not edit the /libs/cq/analytics/components/sitecatalyst/config.js.jsp file. Certain AEM upgrade or maintenance tasks can re-install the original file, removing your changes.</p> 
  </note> 
  <ol> 
   <li><p>In CRXDE Lite, create the /apps/cq/analytics/components folder structure:</p> 
    <ol> 
     <li>Right-click the /apps folder and click Create &amp;gt; Create Folder.</li> 
     <li>Specify <span class="code">cq</span> as the folder name, and click OK.</li> 
     <li>Similarly, create the <span class="code">analytics</span> and <span class="code">components</span> folders.<br /> </li> 
    </ol> </li> 
   <li><p>Right-click the <span class="code">components</span> folder that you just created and click Create &amp;gt; Create Component. Specify the following property values:</p> 
    <ul> 
     <li>Label: <span class="code">sitecatalyst</span></li> 
     <li>Title: <span class="code">sitecatalyst</span></li> 
     <li>Super Type:<span class="code"> /libs/cq/analytics/components/sitecatalyst</span></li> 
     <li>Group: <span class="code">hidden</span></li> 
    </ul> </li> 
   <li><p>Click Next repeatedly until the OK button is enabled, and then click OK.<br /> </p> <p>The sitecatalyst component contains the automatically-created sitecatalyst.jsp file.<br /> </p> </li> 
   <li><p>Right-click the sitecatalyst.jsp file and click Delete.<br /> </p> </li> 
   <li><p>Right-click the sitecatalyst component and click Create &amp;gt; Create File. Specify the name <span class="code">config.js.jsp</span> and then click OK.<br /> </p> <p>The config.js.jsp file opens automatically for editing.<br /> </p> </li> 
   <li><p>Add the following text to the file, and then click Save All:<br /> </p> 
    <codeblock class="syntax java">
      &lt;%@page&amp;nbsp;session="true"%&gt;!!discoiqbr!!/*&amp;nbsp;Plugin&amp;nbsp;Config&amp;nbsp;*/!!discoiqbr!!s.usePlugins=true;!!discoiqbr!!function&amp;nbsp;s_doPlugins(s)&amp;nbsp;{!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//add&amp;nbsp;your&amp;nbsp;custom&amp;nbsp;plugin&amp;nbsp;code&amp;nbsp;here!!discoiqbr!!}!!discoiqbr!!s.doPlugins=s_doPlugins; 
    </codeblock><p>The javascript code that the /apps/cq/analytics/components/sitecatalyst/config.js.jsp script generates is now inserted into the analytics.sitecatalyst.js file for all pages that use a Adobe Analytics framework.<br /> </p> </li> 
   <li><p>Add the javascript code that you want to execute in the <span class="code">s_doPlugins</span> function, and then click Save All.<br /> </p> </li> 
  </ol> 
  <note> 
   <p>If any text is present in the free-form javascript of a page's framework (even only whitespace), config.js.jsp is ignored. </p> 
  </note> 
  <h3>Using Adobe Analytics Plugins in AEM</h3> 
  <p>Obtain the javascript code for Adobe Analytics plugins and integrate them into your Adobe Analytics framework in AEM. Add the code to a client library folder of the category <span class="code">sitecatalyst.plugins</span> so that they are available to your custom javascript code.</p> 
  <p>For example, if you integrate the <span class="code">getQueryParams</span> plugin, you can call the plugin from the <span class="code">s_doPlugins</span> function of your custom javascript. The following example code sends the query string in <strong>"pid"</strong> from the referrer's URL as <strong>eVar1</strong>, when a Adobe Analytics call is triggered.</p> 
  <codeblock gutter="true" class="syntax js">
    s.usePlugins=true;!!discoiqbr!!function&amp;nbsp;s_doPlugins(s)&amp;nbsp;{!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;take&amp;nbsp;the&amp;nbsp;query&amp;nbsp;string&amp;nbsp;from&amp;nbsp;the&amp;nbsp;referrer!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;s.eVar1=s.getQueryParam('pid','',document.referrer);&amp;nbsp;!!discoiqbr!!}!!discoiqbr!!s.doPlugins=s_doPlugins; 
  </codeblock> 
  <p>AEM installs the following Adobe Analytics plugins, so that they are available by default:</p> 
  <ul> 
   <li>getQueryParam()</li> 
   <li>getPreviousValue()</li> 
   <li>split()</li> 
  </ul> 
  <p>The /libs/cq/analytics/clientlibs/sitecatalyst/plugins client library folder includes these plugins in the sitecatalyst.plugins category.<br /> </p> 
  <note> 
   <p>Create a new client library folder for your plugins. Do not add plugins to the <span class="code">/libs/cq/analytics/clientlibs/sitecatalyst/plugins</span> folder. This practice ensures that your contribution to the <span class="code">sitecatalyst.plugins</span> category are not overwritten during AEM re-installs or upgrade tasks.<br /><br /> </p> 
  </note> 
  <p>Use the following procedure to create the client library folder for your plugins. You only need to peform this procedure once. To add a plugin to the client library folder, use the subsequent procedure.<br /> </p> 
  <ol> 
   <li><p>In a web browser, open CRXDE Lite. (<a href="http://localhost:4502/crx/de">http://localhost:4502/crx/de</a>)<br /> </p> </li> 
   <li><p>Right-click the /apps/my-app/clientlibs folder and click Create &amp;gt; Create Node. Enter the following property values and then click OK:</p> 
    <ul> 
     <li>Name: A name for your client library folder, such as my-plugins<br /><br /> </li> 
     <li>Type: cq:ClientLibraryFolder<br /><br /> </li> 
    </ul> </li> 
   <li><p>Select the client library folder that you just created and use the bottom right-hand property bar to add the following property:</p> 
    <ul> 
     <li>Name: categories</li> 
     <li>Type: String</li> 
     <li>Value: sitecatalyst.plugins</li> 
     <li>Multi: selected</li> 
    </ul> <p>Click OK in the Edit window to confirm the property value.<br /> </p> </li> 
   <li><p>Right-click the client library folder that you just created and click Create &amp;gt; Create File. For the file name type js.txt, and then click OK.<br /> </p> </li> 
   <li><p>Click Save All.<br /> </p> </li> 
  </ol> 
  <p>Use the following procedure to obtain the plugin code, store the code in the AEM repository, and add the code to your client library folder. </p> 
  <ol> 
   <li><p>Log in to <a href="https://sc.omniture.com">sc.omniture.com</a> using your Adobe Analytics account.</p> </li> 
   <li><p>On the landing page go to Help &amp;gt; Help Home.</p> </li> 
   <li><p>In the table of contents on the left side, click Implementation Plug-ins.</p> </li> 
   <li><p>Click the link to the plugin that you want to add and when the page opens, locate the javascript source code for the plugin, then select the code and copy it.<br /> </p> </li> 
   <li><p>Right-click your client library folder, and click Create &amp;gt; Create File. For the file name, type the name of the plugin that you are integrating followed by .js, and then click OK. For example, if you are integrating the getQueryParam plugin, name the file getQueryParam.js.<br /> </p> <p>When you create the file, it opens for editing.<br /> </p> </li> 
   <li><p>Paste the plugin javascript code into the file, click Save All, and then close the file.<br /> </p> </li> 
   <li><p>Open the js.txt file from your client library folder.<br /> </p> </li> 
   <li><p>In a new line, add the name of the file that contains the plugin, for example getQueryParam.js. Then, click Save All and close the file.<br /> </p> </li> 
  </ol> 
  <note> 
   <p>When using plugins, make sure to integrate any supporting plugins as well, otherwise the plugin javascript will not recognize the calls that it makes to the functions in the supporting plugin. For example, the getPreviousValue() plugin requires the split() plugin to function correctly.<br /> <br /> The name of the support plugin needs to be added to<strong> js.txt </strong>as well.</p> 
   <p> </p> 
  </note> 
 </body> 
</html>