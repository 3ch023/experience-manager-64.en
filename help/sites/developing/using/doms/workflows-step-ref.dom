<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="Workflow Step Reference" name="jcr:title" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="" name="jcr:versionHistory" /> 
  <meta content="2017-10-12T21:46:58.665-0400" name="qaDate" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES;topic_tags:extending-aem;content_type:reference" name="cq:tags" /> 
  <meta content="/content/help/en/experience-manager/6-4/sites/developing/morehelp/extending-aem;/content/help/en/experience-manager/6-4/sites/developing/morehelp/extending-aem" name="moreHelpPaths" /> 
  <meta content="2018-06-27T13:20:09.388-0400" name="lastPublishExternalDate" /> 
  <meta content="jsyal" name="cq:lastReplicatedBy" /> 
  <meta content="trushton" name="cq:lastModifiedBy" /> 
  <meta content="User" name="contentOwner" /> 
  <meta content="5b2e1c77-f6c1-45bc-b534-7e6c530dbf3d" name="jcr:predecessors" /> 
  <meta content="audience:developing" name="primaryAudienceTag" /> 
  <meta content="https://helpx.adobe.com/experience-manager/6-4/sites/developing/using/workflows-step-ref.html" name="publishExternalURL" /> 
  <meta content="Workflow Step Reference" name="navTitle" /> 
  <meta content="remove-legacypath-6-1" name="jcr:lastModifiedBy" /> 
  <meta content="false" name="isReadyForLocalization" /> 
  <meta content="2018-10-27T23:47:57.247-0400" name="cq:lastReplicated" /> 
  <meta content="44fef80b-8d3b-46e4-8d18-7e3f489d226d" name="jcr:uuid" /> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="trushton@adobe.com" name="lr_lastReplicatedBy" /> 
  <meta content="2018-06-27T13:20:09.388-0400" name="topicBrowsingSortDate" /> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="2018-06-27T13:20:09.452-0400" name="cq:lastModified" /> 
  <meta content="mix:versionable" name="jcr:mixinTypes" /> 
  <meta content="/content/docs/en/aem/6-3/develop/extending/workflows/step-ref" name="qaNotes" /> 
  <meta content="2018-05-08T12:47:10.433-0400" name="locHandOffDate" /> 
  <meta content="" name="jcr:baseVersion" /> 
  <meta content="" name="jcr:primaryType" /> 
  <meta content="true" name="jcr:isCheckedOut" /> 
  <meta content="2018-03-09T08:02:14.042-0500" name="jcr:created" /> 
  <meta content="2017-10-12T21:46:58.665-0400" name="mwpw_migration_script_version" /> 
  <meta content="2017-10-31T16:15:39.765-0400" name="firstPublishExternalDate" /> 
  <meta content="2018-06-27T13:20:09.388-0400" name="publishExternalDate" /> 
  <meta content="Workflow Step Reference" name="seoTitle" /> 
  <meta content="Activate" name="cq:lastReplicationAction" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES" name="primaryProductTag" /> 
 </head> 
 <body> 
  <p>Workflow models consist of a series of steps of various types. According to the type, these steps can be configured and extended with parameters and scripts to provide the functionality and control you require.</p> 
  <note> 
   <p>This section covers the standard Workflow steps. </p> 
   <p>For module specific steps see also:</p> 
   <ul> 
    <li><a href="../../../forms/using/aem-forms-workflow-step-reference.md">AEM Forms Workflow Step Reference</a></li> 
    <li><a href="../../../assets/using/media-handlers.md">Processing Assets Using Media Handlers and Workflows</a></li> 
   </ul> 
  </note> 
  <h2>Step Properties</h2> 
  <p>Each step component has a <strong>Step Properties</strong> dialog that allows you to define and edit the required properties.</p> 
  <h4>Step Properties - Common tab</h4> 
  <p>A combination of the following properties are available for most workflow step components, on the <strong>Common</strong> tab of the properties dialog:</p> 
  <ul> 
   <li><strong>Title</strong><br /> The title for the step.</li> 
   <li><strong>Description</strong><br /> A description of the step.</li> 
   <li><strong>Workflow Stage<br /> </strong>A drop down selector to apply a <a href="../../../sites/developing/using/workflows.md#workflowstages">Stage</a> to the step.<br /> </li> 
   <li><strong>Timeout</strong><br /> The period after which the step will be "timed out".<br /> You can select between: <strong>Off</strong>, <strong>Immediate</strong>, <strong>1h</strong>, <strong>6h</strong>, <strong>12h</strong>, <strong>24h</strong>.</li> 
   <li><strong>Timeout Handler</strong><br /> The handler which will control the workflow when the step times out; for example:<br /> <span class="code">Auto Advancer</span></li> 
   <li><strong>Handler Advance</strong><br /> Select this option to automatically advance the workflow to the next step after execution. If not selected, the implementation script must handle workflow advancement.<br /> </li> 
  </ul> 
  <h4>Step Properties - User/Group tab</h4> 
  <p>The following properties are available for many workflow step components, on the <strong>User/Group</strong> tab of the properties dialog:</p> 
  <ul> 
   <li><strong>Notify user via email</strong> 
    <ul> 
     <li>You can notify participant(s) by sending them an email when the workflow reaches the step.</li> 
     <li>If enabled, an email will be sent to the user defined by the property <strong>User/Group</strong> or to each member of the group if a group is defined.</li> 
    </ul> </li> 
   <li><strong>User/Group</strong> 
    <ul> 
     <li>A drop down selection box will allow you to navigate and select a user or group.<br /> </li> 
     <li>If you assign the step to a specific user, then only this user can take action on the step.<br /> </li> 
     <li>If you assign the step to an entire group, then when the workflow reaches this step all users in this group will have the action in their <strong>Workflow Inbox</strong>.<br /> </li> 
     <li>See <a href="../../../sites/authoring/using/workflows-participating.md">Participating in Workflows</a> for more information.</li> 
    </ul> </li> 
  </ul> 
  <h2>AND Split</h2> 
  <p>The <strong>AND Split </strong>creates a split in the workflow, after which both branches will be active. You add workflow steps to each branch as required. This step enables you to introduce multiple processing paths into the workflow. For example, you can allow certain review steps to occur in parallel, so saving time.</p> 
  <img imageRotate="0" src="assets/wf-26.png" /> 
  <h4>AND Split - Configuration</h4> 
  <p>To configure the split:</p> 
  <ul> 
   <li><p>Edit the <strong>AND Split Properties</strong>:<br /> </p> 
    <ul> 
     <li><strong>Split Name</strong>: assign a name for explanatory purposes<br /> </li> 
     <li>Select the number of branches required; 2, 3, 4 or 5.</li> 
    </ul> </li> 
   <li><p>Add workflow steps to the branches as required.</p> <img imageRotate="0" src="assets/wf-27.png" /></li> 
  </ul> 
  <h2>Container Step</h2> 
  <p>A container step starts another workflow model that executes as a child workflow.</p> 
  <p>This container can allow you to reuse workflow models to implement common sequences of steps. For example a translation workflow model could be used in multiple editing workflows.</p> 
  <img imageRotate="0" src="assets/wf-28.png" /> 
  <h4>Container Step - Configuration</h4> 
  <p>To configure the step, edit and use the following tabs:</p> 
  <ul> 
   <li><a href="#steppropertiescommontab">Common</a></li> 
   <li><strong>Container</strong> 
    <ul> 
     <li><strong>Sub Workflow</strong>: Select the workflow to start.</li> 
    </ul> </li> 
  </ul> 
  <h2>Goto Step</h2> 
  <p>The <strong>Goto Step</strong> allows you to specify the next step in the workflow model to execute, dependent on the result of an ECMAScript:</p> 
  <ul> 
   <li><span class="code">true</span>: The <strong>Goto Step</strong> completes and the workflow engine executes the specified step.</li> 
   <li><span class="code">false</span>: The <strong>Goto Step</strong> completes and the normal routing logic determines the next step to execute.</li> 
  </ul> 
  <p>The <strong>Goto Step</strong> enables you to implement advanced routing structures in your workflow models. For example, to implement a loop, the <strong>Goto Step</strong> can be defined to execute a prior step in the workflow, with the script evaluating a loop condition.</p> 
  <h4>Goto Step - Configuration</h4> 
  <p>To configure the step, edit and use the following tabs:</p> 
  <ul> 
   <li><a href="#steppropertiescommontab">Common</a></li> 
   <li><strong>Process</strong> 
    <ul> 
     <li><strong>The step to go to.</strong>: Select the step to execute.</li> 
     <li><strong>Script Path</strong>: The path to the ECMAScript that determines whether to execute the <strong>Goto Step</strong>.</li> 
     <li><strong>Script</strong>: The ECMAScript that determines whether to execute the <strong>Goto Step</strong>.</li> 
    </ul> </li> 
  </ul> 
  <note> 
   <p>Specify either the <strong>Script Path</strong> or <strong>Script</strong>. Both options cannot be used at the same time. If you specify values for both properties, the step uses the <strong>Script Path</strong>.</p> 
  </note> 
  <h4>Simulating a for Loop</h4> 
  <p>Simulating a for loop requires that you maintain a count of the number of loop iterations that have occurred:</p> 
  <ul> 
   <li>The count typically represents an index of items that are acted on in the workflow.</li> 
   <li>The count is evaluated as the exit criteria of the loop.</li> 
  </ul> 
  <p>For example, to implement a workflow that performs an action on several JCR nodes you can use a loop counter as an index for the nodes. To persist the count, store an <span class="code">integer</span> value in the data map of the workflow instance. Use the script of the <strong>Goto Step</strong> to increment the count as well as to compare the count to the exit criteria.</p> 
  <codeblock class="syntax js">
    function&amp;nbsp;check(){!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;count=0;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;var&amp;nbsp;keyname="loopcount"!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;try{!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(workflowData.getMetaDataMap().containsKey(keyname)){&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;log.info("goto&amp;nbsp;script:&amp;nbsp;found&amp;nbsp;loopcount&amp;nbsp;key");!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;count=&amp;nbsp;parseInt(workflowData.getMetaDataMap().get(keyname))+1;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;!!discoiqbr!!&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;workflowData.getMetaDataMap().put(keyname,count);!!discoiqbr!!&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}catch(err)&amp;nbsp;{!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;log.info(err.message);!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;false;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(parseInt(count)&amp;nbsp;&lt;7){!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;true;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;}&amp;nbsp;else&amp;nbsp;{!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;false;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;}!!discoiqbr!!} 
  </codeblock> 
  <h2>OR Split</h2> 
  <p>The <strong>OR Split </strong>creates a split in the workflow, after which only one branch will be active. This step enables you to introduce conditional processing paths into your workflow. You add workflow steps to each branch as required.</p> 
  <note> 
   <p>For additional information on creating an OR Split see: <a href="https://helpx.adobe.com/experience-manager/using/aem64_workflow_servlet.html">https://helpx.adobe.com/experience-manager/using/aem64_workflow_servlet.html</a></p> 
  </note> 
  <img imageRotate="0" src="assets/wf-29.png" /> 
  <h4>OR Split - Configuration</h4> 
  <p>To configure the split:</p> 
  <ul> 
   <li><p>Edit the <strong>OR Split Properties</strong>:<br /> </p> 
    <ul> 
     <li><strong>Common</strong> 
      <ul> 
       <li>Select the number of branches required; 2, 3, 4 or 5.</li> 
      </ul> </li> 
     <li><strong>Branch &amp;lt;<em>x</em>&amp;gt;</strong> 
      <ul> 
       <li><strong>Script Path</strong>: The path to a file that contains the script.</li> 
       <li><strong>Script</strong>: Add the script in the box.</li> 
       <li><strong>Default Route</strong>: The default branch is followed when multiple branches evaluate to true. You can specify only one branch as the default.</li> 
      </ul> </li> 
    </ul> 
    <note> 
     <p>There is a separate tab for each branch:</p> 
     <ul> 
      <li>The script of each branch is evaluated one at a time. 
       <ul> 
        <li>The branches are evaluated left to right.</li> 
       </ul> </li> 
      <li>The first script that evaluates to true is executed. 
       <ul> 
        <li>If no branch evaluates to true, then the workflow does not advance.</li> 
       </ul> </li> 
     </ul> 
    </note> 
    <note> 
     <p>Specify either the <strong>Script Path</strong> or <strong>Script</strong>. Both options cannot be used at the same time. If you specify values for both properties, the step uses the <strong>Script Path</strong>.</p> 
    </note> 
    <note> 
     <p>See <a href="../../../sites/developing/using/workflows-models.md#definingaruleforanorsplit">Defining a Rule for an OR Split</a>.</p> 
    </note></li> 
   <li><p>Add workflow steps to the branches as required.</p> </li> 
  </ul> 
  <h2>Participant Steps and Choosers</h2> 
  <h3>Participant Step</h3> 
  <p>A <strong>Participant Step</strong> enables you to assign ownership for a particular action. The workflow will only proceed when the user has manually acknowledged the step. This is used when you want someone to take an action on the workflow; for example, a review step.<br /> </p> 
  <p>Although not directly related, user authorization must be considered when assigning an action; the user must have access to the page that is the workflow payload.</p> 
  <h4>Participant Step - Configuration</h4> 
  <p>To configure the step, edit and use the following tabs:</p> 
  <ul> 
   <li><a href="#steppropertiescommontab">Common</a></li> 
   <li><a href="#steppropertiesusergrouptab">User/Group</a></li> 
  </ul> 
  <note> 
   <p>The workflow initiator is always notified when:</p> 
   <ul> 
    <li>The workflow is completed (finished).</li> 
    <li>The workflow is aborted (terminated).</li> 
   </ul> 
  </note> 
  <note> 
   <p>Some properties need to be configured to enable email notifications. You can also customize the email template or add an email template for a new language. See <a href="../../../sites/administering/using/notification.md#configuringemailnotification">Configuring Email Notification</a> to configure email notifications in AEM.</p> 
  </note> 
  <h3>Dialog Participant Step</h3> 
  <p>Use a <strong>Dialog Participant Step</strong> to collect information from the user who is assigned the work item. This step is useful for collecting small amounts of data that is used later in the workflow.</p> 
  <p>Upon completing the step, the <strong>Complete Work Item</strong> dialog contains the fields that you define in your dialog. The data that is collected in the fields is stored in nodes of the workflow payload. Subsequent workflow steps can then read the value from the repository.</p> 
  <p>To configure the step, you specify the group or user to assign the work item to, and the path to the dialog.</p> 
  <h4>Dialog Participant Step - Configuration</h4> 
  <p>To configure the step, edit and use the following tabs:</p> 
  <ul> 
   <li><a href="#steppropertiescommontab">Common</a></li> 
   <li><a href="#steppropertiesusergrouptab">User/Group</a></li> 
   <li><strong>Dialog</strong> 
    <ul> 
     <li><strong>Dialog Path</strong>: The path to the dialog node of the <a href="#dialogparticipantstepcreatingadialog">dialog you create</a>.</li> 
    </ul> </li> 
  </ul> 
  <h4>Dialog Participant Step - Creating a dialog</h4> 
  <p>To create a dialog you need to create the dialog:</p> 
  <ul> 
   <li>Decide where the resulting data will be <a href="#dialogparticipantstepstoringdatainthepayload">stored in the payload</a>.</li> 
   <li><a href="#dialogparticipantstepdialogdefinition">Define the dialog; this includes defining the fields used to collect (and save) the data</a>. </li> 
  </ul> 
  <h4>Dialog Participant Step - Storing Data in the Payload</h4> 
  <p>You can store widget data in the workflow payload or in the work item metadata. The format of the <span class="code">name</span> property of the widget node determines where the data is stored.</p> 
  <ul> 
   <li><strong>Store Data with the Payload</strong> 
    <ul> 
     <li>To store widget data as a property of the workflow payload, use the following format for the value of the name property of the widget node:<br /> <span class="code"> ./jcr:content/nodename</span></li> 
     <li>The data is stored in the <span class="code">nodename</span> property of the payload node. If the node does not contain that property, the property is created.</li> 
     <li>When stored with the payload, subsequent uses of the dialog with the same payload overwrites the value of the property.</li> 
    </ul> </li> 
   <li><strong>Store Data with the Work Item</strong> 
    <ul> 
     <li>To store widget data as a property of the work item metadata, use the following format for the value of the name property:<br /> <span class="code"> nodename</span></li> 
     <li>The data is stored in the <span class="code">nodename</span> property of the work item <span class="code">metadata</span>. The data is preserved if the dialog subsequently used with the same payload.</li> 
    </ul> </li> 
  </ul> 
  <h4>Dialog Participant Step - Dialog Definition</h4> 
  <ol> 
   <li> <p>Dialogs for Dialog Participant Steps are similar to dialogs that you create for authoring components. They are stored under:</p>  <p>Dialogs for the standard, touch-enabled UI have the following node structure:</p> 
    <codeblock gutter="true" class="syntax xml">
      newComponent&amp;nbsp;(cq:Component)!!discoiqbr!!&amp;nbsp;&amp;nbsp;|-&amp;nbsp;cq:dialog&amp;nbsp;(nt:unstructured)!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;|-&amp;nbsp;content&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;|-&amp;nbsp;layout&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;|-&amp;nbsp;items&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;|-&amp;nbsp;column&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;|-&amp;nbsp;items&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;|-&amp;nbsp;component0!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;|-&amp;nbsp;component1!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;|-&amp;nbsp;... 
    </codeblock> 
    <note> 
     <p>For further information see <a href="../../../sites/developing/using/developing-components.md#creatingandconfiguringadialog">Creating and Configuring a Dialog</a>.</p> 
    </note></li> 
   <li> <p>The <strong>Dialog Participant Step</strong> has the <strong>Dialog Path</strong> property (together with the properties of a <a href="#participantstep">Participant Step</a>). The value of the <strong>Dialog Path</strong> property is the path to the <span class="code">dialog</span> node of your dialog.</p> <p>For example, the dialog is contained in a component named <span class="code">EmailWatch</span> that is stored in the node:</p>  <p>For the touch-enabled UI the following value is used for the <strong>Dialog Path</strong> property:</p>  <img imageRotate="0" src="assets/wf-30.png" /></li> 
   <li> <p>The following XML code snippet represents a dialog that stores a <span class="code">String</span> value in the <span class="code">watchEmail</span> node of the payload content. The title node represents the <a href="/sites/developing/using/reference-materials/granite-ui/api/jcr_root/libs/granite/ui/components/coral/foundation/form/textfield/index">TextField</a> component:</p> 
    <codeblock gutter="true" class="syntax xml">
      jcr:primaryType="nt:unstructured"&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;jcr:title="Watcher&amp;nbsp;Email&amp;nbsp;Address&amp;nbsp;Dialog"&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sling:resourceType="cq/gui/components/authoring/dialog"&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;content&amp;nbsp;jcr:primaryType="nt:unstructured"!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sling:resourceType="granite/ui/components/foundation/container"&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;layout&amp;nbsp;jcr:primaryType="nt:unstructured"&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;margin="false"&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sling:resourceType="granite/ui/components/foundation/layouts/fixedcolumns"!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;items&amp;nbsp;jcr:primaryType="nt:unstructured"&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;column&amp;nbsp;jcr:primaryType="nt:unstructured"!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sling:resourceType="granite/ui/components/foundation/container"&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;items&amp;nbsp;jcr:primaryType="nt:unstructured"&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;title&amp;nbsp;jcr:primaryType="nt:unstructured"&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;fieldLabel="Notification&amp;nbsp;Email&amp;nbsp;Address"&amp;nbsp;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;name="./jcr:content/watchEmails"!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;sling:resourceType="granite/ui/components/foundation/form/textfield"!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;/&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/items&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/column&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/items&gt;!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/content&gt;!!discoiqbr!!&lt;/cq:dialog&gt; 
    </codeblock><p>This example will, in the case of the touch-enabled UI, result in a dialog such as:</p> <img imageRotate="0" src="assets/chlimage_1-188.png" /></li> 
  </ol> 
  <h3>Dynamic Participant Step</h3> 
  <p>The <strong>Dynamic Participant Step</strong> component is similar to <strong><a href="#participantstep">Participant Step</a></strong> with the difference that the participant is selected automatically at run time.</p> 
  <p>To configure the step, you select a <strong>Participant Chooser</strong> that identifies the participant to assign the work item to, together with a dialog.</p> 
  <h4>Dynamic Participant Step - Configuration</h4> 
  <p>To configure the step, edit and use the following tabs:</p> 
  <ul> 
   <li><a href="#steppropertiescommontab">Common</a></li> 
   <li><strong>Participant Chooser</strong> 
    <ul> 
     <li><strong>Participant Chooser</strong>: The name of the <a href="#developingtheparticipantchooser">participant chooser that you create</a>.</li> 
     <li><strong>Arguments</strong>: Any required arguments.</li> 
     <li><strong>Email</strong>: Whether an email notification should be sent to the user.</li> 
    </ul> </li> 
   <li><strong>Dialog</strong> 
    <ul> 
     <li><strong>Dialog Path</strong>: The path to the dialog node of the <a href="#dialogparticipantstepcreatingadialog">dialog you create (as with the <strong>Dialog Participant Step</strong>)</a>.</li> 
    </ul> </li> 
  </ul> 
  <h4>Dynamic Participant Step - Developing the participant chooser</h4> 
  <p>You create the participant chooser. Therefore, you can use any selection logic or criteria. For example, your participant chooser can select the user (within a group) that has the fewest work items. You can create any number of participant choosers to use with different instances of the <strong>Dynamic Participant Step</strong> component in your workflow models.</p> 
  <p>Create an OSGi service or an ECMAScript that selects a user to assign the work item to.</p> 
  <ul> 
   <li> <p>Scripts must include a function named getParticipant that returns a user ID as a <span class="code">String</span> value. Store your custom scripts in, for example, the <span class="code">/apps/myapp/workflow/scripts</span> folder, or a subfolder.</p> <p>A sample script is included in a standard AEM instance:</p>  
    <note> 
     <p>You <strong><em>must</em></strong> not change anything in the <span class="code">/libs</span> path.</p> 
     <p>This is because the content of <span class="code">/libs</span> is overwritten the next time you upgrade your instance (and may be overwritten when you apply either a hotfix or feature pack).</p> 
    </note><p>This script selects the workflow initiator as the participant:</p> 
    <codeblock gutter="true" class="syntax js">
      function&amp;nbsp;getParticipant()&amp;nbsp;{!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&amp;nbsp;workItem.getWorkflow().getInitiator();!!discoiqbr!!} 
    </codeblock> 
    <note> 
     <p>The <strong>Workflow Initiator Participant Chooser</strong> component extends the <strong>Dynamic Participant Step</strong> and uses this script as the step implementation. </p> 
    </note></li> 
   <li> <p>Services must implement the <a href="/sites/developing/using/reference-materials/javadoc/com/day/cq/workflow/exec/ParticipantStepChooser">com.day.cq.workflow.exec.ParticipantStepChooser</a> interface. The interface defines the following members:</p> 
    <ul> 
     <li><span class="code">SERVICE_PROPERTY_LABEL</span> field: Use this field to specify the name of the participant chooser. The name appears in a list of available participant choosers in the <strong>Dynamic Participant Step</strong> properties.</li> 
     <li><span class="code">getParticipant</span> method: Returns the the dynamically resolved Principal id as a <span class="code">String</span> value.</li> 
    </ul> 
    <note> 
     <p>The <span class="code">getParticipant</span> method returns the the dynamically resolved Principal id. This can be either a group id or user id.</p> 
     <p>However, a group id can only be used for a <strong>Participant Step</strong>, when a list of participants is returned. For a <strong>Dynamic Participant Step</strong> an empty list is returned and this cannot be used for delegation.</p> 
    </note><p>To make your implementation available to <strong>Dynamic Participant Step</strong> components, add your Java class to an OSGi bundle that exports the service, and deploy the bundle to the AEM server.</p> 
    <note> 
     <p><strong>Random Participant Chooser</strong> is a sample service that selects a random user (<span class="code">com.day.cq.workflow.impl.process.RandomParticipantChooser</span>). The <strong>Random Participant Choose</strong>r step component sample extends the <strong>Dynamic Participant Step</strong> and uses this service as the step implementation.</p> 
    </note></li> 
  </ul> 
  <h4>Dynamic Participant Step - Example Participant Chooser Service</h4> 
  <p>The following Java class implements the <span class="code">ParticipantStepChooser</span> interface. The class returns the name of the participant who initiated the workflow. The code uses the same logic that the sample script (<span class="code">initator-participant-chooser.ecma</span>) uses. </p> 
  <p>The <span class="code">@Property</span> annotation sets the value of the <span class="code">SERVICE_PROPERTY_LABEL</span> field to <span class="code">Workflow Initiator Participant Chooser</span>.</p> 
  <codeblock gutter="true" class="syntax java">
    package&amp;nbsp;com.adobe.example;!!discoiqbr!!!!discoiqbr!!import&amp;nbsp;org.apache.felix.scr.annotations.Component;!!discoiqbr!!import&amp;nbsp;org.apache.felix.scr.annotations.Properties;!!discoiqbr!!import&amp;nbsp;org.apache.felix.scr.annotations.Property;!!discoiqbr!!import&amp;nbsp;org.apache.felix.scr.annotations.Service;!!discoiqbr!!import&amp;nbsp;org.osgi.framework.Constants;!!discoiqbr!!import&amp;nbsp;org.slf4j.Logger;!!discoiqbr!!import&amp;nbsp;org.slf4j.LoggerFactory;!!discoiqbr!!!!discoiqbr!!import&amp;nbsp;com.adobe.granite.workflow.WorkflowException;!!discoiqbr!!import&amp;nbsp;com.adobe.granite.workflow.WorkflowSession;!!discoiqbr!!import&amp;nbsp;com.adobe.granite.workflow.exec.ParticipantStepChooser;!!discoiqbr!!import&amp;nbsp;com.adobe.granite.workflow.exec.WorkItem;!!discoiqbr!!import&amp;nbsp;com.adobe.granite.workflow.metadata.MetaDataMap;!!discoiqbr!!!!discoiqbr!!@Component!!discoiqbr!!@Service!!discoiqbr!!@Properties({!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;@Property(name&amp;nbsp;=&amp;nbsp;Constants.SERVICE_DESCRIPTION,&amp;nbsp;value&amp;nbsp;=&amp;nbsp;"An&amp;nbsp;example&amp;nbsp;implementation&amp;nbsp;of&amp;nbsp;a&amp;nbsp;dynamic&amp;nbsp;participant&amp;nbsp;chooser."),!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;@Property(name&amp;nbsp;=&amp;nbsp;ParticipantStepChooser.SERVICE_PROPERTY_LABEL,&amp;nbsp;value&amp;nbsp;=&amp;nbsp;"Workflow&amp;nbsp;Initiator&amp;nbsp;Participant&amp;nbsp;Chooser&amp;nbsp;(service)")&amp;nbsp;})!!discoiqbr!!public&amp;nbsp;class&amp;nbsp;InitiatorParticipantChooser&amp;nbsp;implements&amp;nbsp;ParticipantStepChooser&amp;nbsp;{!!discoiqbr!!!!discoiqbr!!&amp;nbsp;private&amp;nbsp;Logger&amp;nbsp;logger&amp;nbsp;=&amp;nbsp;LoggerFactory.getLogger(this.getClass());!!discoiqbr!!!!discoiqbr!!&amp;nbsp;public&amp;nbsp;String&amp;nbsp;getParticipant(WorkItem&amp;nbsp;arg0,&amp;nbsp;WorkflowSession&amp;nbsp;arg1,!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;MetaDataMap&amp;nbsp;arg2)&amp;nbsp;throws&amp;nbsp;WorkflowException&amp;nbsp;{!!discoiqbr!!!!discoiqbr!!&amp;nbsp;&amp;nbsp;String&amp;nbsp;initiator&amp;nbsp;=&amp;nbsp;arg0.getWorkflow().getInitiator();!!discoiqbr!!&amp;nbsp;&amp;nbsp;logger.info("Assigning&amp;nbsp;Dynamic&amp;nbsp;Participant&amp;nbsp;Step&amp;nbsp;work&amp;nbsp;item&amp;nbsp;to&amp;nbsp;{}",initiator);!!discoiqbr!!!!discoiqbr!!&amp;nbsp;&amp;nbsp;return&amp;nbsp;initiator;!!discoiqbr!!&amp;nbsp;}!!discoiqbr!!} 
  </codeblock> 
  <p>In the <strong>Dynamic Participant Step</strong> properties dialog, the <strong>Participant Chooser</strong> list includes the item <span class="code">Workflow Initiator Participant Chooser (script)</span>, which represents this service.</p> 
  <p><span class="code"></span>When the workflow model is started, the log indicates the ID of the user who initiated the workflow and who is assigned the work item. In this example, the <span class="code">admin</span> user started the workflow.</p> 
  <p><span class="code">13.09.2015 15:48:53.037 *INFO* [10.176.129.223 [1347565733037] POST /etc/workflow/instances HTTP/1.1] com.adobe.example.InitiatorParticipantChooser Assigning Dynamic Participant Step work item to admin</span></p> 
  <h3>Form Participant Step</h3> 
  <p>The <strong>Form Participant Step</strong> presents a form when the work item is opened. When the user fills and submits the form, the field data is stored in the nodes of the workflow payload.</p> 
  <p>To configure the step, you specify the group or user to assign the work item to, and the path to the form.</p> 
  <note> 
   <p>This section deals with the <a href="../../../sites/authoring/using/default-components-foundation.md#form">Forms section of Foundation Components for Page Authoring</a>. </p> 
  </note> 
  <h4>Form Participant Step - Configuration</h4> 
  <p>To configure the step, edit and use the following tabs:</p> 
  <ul> 
   <li><a href="#steppropertiescommontab">Common</a></li> 
   <li><a href="#steppropertiesusergrouptab">User/Group</a></li> 
   <li><strong>Form</strong> 
    <ul> 
     <li><strong>Form Path</strong>: The path to the <a href="#formparticipantstepcreatingtheform">form you create</a>.</li> 
    </ul> </li> 
  </ul>  
  <h4>Form Participant Step - Creating the form</h4>  
  <p>Create a form for use with a <strong>Form Participant Step</strong> as normal. However, forms for a Form Participant Step must have the following configurations:</p> 
  <ul> 
   <li>The <strong>Start of Form</strong> component must have the <strong>Action Type</strong> property set to <span class="code">Edit Workflow Controlled Resource(s)</span>.</li> 
   <li>The <strong>Start of Form</strong> component must have a value for the the <span class="code">Form Identifier</span> property.</li> 
   <li>The form components must have the <strong>Element Name</strong> property set to the path of the node where the field data is stored. The path must locate a node in the workflow payload content. The value uses the following format: </li> 
   <li>The form must include a <strong>Workflow Submit Button(s)</strong> component. You do not configure any properties of the component.</li> 
  </ul> 
  <p>The requirements of your workflow determine where you should store field data. For example, field data can be used to configure the properties of page content. The following value of an <strong>Element Name</strong> property stores field data as the value of the <span class="code">redirectTarget</span> property of the <span class="code">jcr:content</span> node:</p> 
  <p style="margin-left: 40px;"><span class="code">./jcr:content/redirectTarget</span></p> 
  <p>In the following example, the field data is used as the content of a <strong>Text</strong> component on the payload page: </p> 
  <p style="margin-left: 40px;"><span class="code">./jcr:content/par/text_3/text</span></p> 
  <p><span class="code"></span>The first example can be used for any page that the <span class="code">cq:Page</span> component renders. The second example can only be used when the payload page includes a <strong>Text</strong> component that has an ID of <span class="code">text_3</span>.</p> 
  <p>The form can be located anywhere in the repository, however workflow users must be authorized to read the form.</p>    
  <h3>Random Participant Chooser</h3> 
  <p>The <strong>Random Participant Chooser</strong> step is a participant chooser that assigns the generated work item to a user that is randomly selected from a list. </p> 
  <img imageRotate="0" src="assets/wf-31.png" /> 
  <h4>Random Participant Chooser - Configuration</h4> 
  <p>To configure the step, edit and use the following tabs:</p> 
  <ul> 
   <li><a href="#steppropertiescommontab">Common</a></li> 
   <li><strong>Arguments</strong> 
    <ul> 
     <li><strong>Participants</strong>: Specifies the list of users available for selection. To add a user to the list, click <strong>Add Item</strong> and type the home path of the user node or the user ID. The order of the users does not affect the likelihood of being assigned a work item.</li> 
    </ul> </li> 
  </ul> 
  <h3>Workflow Initiator Participant Chooser</h3> 
  <p>The <strong>Workflow Initiator Participant Chooser</strong> step is a participant chooser that assigns the generated work item to the user who started the workflow. There are no properties to configure other than the <strong>Common</strong> properties.</p> 
  <h4>Workflow Initiator Participant Chooser - Configuration</h4> 
  <p>To configure the step, edit using the following tabs:</p> 
  <ul> 
   <li><a href="#steppropertiescommontab">Common</a></li> 
  </ul> 
  <h2>Process Step</h2> 
  <p>A <strong>Process Step</strong> executes an ECMAScript or calls an OSGi service to perform automatic processing.</p> 
  <img imageRotate="0" src="assets/wf-32.png" /> 
  <h4>Process Step - Configuration</h4> 
  <p>To configure the step, edit and use the following tabs:</p> 
  <ul> 
   <li><a href="#steppropertiescommontab">Common</a></li> 
   <li><strong>Process</strong> 
    <ul> 
     <li><strong>Process</strong>: The process implementation to execute. Use the drop-down menu to select the ECMAScript or OSGi service. For information about: 
      <ul> 
       <li>The standard ECMAScripts and OSGi services, see <a href="../../../sites/developing/using/workflows-process-ref.md">Built-In Processes for Process Steps</a>.</li> 
       <li>Creating ECMAScripts for a Process step, see <a href="../../../sites/developing/using/workflows-customizing-extending.md#usingecmascript">Implementing a Process Step with an ECMAScript</a>.</li> 
       <li>Creating OSGi services for a Process step, see <a href="../../../sites/developing/using/workflows-customizing-extending.md#implementingaprocessstepwithajavaclass">Implementing a Process Step with a Java Class</a>.</li> 
      </ul> </li> 
     <li><strong>Handler Advance</strong>: Select this option to automatically advance the workflow to the next step after execution. If not selected, the implementation script must handle workflow advancement.</li> 
     <li><strong>Arguments</strong>: Arguments to be passed to the process.</li> 
    </ul> </li> 
  </ul> 
 </body> 
</html>