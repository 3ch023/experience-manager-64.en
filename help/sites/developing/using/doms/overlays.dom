<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="audience:developing" name="primaryAudienceTag" /> 
  <meta content="false" name="isReadyForLocalization" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="mix:versionable" name="jcr:mixinTypes" /> 
  <meta content="5b726120-ec2a-4e62-ab0c-3b11b7b9de1f" name="jcr:predecessors" /> 
  <meta content="/content/docs/en/aem/6-3/develop/platform/overlays" name="qaNotes" /> 
  <meta content="2018-10-26T03:40:41.882-0400" name="lastPublishExternalDate" /> 
  <meta content="" name="jcr:primaryType" /> 
  <meta content="2018-10-26T03:40:41.923-0400" name="cq:lastReplicated" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES" name="primaryProductTag" /> 
  <meta content="2018-10-26T03:40:41.882-0400" name="publishExternalDate" /> 
  <meta content="2017-10-12T21:46:58.665-0400" name="qaDate" /> 
  <meta content="8976d644-58fc-4c76-9b0a-a0e09e97192d" name="jcr:uuid" /> 
  <meta content="2017-10-12T21:46:58.665-0400" name="mwpw_migration_script_version" /> 
  <meta content="Activate" name="cq:lastReplicationAction" /> 
  <meta content="https://helpx.adobe.com/experience-manager/6-4/sites/developing/using/overlays.html" name="publishExternalURL" /> 
  <meta content="/content/help/en/experience-manager/6-4/sites/developing/morehelp/platform;/content/help/en/experience-manager/6-4/sites/developing/morehelp/platform" name="moreHelpPaths" /> 
  <meta content="AEM uses the principle of overlays to allow you to extend and customize the consoles and other functionality " name="seoDescription" /> 
  <meta content="true" name="jcr:isCheckedOut" /> 
  <meta content="" name="jcr:baseVersion" /> 
  <meta content="2017-12-07T19:01:09.588-0500" name="jcr:created" /> 
  <meta content="Overlays" name="navTitle" /> 
  <meta content="Overlays" name="jcr:title" /> 
  <meta content="" name="jcr:versionHistory" /> 
  <meta content="Guillaume Carlino" name="contentOwner" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES;topic_tags:platform;content_type:reference" name="cq:tags" /> 
  <meta content="aheimoz" name="cq:lastReplicatedBy" /> 
  <meta content="aheimoz" name="cq:lastModifiedBy" /> 
  <meta content="2018-10-26T03:40:41.882-0400" name="topicBrowsingSortDate" /> 
  <meta content="Overlays" name="seoTitle" /> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="2017-10-31T16:16:23.484-0400" name="firstPublishExternalDate" /> 
  <meta content="aheimoz@adobe.com" name="lr_lastReplicatedBy" /> 
  <meta content="2018-05-08T12:44:34.539-0400" name="locHandOffDate" /> 
  <meta content="2018-10-26T03:40:41.890-0400" name="cq:lastModified" /> 
 </head> 
 <body> 
  <p>AEM (and prior to that, CQ) has long used the principle of overlays to allow you to extend and customize the <a href="../../../sites/developing/using/customizing-consoles-touch.md">consoles</a> and other functionality (for example, <a href="../../../sites/developing/using/customizing-page-authoring-touch.md">page authoring</a>).</p> 
  <p>Overlay is a term that can be used in many contexts. In this context (extending AEM) an overlay means taking the predefined functionality and imposing your own definitions over that (to customize the standard functionality).</p> 
  <p>In a standard instance the predefined functionality is held under <span class="code">/libs</span> and it is recommended practice to define your overlay (customizations) under the <span class="code">/apps</span> branch. AEM uses a search path to find a resource, searching first the <span class="code">/apps</span> branch and then the <span class="code">/libs</span> branch (the <a href="#configuringthesearchpaths">search path can be configured</a>). This mechanism means that your overlay (and the customizations defined there) will have priority.</p> 
  <p>Since AEM 6.0, changes have been made to how overlays are implemented and used:</p> 
  <ul> 
   <li>AEM 6.0 onwards - for <a href="/sites/developing/using/reference-materials/granite-ui/api/index">Granite</a>-related overlays (i.e. the touch-enabled UI)<br /> 
    <ul> 
     <li>Method 
      <ul> 
       <li>Reconstruct the appropriate <span class="code">/libs</span> structure under <span class="code">/apps</span>.<br /> This does not require a 1:1 copy, the <a href="../../../sites/developing/using/sling-resource-merger.md">Sling Resource Merger</a> is used to cross-reference the original definitions that are required. The Sling Resource Merger provides services to access and merge resources by means of diff (differencing) mechanisms.<br /> </li> 
       <li>Make any changes under <span class="code">/apps</span>.</li> 
      </ul> </li> 
     <li>Advantages 
      <ul> 
       <li>More robust to changes under <span class="code">/libs</span>.</li> 
       <li>Only redefine what is actually required.</li> 
      </ul> </li> 
    </ul> </li> 
   <li>Non-Granite overlays and overlays prior to AEM 6.0<br /> 
    <ul> 
     <li>Method 
      <ul> 
       <li>Copy the content from <span class="code">/libs</span> to <span class="code">/apps</span><br /> You need to copy the entire sub-branch, including properties.<br /> </li> 
       <li>Make any changes under <span class="code">/apps</span>.</li> 
      </ul> </li> 
     <li>Disadvantages 
      <ul> 
       <li>Although your changes will not be lost when something changes under <span class="code">/libs</span>, you might have to recreate certain changes that occur in your overlay under <span class="code">/apps</span>.<br /> </li> 
      </ul> </li> 
    </ul> </li> 
  </ul> 
  <note> 
   <p>The <a href="../../../sites/developing/using/sling-resource-merger.md">Sling Resource Merger</a> and the related methods can only be used with <a href="/sites/developing/using/reference-materials/granite-ui/api/index">Granite</a>. This means that creating an overlay with a skeleton structure is only appropriate for the standard, touch-enabled UI.</p> 
   <p>Overlays for other areas (including the classic UI) involve copying the appropriate node and entire sub-structure, then making the required changes.</p> 
  </note> 
  <p>Overlays are the recommended method for many changes, such as <a href="../../../sites/developing/using/customizing-consoles-touch.md#createacustomconsole">configuring your consoles</a> or <a href="../../../sites/developing/using/customizing-page-authoring-touch.md#addnewselectioncategorytoassetbrowser">creating your selection category to the asset browser in the side panel</a> (used when authoring pages). They are required as:<br /> </p> 
  <ul> 
   <li>You <strong><i>must not</i> make changes in the <span class="code">/libs</span> branch</strong><br /> Any changes you do make may be lost, because this branch is liable to changes whenever you: 
    <ul> 
     <li>upgrade on your instance</li> 
     <li>apply a hotfix</li> 
     <li>install a feature pack</li> 
    </ul> </li> 
   <li>They concentrate your changes in one location; making it easier for you to track, migrate, backup and/or debug your changes as necessary.</li> 
  </ul> 
  <h3>Configuring the Search Paths</h3> 
  <p>For overlays the resource delivered is an aggregate of the resources and properties retrieved, depending on search paths that can be defined:</p> 
  <ul> 
   <li>The resource <strong>Resolver Search Path</strong> as defined in the <a href="../../../sites/deploying/using/configuring-osgi.md">OSGi configuration</a> for the <strong>Apache Sling Resource Resolver Factory</strong>. 
    <ul> 
     <li>The top-down order of search paths indicates their respective priorities.</li> 
     <li>In a standard installation the primary defaults are <span class="code">/apps</span>, <span class="code">/libs</span> - so the content of <span class="code">/apps</span> has a higher priority than that of <span class="code">/libs</span> (i.e. it <i>overlays</i> it).<br /> </li> 
    </ul> </li> 
   <li>Two service users need JCR:READ access to the location where the scripts are stored. Those users are: components-search-service (used by the com.day.cq.wcm.coreto access/cache components) and sling-scripting (used by org.apache.sling.servlets.resolver to find servlets).</li> 
   <li>The following configuration must also be configured according to where you put your scripts (in this example under /etc, /libs or /apps).</li> 
  </ul> 
  <p style="margin-left: 40px;"><i>PID = org.apache.sling.jcr.resource.internal.JcrResourceResolverFactoryImpl</i></p> 
  <p style="margin-left: 40px;"><i>resource.resolver.searchpath=["/etc","/apps","/libs"]</i></p> 
  <p style="margin-left: 40px;"><i>resource.resolver.vanitypath.whitelist=["/etc/","/apps/","/libs/","/content/"]</i></p> 
  <ul> 
   <li>Finally the Servlet Resolver must also be configured (in this example to add /etc as well)</li> 
  </ul> 
  <p style="margin-left: 40px;"><i>PID = org.apache.sling.servlets.resolver.SlingServletResolver<br /> servletresolver.paths=["/bin/","/libs/","/apps/","/etc/","/system/","/index.servlet","/login.servlet","/services/"]</i></p> 
  <h3>Example of Usage</h3> 
  <p>Some examples are covered when:</p> 
  <ul> 
   <li><a href="../../../sites/developing/using/customizing-consoles-touch.md">Customizing the Consoles</a></li> 
   <li><a href="../../../sites/developing/using/customizing-page-authoring-touch.md">Customizing Page Authoring</a><br /> </li> 
  </ul> 
 </body> 
</html>