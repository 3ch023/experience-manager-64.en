<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="A content fragment extends a standard asset." name="seoDescription" /> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
  <meta content="2018-11-22T00:15:58.731-0500" name="lastPublishExternalDate" /> 
  <meta content="2018-11-22T00:15:58.731-0500" name="publishExternalDate" /> 
  <meta content="2018-03-15T09:02:04.547-0400" name="jcr:created" /> 
  <meta content="afe3ddf9-aea0-472b-8325-1b2911d929fb" name="jcr:uuid" /> 
  <meta content="audience:developing" name="primaryAudienceTag" /> 
  <meta content="aheimoz@adobe.com" name="lr_lastReplicatedBy" /> 
  <meta content="/content/help/en/experience-manager/6-4/sites/developing/morehelp/extending-aem;/content/help/en/experience-manager/6-4/sites/developing/morehelp/extending-aem" name="moreHelpPaths" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES" name="primaryProductTag" /> 
  <meta content="https://helpx.adobe.com/experience-manager/6-4/sites/developing/using/customizing-content-fragments.html" name="publishExternalURL" /> 
  <meta content="bb0d309a-f3f8-4675-ac94-8a3078f2ae58" name="jcr:predecessors" /> 
  <meta content="Customizing and Extending Content Fragments" name="jcr:title" /> 
  <meta content="2018-11-22T00:15:58.731-0500" name="topicBrowsingSortDate" /> 
  <meta content="Activate" name="cq:lastReplicationAction" /> 
  <meta content="aheimoz" name="cq:lastReplicatedBy" /> 
  <meta content="" name="jcr:versionHistory" /> 
  <meta content="2017-10-12T21:46:58.665-0400" name="mwpw_migration_script_version" /> 
  <meta content="2017-10-31T16:17:08.006-0400" name="firstPublishExternalDate" /> 
  <meta content="" name="jcr:baseVersion" /> 
  <meta content="2018-05-08T12:41:44.761-0400" name="locHandOffDate" /> 
  <meta content="aheimoz" name="cq:lastModifiedBy" /> 
  <meta content="mix:versionable" name="jcr:mixinTypes" /> 
  <meta content="2018-11-22T00:15:58.737-0500" name="cq:lastModified" /> 
  <meta content="Customizing and Extending Content Fragments" name="navTitle" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/SITES;topic_tags:extending-aem;content_type:reference" name="cq:tags" /> 
  <meta content="Customizing and Extending Content Fragments" name="seoTitle" /> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="User" name="contentOwner" /> 
  <meta content="2018-11-22T00:15:58.769-0500" name="cq:lastReplicated" /> 
  <meta content="false" name="isReadyForLocalization" /> 
  <meta content="true" name="jcr:isCheckedOut" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="/content/docs/en/aem/6-3/develop/extending/content-fragments" name="qaNotes" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
  <meta content="2017-10-12T21:46:00.000-0400" name="qaDate" /> 
  <meta content="" name="jcr:primaryType" /> 
 </head> 
 <body> 
  <note> 
   <p>Some Content Fragment functionality requires the application of <a href="../../../release-notes/sp-release-notes.md">AEM 6.4 Service Pack 2 (6.4.2.0)</a>.</p> 
  </note> 
  <draft-comment color="yellow" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-15T04:18:48.477-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
   <p>Links need to be checked have ones pointing to 6.4 and 6.3</p> 
  </draft-comment> 
  <draft-comment color="yellow" lastModifiedBy="ims-author-57F1056A4CD116590A746C15@AdobeID" lastModifiedDate="2018-01-18T11:19:30.027-0500" prevFirstName="unknown" prevLastName="unknown" type="remark"> 
   <p>https://docs-author.corp.adobe.com/content/docs/en/aem/6-2/administer/sites/translation/tc-manage.html</p> 
  </draft-comment> 
  <p>A content fragment extends a standard asset; see:</p> 
  <ul> 
   <li><a href="../../../assets/using/content-fragments.md">Creating and Managing Content Fragments</a> and <a href="../../../sites/authoring/using/content-fragments.md">Page Authoring with Content Fragments</a> for further information about content fragments.</li> 
   <li><a href="../../../assets/using/managing-assets-touch-ui.md">Managing Assets</a> and <a href="../../../assets/using/extending-assets.md">Customizing and Extending Assets</a> for further information about standard assets.</li> 
  </ul> 
  <h2>Architecture</h2> 
  <draft-comment color="green" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-20T05:36:43.036-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
   <p>some changes to this section since the last review - mainly models/templates</p> 
  </draft-comment> 
  <p>The basic <a href="../../../assets/using/content-fragments.md#constituentpartsofacontentfragment">constituent parts</a> of a content fragment are:</p> 
  <ul> 
   <li>A <em>Content Fragment,</em></li> 
   <li>consisting of one or more <em>Content Element</em>s,</li> 
   <li>and which can have one or more <em>Content Variation</em>s.</li> 
  </ul> 
  <draft-comment color="green" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-20T05:34:18.330-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
   <p>is the following still valid? for structured fragments where elements == fields (oder?)<br /> </p> 
  </draft-comment> 
  <draft-comment type="draft"> 
   <ul> 
    <li>Where: 
     <ul> 
      <li>Variations are managed globally; i.e. all elements have the same number of variations with the same name and description, but with (potentially) different content.</li> 
     </ul> </li> 
   </ul> 
  </draft-comment> 
  <p>Depending on the type of fragment, either models or templates are also used:</p> 
  <note> 
   <p><a href="../../../assets/using/content-fragments-models.md">Content fragment models</a> are now recommended for creating all your fragments. </p> 
   <p>Content fragment models are used for all examples in We.Retail.</p> 
  </note> 
  <draft-comment type="draft"> 
   <note type="caution"> 
    <p><a href="../../../assets/using/content-fragments-models.md">Content fragment models</a> are now recommended for creating all your fragments. See:</p> 
    <ul> 
     <li>Customizing Content Fragment Models</li> 
     <li>Customizing Data Types for Content Fragment Models</li> 
    </ul> 
    <p>Content fragment models are used for all examples in We.Retail.</p> 
   </note> 
  </draft-comment> 
  <ul> 
   <li><p>Content Fragment Models:</p> 
    <ul> 
     <li>Used for defining content fragments that hold structured content.</li> 
     <li>Content fragment models define the structure of a content fragment when it is created.</li> 
     <li>A fragment references the model; so changes to the model may/will impact any dependent fragments.<br /> </li> 
     <li>Models are built-up of data types.<br /> </li> 
     <li>Functions to add new variations, etc., have to update the fragment accordingly.</li> 
    </ul> 
    <draft-comment type="draft"> 
     <p>Content Fragment Models:</p> 
     <ul> 
      <li>Used for defining content fragments that hold structured content.</li> 
      <li>Content fragment models define the structure of a content fragment when it is created.</li> 
      <li>A fragment references the model; so changes to the model may/will impact any dependent fragments.<br /> </li> 
      <li>Models are built-up of data types.<br /> </li> 
      <li>Functions to add new variations, etc., have to update the fragment accordingly.</li> 
     </ul> 
    </draft-comment> 
    <note> 
     <p>Any changes to an existing content fragment model can impact dependent fragments; this can lead to orphan properties in those fragments.</p> 
    </note></li> 
   <li><p>Content Fragment Templates:</p> 
    <ul> 
     <li>Used for defining simple content fragments.</li> 
     <li>Templates define the (basic, text-only) structure of a content fragment when it is created.</li> 
     <li>The template is copied to the fragment when it is created; so further changes to the template will not be reflected in existing fragments.</li> 
     <li>Functions to add new variations, etc., have to update the fragment accordingly.</li> 
     <li><a href="../../../sites/developing/using/content-fragment-templates.md">Content fragment templates</a> operate in a different manner to that of other templating mechanisms within the AEM ecosystem (e.g. page templates, etc.). Therefore they should be considered separately.</li> 
     <li>When based on a template the MIME type of the content is managed on the actual content; this means that each element and variation can have a different MIME type.</li> 
    </ul> </li> 
  </ul> 
  <h3>Integration with Assets</h3> 
  <p>Content Fragment Management (CFM) is part of AEM Assets as:</p> 
  <ul> 
   <li>Content fragments are assets.</li> 
   <li>They use existing Assets functionality.</li> 
   <li>They are fully integrated with Assets (admin consoles, etc.).</li> 
  </ul> 
  <h4>Mapping Structured Content Fragments to Assets</h4> 
  <draft-comment color="green" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-16T09:18:41.678-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
   <p>new sub-section</p> 
  </draft-comment> 
  <img imageRotate="0" src="assets/fragment-to-assets-structured.png" /> 
  <p>Content fragments with structured content (i.e. based on a content fragment model) are mapped to a single asset:</p> 
  <ul> 
   <li>All content is stored under the <span class="code">jcr:content/data</span> node of the asset: 
    <ul> 
     <li>The element data is stored under the master sub-node:<br /> <span class="code">jcr:content/data/master</span></li> 
     <li>Variations are stored under a sub-node that carries the name of the variation:<br /> e.g. <span class="code">jcr:content/data/myvariation</span></li> 
     <li>The data of each element is stored in the respective sub-node as a property with the element name:<br /> e.g. the content of element <span class="code">text</span> is stored as property <span class="code">text</span> on <span class="code">jcr:content/data/master</span></li> 
    </ul> </li> 
   <li>Metadata and associated content is stored below <span class="code">jcr:content/metadata</span><br /> Except for the title and description, which are not considered traditional metadata and stored on <span class="code">jcr:content</span></li> 
  </ul> 
  <h4>Mapping Simple Content Fragments to Assets</h4> 
  <img imageRotate="0" src="assets/chlimage_1-276.png" /> 
  <p>Simple content fragments (based on a template) are mapped to a composite consisting of a main asset and (optional) sub-assets:</p> 
  <ul> 
   <li>All non-content information of a fragment (such as title, description, metadata, structure) is managed on the main asset exclusively.</li> 
   <li>The content of the first element of a fragment is mapped to the original rendition of the main asset. 
    <ul> 
     <li>The variations (if there are any) of the first element are mapped to other renditions of the main asset.</li> 
    </ul> </li> 
   <li>Additional elements (if existing) are mapped to sub-assets of the main asset. 
    <ul> 
     <li>The main content of these additional elements map to the original rendition of the respective sub-asset.</li> 
     <li>Other variations (if applicable) of any additional elements map to other renditions of the respective sub-asset.</li> 
    </ul> </li> 
  </ul> 
  <h4>Asset Location</h4> 
  <p>As with standard assets, a content fragment is held under:</p> 
  <p style="margin-left: 40px;"><span class="code">/content/dam</span></p> 
  <h4>Asset Permissions</h4> 
  <p>For further details see <a href="../../../assets/using/content-fragments-delete.md">Content Fragment - Delete Considerations</a>.</p> 
  <h4>Feature Integration</h4> 
  <ul> 
   <li>The Content Fragment Management (CFM) feature builds on the Assets core, but should be as independent of it as possible.</li> 
   <li>CFM provides its own implementations for items in the card/column/list views; these plug into the existing Assets content rendering implementations.</li> 
   <li>Several Assets components have been extended to cater for content fragments.</li> 
  </ul> 
  <h3>Using Content Fragments in Pages</h3> 
  <draft-comment color="green" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-16T09:18:11.708-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
   <p>some changes since last review - mainly models/templates</p> 
  </draft-comment> 
  <note> 
   <p>The <a href="/content/help/en/experience-manager/core-components/using/content-fragment-component">Content Fragment Core Component</a> is now recommended. See <a href="/content/help/en/experience-manager/core-components/using/developing">Developing Core Components</a> for more details.</p> 
  </note> 
  <p>Content fragments can be referenced from AEM pages, just as any other asset type. AEM provides the <a href="/content/help/en/experience-manager/core-components/using/content-fragment-component"><strong>Content Fragment</strong> core component</a> - a <a href="../../../sites/authoring/using/content-fragments.md#addingacontentfragmenttoyourpage">component that allows you to include content fragments on your pages</a>. You can also extend, this <strong>Content Fragment</strong> core component. </p> 
  <ul> 
   <li>The component uses the <span class="code">fragmentPath</span> property to reference the actual content fragment. The <span class="code">fragmentPath</span> property is handled in the same manner as similar properties of other asset types; for example, when the content fragment is moved to another location.</li> 
   <li>The component allows you to select the variation to be displayed.</li> 
   <li>Additionally, a range of paragraphs can be selected to restrict the output; for example, this can be used for multi-column output.</li> 
   <li>The component allows <a href="../../../sites/developing/using/components-content-fragments.md#inbetweencontent">in-between content</a>: 
    <ul> 
     <li>Here the component allows you to place other assets (images, etc.) in between the paragraphs of the referenced fragment.</li> 
     <li>For in-between content you need to: 
      <ul> 
       <li>be aware of the possibility of unstable references; in-between content (added when authoring a page) has no fixed relationship to the paragraph it is positioned next to, inserting a new paragraph (in the content fragment editor) before the position of the in-between content can lose the relative position</li> 
       <li>consider the additional parameters (such as like variation and paragraph filters) to avoid false positives in search results</li> 
      </ul> </li> 
    </ul> </li> 
  </ul> 
  <note> 
   <p><strong>Content Fragment Model:</strong></p> 
   <p>When using a content fragment that has been based on a content fragment model on a page, the model is referenced. This means that if the model has not been published at the time you publish the page, this will be flagged and the model added to the resources to be published with the page.</p> 
   <p><strong>Content Fragment Template:</strong></p> 
   <p>When using a content fragment that has been based on a content fragment template on a page, there is no reference as the template was copied when creating the fragment.<br /> </p> 
  </note> 
  <h4>Configuration using OSGi console</h4> 
  <draft-comment color="green" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-16T09:18:52.112-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
   <p>new sub-section</p> 
  </draft-comment> 
  <p>The backend implementation of content fragments is, for example, responsible for making instances of a fragment used on a page searchable, or for managing mixed media content. This implementation needs to know which components are used for rendering fragments and how the rendering is parameterized.</p> 
  <p>The parameters for this can be configured in the <a href="../../../sites/deploying/using/configuring-osgi.md#osgiconfigurationwiththewebconsole">Web Console</a>, for the OSGi bundle <strong>DAM Content Fragments Configuration</strong>.</p> 
  <ul> 
   <li><strong>Resource types</strong><br /> A list of <span class="code">sling:resourceTypes</span> can be provided to define components that are used for rendering content fragments and where the background processing should be applied to.</li> 
   <li><strong>Reference Properties</strong><br /> A list of properties can be configured to specify where the reference to the fragment is stored for the respective component.</li> 
  </ul> 
  <draft-comment color="green" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-20T06:06:37.548-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
   <p>note below - which property in particular - or both?</p> 
  </draft-comment> 
  <note> 
   <p>There is no direct mapping between property and component type. </p> 
   <p>AEM simply takes the first property that can be found on a paragraph. So you should choose the properties carefully.</p> 
  </note> 
  <img imageRotate="0" src="assets/osgi-config.png" /> 
  <draft-comment color="yellow" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-15T08:35:00.926-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
   <p style="margin-left: 40px;">if paragraphScope == range then the property paragraphRange defines the range of paragraphs to be rendered (format: see component documentation)</p> 
   <p>needs a link</p> 
  </draft-comment> 
  <p>There are still some guidelines you must follow to ensure your component is compatible with the content fragment background processing:</p> 
  <ul> 
   <li>The name of the property where the element(s) to be rendered is defined must be either <span class="code">element</span> or <span class="code">elementNames</span>.</li> 
   <li>The name of the property where the variation to be rendered is defined must be either <span class="code">variation</span> or <span class="code">variationName</span>.</li> 
   <li>If the output of multiple elements is supported (by using <span class="code">elementNames</span> to specify multiple elements), the actual display mode is defined by property <span class="code">displayMode</span>: 
    <ul> 
     <li>If the value is <span class="code">singleText</span> (and there is only one element configured) then the element is rendered as a text with in-between content, layout support, etc. This is the default for fragments where only one single element is rendered.</li> 
     <li>Otherwise, a much more simple approach is used (could be called "form view"), where no in-between content is supported and the fragment content is rendered "as is".</li> 
    </ul> </li> 
   <li>If the fragment is rendered for <span class="code">displayMode</span> == <span class="code">singleText</span> (implicitly or explicitly) the following additional properties come into play: 
    <ul> 
     <li><span class="code">paragraphScope</span> defines whether all paragraphs, or only a range of paragraphs, should be rendered (values: <span class="code">all</span> vs. <span class="code">range</span>)</li> 
     <li>if <span class="code">paragraphScope</span> == <span class="code">range</span> then the property <span class="code">paragraphRange</span> defines the range of paragraphs to be rendered</li> 
    </ul> </li> 
  </ul> 
  <h3>Integration with other Frameworks</h3> 
  <p>Content fragments can be integrated with:</p> 
  <ul> 
   <li>  
    <draft-comment color="blue" lastModifiedBy="sgrimm" lastModifiedDate="2018-03-13T12:46:28.572-0400" prevFirstName="Stefan" prevLastName="Grimm" type="remark"> 
     <p>I don't think this is true (unfortunately translations popped up rather late, and we were not able to fully integrate with the translation framework).</p> 
     <p>AFAIK:</p> 
     <ul> 
      <li>Models are not automatically included in translation packages.</li> 
      <li>Not sure if they can be translated separately (please ask Mathias, he should be aware)</li> 
      <li>There's also a known issue with the We.Retail component (which shouldn't have an impact on this docu though, as the customer is not supposed to base his own work on sample code/content.</li> 
     </ul> 
    </draft-comment>
    <draft-comment color="yellow" lastmodifiedby="aheimoz" lastmodifieddate="2018-03-16T04:36:25.169-0400" prevfirstname="Alison" prevlastname="Heimoz" type="remark"> 
     <p>"As the model (which also includes lanugage-specific texts such as title, description, etc.) is copied from the template, it can be included in the translation process as well."</p> 
     <p>reword to something like?</p> 
     <p>As the fragment (which also includes lanugage-specific texts such as title, description, etc.) is dependent on the underlying content fragment model, it can be included in the translation process as well.</p> 
    </draft-comment> 
    <draft-comment color="yellow" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-14T06:26:13.548-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
     <p>following relates to templates/simple fragments (not models)<br /> </p> 
    </draft-comment> 
    <draft-comment color="green" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-15T08:53:35.732-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
     <p>have removed the bullet point about models - is the rest generic about the fragments themselves?<br /> </p> 
    </draft-comment> 
    <draft-comment color="green" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-20T03:28:56.119-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
     <p>response from Mathias:</p> 
     <ol> 
      <li>&amp;gt;&amp;gt;&amp;gt; cf models would generally not be translated, just like page templates. Both are stored in /conf. Translation workflows pick up content for translation only in /content.</li> 
      <li>&amp;lt;&amp;lt;&amp;lt; think the worry might have been because of field labels, etc.<br /> &amp;gt;&amp;gt;&amp;gt; Those could probably be translated with i18n/dictionary mechanism</li> 
     </ol> 
    </draft-comment> <p>Content Fragments are fully integrated with the <a href="../../../sites/administering/using/tc-manage.md">AEM translation workflow</a>. On an architectural level, this means:</p> 
    <ul> 
     <li>The individual translations of a content fragment are actually separate fragments; for example: 
      <ul> 
       <li>they are located under different language roots:<br /> <span class="code">/content/dam/&amp;lt;<em>path</em>/en/&amp;lt;<em>to</em>&amp;gt;/&amp;lt;<em>fragment</em>&amp;gt;</span><br /> vs.<br /> <span class="code">/content/dam/&amp;lt;<em>path</em>&amp;gt;/de/&amp;lt;<em>to</em>&amp;gt;/&amp;lt;<em>fragment</em>&amp;gt;</span></li> 
       <li>but they share exactly the same relative path below the language root:<br /> <span class="code">/content/dam/&amp;lt;<em>path</em>&amp;gt;/en/&amp;lt;<em>to</em>&amp;gt;/&amp;lt;<em>fragment</em>&amp;gt;</span><br /> vs.<br /> <span class="code">/content/dam/&amp;lt;<em>path</em>&amp;gt;/de/&amp;lt;<em>to</em>&amp;gt;/&amp;lt;<em>fragment</em>&amp;gt;</span></li> 
      </ul> </li> 
     <li>Besides the rule-based paths, there is no further connection between the different language versions of a content fragment; they are handled as two separate fragments, although the UI provides the means to navigate between the language variants.</li> 
    </ul> 
    <note> 
     <p>The AEM translation workflow works with <span class="code">/content</span>:</p> 
     <ul> 
      <li>As the content fragment models reside in <span class="code">/conf</span>, these are not included in such translations. You can <a href="../../../sites/developing/using/i18n-dev.md">internationalize the UI strings</a>.<br /> </li> 
      <li>Templates are copied to create the fragment so this is implicit.<br /> </li> 
     </ul> 
    </note></li> 
   <li> 
    <ul> 
     <li>Content fragments (re)use the <a href="../../../assets/using/metadata-schemas.md">metadata schemas</a>, that can be defined with standard assets.</li> 
     <li>CFM provides its own, specific schema:<br /> <span class="code">/libs/dam/content/schemaeditors/forms/contentfragment</span><br /> this can be extended if required.</li> 
     <li>The respective schema form is integrated with the fragment editor.</li> 
    </ul> </li> 
  </ul> 
  <h2>The Content Fragment Management API - Server-Side</h2> 
  <p>You can use the server-side API to access your content fragments; see:</p> 
  <p style="margin-left: 40px;"> <span class="code"><a href="/sites/developing/using/reference-materials/javadoc/com/adobe/cq/dam/cfm/package-summary">com.adobe.cq.dam.cfm</a></span></p> 
  <note> 
   <p>It is strongly recommended to use the server-side API instead of directly accessing the content structure.</p> 
  </note> 
  <h3>Key Interfaces</h3> 
  <p>The following three interfaces can serve as entry points:</p> 
  <ul> 
   <li><p><strong>Fragment Template</strong> (<span class="code"><a href="/sites/developing/using/reference-materials/javadoc/com/adobe/cq/dam/cfm/FragmentTemplate">FragmentTemplate</a></span>)</p> <p>Use <span class="code">FragmentTemplate.createFragment()</span> for creating a new fragment.</p> 
    <codeblock gutter="true" class="syntax js">
      Resource&amp;nbsp;templateOrModelRsc&amp;nbsp;=&amp;nbsp;resourceResolver.getResource("...");!!discoiqbr!!FragmentTemplate&amp;nbsp;tpl&amp;nbsp;=&amp;nbsp;templateOrModelRsc.adaptTo(FragmentTemplate.class);!!discoiqbr!!ContentFragment&amp;nbsp;newFragment&amp;nbsp;=&amp;nbsp;tpl.createFragment(parentRsc,&amp;nbsp;"A&amp;nbsp;fragment&amp;nbsp;name",&amp;nbsp;"A&amp;nbsp;fragment&amp;nbsp;description.");!!discoiqbr!! 
    </codeblock> 
    <draft-comment color="blue" lastModifiedBy="sgrimm" lastModifiedDate="2018-03-13T13:07:46.428-0400" prevFirstName="Stefan" prevLastName="Grimm" type="remark"> 
     <p>In general this is still valid, but we used "data model" for template-based fragments already - which is somehow different from the "model" of structured fragments.</p> 
     <p>Suggestion is to replace</p> 
     <p style="margin-left: 40px;"><em>Get the model for a given element/variation</em></p> 
     <p>with</p> 
     <p style="margin-left: 40px;"><em>Get structural information for a given element/variation</em></p> 
     <p>and mention that a FragmentTemplate is used to represent both template and model (naming may be confusing; but it is as it is due to historical reasons - no change to avoid compatibility issues). Same is true for ElementTemplate - despite the naming they reflect both element templates/fields.</p> 
     <p>VariationTemplate is (more or less) unrelated to the notion of model vs. template (as it means the same for both types of fragments).</p> 
    </draft-comment> 
    <draft-comment color="yellow" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-16T05:18:26.158-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
     <p>...and use of template was ambiguous as well.....joy</p> 
    </draft-comment> 
    <draft-comment color="green" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-20T03:37:27.071-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
     <p>changes made since first review</p> 
    </draft-comment><p>This interface represents:</p> 
    <ul> 
     <li>either a content fragment model or content fragment template from which to create a content fragment,<br /> </li> 
     <li>and (after the creation) the structural information of that fragment</li> 
    </ul> <p>This information can include:<br /> </p> 
    <ul> 
     <li>Access basic data (title, description)</li> 
     <li>Access templates/models for the elements of the fragment: 
      <ul> 
       <li>List element templates</li> 
       <li>Get structural information for a given element</li> 
       <li>Access the element template (see <span class="code">ElementTemplate</span>)</li> 
      </ul> </li> 
     <li>Access templates for the variations of the fragment: 
      <ul> 
       <li>List variation templates</li> 
       <li>Get structural information for a given variation</li> 
       <li>Access the variation template (see <span class="code">VariationTemplate</span>)</li> 
      </ul> </li> 
     <li>Get initial associated content</li> 
    </ul> <p>Interfaces that represent important information:</p> 
    <ul> 
     <li><span class="code">ElementTemplate</span> 
      <ul> 
       <li>Get basic data (name, title)</li> 
       <li>Get initial element content</li> 
      </ul> </li> 
     <li><span class="code">VariationTemplate</span> 
      <ul> 
       <li>Get basic data (name, title, description)</li> 
      </ul> </li> 
    </ul> </li> 
   <li><p><strong>Content Fragment</strong> (<span class="code"><a href="/sites/developing/using/reference-materials/javadoc/com/adobe/cq/dam/cfm/ContentFragment">ContentFragment</a></span>)</p> <p>This interface allows you to work with a content fragment in an abstract way. </p> 
    <note> 
     <p>It is strongly recommended to access a fragment through this interface. Changing the content structure directly should be avoided.</p> 
    </note><p>The interface provides you with the means to:</p> 
    <ul> 
     <li>Manage basic data (e.g. get name; get/set title/description)</li> 
     <li>Access meta data</li> 
     <li>Access elements: 
      <ul> 
       <li>List elements</li> 
       <li>Get elements by name</li> 
       <li>Create new elements (see <a href="#caveats">Caveats</a>)<br /> </li> 
       <li>Access element data (see <span class="code">ContentElement</span>)</li> 
      </ul> </li> 
     <li>List variations defined for the fragment</li> 
     <li>Create new variations globally</li> 
     <li>Manage associated content: 
      <ul> 
       <li>List collections</li> 
       <li>Add collections</li> 
       <li>Remove collections</li> 
      </ul> </li> 
     <li>Access the fragment's model or template</li> 
    </ul> <p>Interfaces that represent the prime elements of a fragment are:</p> 
    <ul> 
     <li><strong>Content Element</strong> (<span class="code"><a href="/sites/developing/using/reference-materials/javadoc/com/adobe/cq/dam/cfm/ContentElement">ContentElement</a></span>) 
      <ul> 
       <li>Get basic data (name, title, description)</li> 
       <li>Get/Set content</li> 
       <li>Access variations of an element: 
        <ul> 
         <li>List variations</li> 
         <li>Get variations by name</li> 
         <li>Create new variations (see <a href="#caveats">Caveats</a>)</li> 
         <li>Remove variations (see <a href="#caveats">Caveats</a>)</li> 
         <li>Access variation data (see <span class="code">ContentVariation</span>)<br /> </li> 
        </ul> </li> 
       <li>Shortcut for resolving variations (applying some additional, implementation-specific fallback logic if the specified variation is not available for an element)</li> 
      </ul> </li> 
     <li><strong>Content Variation</strong> (<span class="code"><a href="/sites/developing/using/reference-materials/javadoc/com/adobe/cq/dam/cfm/ContentVariation">ContentVariation</a></span>) 
      <ul> 
       <li>Get basic data (name, title, description)</li> 
       <li>Get/Set content</li> 
       <li>Simple synchronization, based on last modified information</li> 
      </ul> </li> 
    </ul> <p>All three interfaces (<span class="code">ContentFragment</span>, <span class="code">ContentElement</span>, <span class="code">ContentVariation</span>) extend the <span class="code">Versionable</span> interface, which adds versioning capabilities, required for content fragments:</p> 
    <ul> 
     <li>Create new version of the element</li> 
     <li>List versions of the element</li> 
     <li>Get the content of a specific version of the versioned element</li> 
    </ul> </li> 
  </ul> 
  <h3>Adapting - Using adaptTo()</h3> 
  <p>The following can be adapted:</p> 
  <ul> 
   <li><p><span class="code">ContentFragment</span> can be adapted to:</p> 
    <ul> 
     <li><span class="code">Resource</span> - the underlying Sling resource; note that updating the underlying <span class="code">Resource</span> directly, requires rebuilding the <span class="code">ContentFragment</span> object.</li> 
     <li><span class="code">Asset</span> - the DAM <span class="code">Asset</span> abstraction that represents the content fragment; note that updating the <span class="code">Asset</span> directly, requires rebuilding the <span class="code">ContentFragment</span> object.</li> 
    </ul> </li> 
   <li><p><span class="code">ContentElement</span> can be adapted to:</p> 
    <ul> 
     <li><span class="code">ElementTemplate</span> - for accessing the element's structural information.</li> 
    </ul> </li> 
   <li> <p><span class="code">FragmentTemplate</span> can be adapted to:</p>
    <draft-comment color="yellow" lastmodifiedby="aheimoz" lastmodifieddate="2018-03-14T06:38:55.441-0400" prevfirstname="Alison" prevlastname="Heimoz" type="remark"> 
     <p>add link to template and model pages</p> 
    </draft-comment> 
    <ul> 
     <li><span class="code">Resource</span> - the <span class="code">Resource</span> determining the referenced model or the original template that was copied; 
      <ul> 
       <li>changes made through the <span class="code">Resource</span> are not automatically reflected in the <span class="code">FragmentTemplate</span>.</li> 
      </ul> </li> 
    </ul> </li> 
   <li><p><span class="code">Resource</span> can be adapted to:</p> 
    <ul> 
     <li><span class="code">ContentFragment</span></li> 
     <li><span class="code">FragmentTemplate</span></li> 
    </ul> </li> 
  </ul> 
  <h3>Caveats</h3> 
  <draft-comment color="green" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-15T10:17:28.683-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
   <p>updates made since the first review</p> 
  </draft-comment> 
  <p>It should be noted that:</p> 
  <ul> 
   <li>The API is implemented to provide functionality supported by the UI.</li> 
   <li>The entire API is designed to <strong>not</strong> persist changes automatically (unless otherwise noted in the API JavaDoc). So you will always have to commit the resource resolver of the respective request (or the resolver you are actually using).</li> 
   <li>Tasks that might require additional effort: 
    <ul> 
     <li>Creating/removing new elements will not update the data structure of simple fragments (based on a fragment template).</li> 
     <li>Creating new variations from <span class="code">ContentElement</span> will not update the data structure (but creating them globally from <span class="code">ContentFragment</span> will).</li> 
     <li>Removing existing variations will not update the data structure.</li> 
    </ul> </li> 
  </ul> 
  <h2>The Content Fragment Management API - Client-Side</h2> 
  <draft-comment color="blue" lastModifiedBy="sgrimm" lastModifiedDate="2018-03-14T04:27:34.547-0400" prevFirstName="Stefan" prevLastName="Grimm" type="remark"> 
   <p>The entire clientside admin part has been marked "internal" (besides a single rendercondition), so there is no such thing anymore. So for 6.4, this entire chapter can be removed.</p> 
   <p>Things that are not below /libs/dam/cfm/admin may be excluded from that rule, but I will add remarks at the respective content.</p> 
   <p>I would still mention that the old API is still supported IF 6.4 is run in compat mode (with the compat package installed). And provide a link back to the 6.3 version of the documentation.</p> 
  </draft-comment> 
  <note> 
   <p>For AEM 6.4 the client-side API is internal.</p> 
  </note> 
  <draft-comment type="draft"> 
   <note type="caution"> 
    <p>For AEM 6.4 the client-side API is internal.</p> 
    <p>If you are using AEM 6.4 in backwards compatibility mode you can refer to the AEM 6.3 documentation.<br /> </p> 
   </note> 
  </draft-comment> 
  <h3>Additional Information</h3> 
  <draft-comment color="blue" lastModifiedBy="sgrimm" lastModifiedDate="2018-03-14T04:28:44.445-0400" prevFirstName="Stefan" prevLastName="Grimm" type="remark"> 
   <p>I would keep this, except for some areas. See my respective remarks.</p> 
  </draft-comment> 
  <draft-comment color="yellow" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-16T05:19:59.383-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
   <p>would it make sense to relocate this....now that it's down to one point...but where does it best belong?</p> 
  </draft-comment> 
  <p>See the following:</p> 
  <ul> 
   <li> <p>The <span class="code">filter.xml</span> for content fragment management is configured so that it does not overlap with the Assets core content package.</p> </li> 
  </ul> 
  <h2>Edit Sessions</h2> 
  <draft-comment color="blue" lastModifiedBy="sgrimm" lastModifiedDate="2018-03-14T04:33:38.438-0400" prevFirstName="Stefan" prevLastName="Grimm" type="remark"> 
   <p>Not sure about this section.</p> 
   <p>I think it's worth keeping with some changes, as it provides some useful background information.</p> 
   <p>Changes:</p> 
   <ul> 
    <li>Remove reference to cfm:block</li> 
    <li>Entering a page/content change: In 6.4, the edit session is always started when the user enters a page. The system doesn't wait for the first edit. (There's a JIRA to get back to the previous behavior, but we didn't get that far for 6.4.)</li> 
   </ul> 
  </draft-comment> 
  <draft-comment color="yellow" lastModifiedBy="aheimoz" lastModifiedDate="2018-03-16T05:23:45.784-0400" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
   <ul> 
    <li>have removed the mention cfm:block (haven't replaced it with anything else)</li> 
    <li>have updated the paragraph about editing session, have left the original in draft for if/when it does revert<br /> </li> 
   </ul> 
  </draft-comment> 
  <p>An editing session is started when the user opens a content fragment in one of the editor pages. The editing session is finished when the user leaves the editor by selecting either <strong>Save</strong> or <strong>Cancel</strong>.</p> 
  <draft-comment type="draft"> 
   <p>An editing session is started when the user opens a content fragment in one of the editor pages and starts editing; for example, by entering text or removing a variation. The editing session is finished when the user leaves the editor by selecting either <strong>Save</strong> or <strong>Cancel</strong>.</p> 
  </draft-comment> 
  <h4>Requirements</h4> 
  <p>Requirements for controlling an editing session are:</p> 
  <ul> 
   <li>Editing a content fragment, which can span multiple views (= HTML pages), should be atomic.</li> 
   <li>The editing should also be <i>transactional</i>; at the end of the edit session the changes must either be committed (saved) or rolled back (cancelled).</li> 
   <li>Edge cases should be handled properly; these include situations such as when the user leaving the page by entering a URL manually or using global navigation.</li> 
   <li>A periodic auto save (every x minutes) should be available to prevent data loss.</li> 
   <li>If a content fragment is edited by two users concurrently, they should not overwrite each other's changes.</li> 
  </ul> 
  <h4>Processes</h4> 
  <p>The processes involved are:</p> 
  <ul> 
   <li>Starting a session 
    <ul> 
     <li>A new version of the content fragment is created.</li> 
     <li>Auto save is started.</li> 
     <li>Cookies are set; these define the currently edited fragment and that there is an edit session open.<br /> </li> 
    </ul> </li> 
   <li>Finishing a session 
    <ul> 
     <li>Auto save is stopped.</li> 
     <li>Upon commit: 
      <ul> 
       <li>The last modified information is updated.</li> 
       <li>Cookies are removed.</li> 
      </ul> </li> 
     <li>Upon rollback: 
      <ul> 
       <li>The version of the content fragment that was created when the edit session was started is restored.</li> 
       <li>Cookies are removed.</li> 
      </ul> </li> 
    </ul> </li> 
   <li>Editing 
    <ul> 
     <li>All changes (auto save included) are done on the active content fragment - not in a separated, protected area.</li> 
     <li>Therefore, those changes are reflected immediately on AEM pages that reference the respective content fragment</li> 
    </ul> </li> 
  </ul> 
  <h4>Actions</h4> 
  <p>The possible actions are:</p> 
  <ul> 
   <li>Entering a page 
    <ul> 
     <li>Check if an editing session is already present; by checking the respective cookie. 
      <ul> 
       <li>If one exists, verify that the editing session was started for the content fragment that is currently being edited 
        <ul> 
         <li>If the current fragment, reestablish the session.</li> 
         <li>If not, try to cancel editing for the previously edited content fragment and remove cookies (no editing session present afterwards).</li> 
        </ul> </li> 
       <li>If no edit session exists, wait for the first change made by the user (see below).</li> 
      </ul> </li> 
     <li>Check if the content fragment is already referenced on a page and display appropriate information if so.</li> 
    </ul> </li> 
   <li>Content change 
    <ul> 
     <li>Whenever the user changes content and there is no edit session present, a new edit session is created (see <a href="#processes">Starting a session</a>).</li> 
    </ul> </li> 
   <li>Leaving a page 
    <ul> 
     <li>If an editing session is present and the changes have not been persisted, a modal confirmation dialog is shown to notify the user of potentially lost content and allow them to stay on the page. </li> 
    </ul> </li> 
  </ul> 
  <h2>Examples</h2> 
  <h3>Example: Accessing an existing content fragment</h3> 
  <p>To achieve this you can adapt the resource that represents the API to:</p> 
  <p style="margin-left: 40px;"><span class="code">com.adobe.cq.dam.cfm.ContentFragment</span></p> 
  <p>For example:</p> 
  <codeblock gutter="true" class="syntax java">
    //&amp;nbsp;first,&amp;nbsp;get&amp;nbsp;the&amp;nbsp;resource!!discoiqbr!!Resource&amp;nbsp;fragmentResource&amp;nbsp;=&amp;nbsp;resourceResolver.getResource("/content/dam/fragments/my-fragment");!!discoiqbr!!//&amp;nbsp;then&amp;nbsp;adapt&amp;nbsp;it!!discoiqbr!!if&amp;nbsp;(fragmentResource&amp;nbsp;!=&amp;nbsp;null)&amp;nbsp;{!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ContentFragment&amp;nbsp;fragment&amp;nbsp;=&amp;nbsp;fragmentResource.adaptTo(ContentFragment.class);!!discoiqbr!!&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;//&amp;nbsp;the&amp;nbsp;resource&amp;nbsp;is&amp;nbsp;now&amp;nbsp;accessible&amp;nbsp;through&amp;nbsp;the&amp;nbsp;API!!discoiqbr!!}&amp;nbsp; 
  </codeblock> 
  <h3>Example: Creating a new content fragment</h3> 
  <p>To create a new content fragment programmatically, you need to use:</p> 
  <p style="margin-left: 40px;"><span class="code">com.adobe.cq.dam.cfm.ContentFragmentManager#create</span></p> 
  <p>For example:</p> 
  <codeblock gutter="true" class="syntax java">
    Resource&amp;nbsp;templateOrModelRsc&amp;nbsp;=&amp;nbsp;resourceResolver.getResource("...");!!discoiqbr!!FragmentTemplate&amp;nbsp;tpl&amp;nbsp;=&amp;nbsp;templateOrModelRsc.adaptTo(FragmentTemplate.class);!!discoiqbr!!ContentFragment&amp;nbsp;newFragment&amp;nbsp;=&amp;nbsp;tpl.createFragment(parentRsc,&amp;nbsp;"A&amp;nbsp;fragment&amp;nbsp;name",&amp;nbsp;"A&amp;nbsp;fragment&amp;nbsp;description.");!!discoiqbr!! 
  </codeblock> 
  <h3>Example: Specifying the auto-save interval</h3> 
  <draft-comment color="yellow" lastModifiedBy="aheimoz" lastModifiedDate="2018-02-15T06:39:47.749-0500" prevFirstName="Alison" prevLastName="Heimoz" type="remark"> 
   <p>need a link to confmgr docu</p> 
   <p>see https://jira.corp.adobe.com/browse/DOC-6654</p> 
   <p>now https://jira.corp.adobe.com/browse/CQDOC-6654</p> 
  </draft-comment> 
  <draft-comment color="blue" lastModifiedBy="sgrimm" lastModifiedDate="2018-03-14T04:42:53.795-0400" prevFirstName="Stefan" prevLastName="Grimm" type="remark"> 
   <p>Technical documentation for confmgr is: https://git.corp.adobe.com/Granite/com.adobe.granite.confmgr (unfortunately private, so you can't link it).</p> 
   <p>Unfortunately, there doesn't seem to be "regular" doc available (but I might have missed something - search on docs.adobe.com is not really useful for terms like "configuration manager" ...)</p> 
  </draft-comment> 
  <p>The auto save interval (measured in seconds) can be defined using the configuration manager (ConfMgr):</p> 
  <ul> 
   <li>Node: <span class="code">&amp;lt;<i>conf-root</i>&amp;gt;/settings/dam/cfm/jcr:content</span></li> 
   <li>Property Name: <span class="code">autoSaveInterval</span></li> 
   <li>Type: <span class="code">Long</span><br /> </li> 
   <li>Default: <span class="code">600</span> (10 minutes); this is defined on <span class="code">/libs/settings/dam/cfm/jcr:content</span></li> 
  </ul> 
  <p>If you want to set an auto save interval of 5 minutes you need to define the property on your node; for example:</p> 
  <ul> 
   <li>Node: <span class="code">/conf/global/settings/dam/cfm/jcr:content</span></li> 
   <li>Property Name: <span class="code">autoSaveInterval</span><br /> </li> 
   <li>Type: <span class="code">Long</span><br /> </li> 
   <li>Value: <span class="code">300</span> (5 minutes equates to 300 seconds)</li> 
  </ul> 
  <h2>Content Fragment Templates</h2> 
  <p>See <a href="../../../sites/developing/using/content-fragment-templates.md">Content Fragment Templates</a> for full information.</p> 
  <draft-comment type="draft"> 
   <h2>Content Fragment Models</h2> 
  </draft-comment> 
  <draft-comment type="draft"> 
   <p>For further information see:</p> 
   <ul> 
    <li>Customizing Content Fragment Models<br /> </li> 
    <li>Customizing Data Types for Content Fragment Models </li> 
   </ul> 
  </draft-comment> 
  <h2>Components for Page Authoring</h2> 
  <p>For further information see</p> 
  <ul> 
   <li> <a href="/content/help/en/experience-manager/core-components/using/content-fragment-component">Core Components - Content Fragment Component</a> (recommended)</li> 
   <li><a href="../../../sites/developing/using/components-content-fragments.md#componentsforpageauthoring">Content Fragment Components - Components for Page Authoring</a> </li> 
  </ul> 
 </body> 
</html>