<?xml version="1.1" encoding="UTF-8" standalone="yes"?>
<html>
 <head>
  <meta content="2017-11-22T19:06:15.004-0500" name="jcr:created" />
  <meta content="2017-10-03T06:52:24.079-0400" name="firstPublishExternalDate" />
  <meta content="admin" name="lr_lastModifiedBy" />
  <meta content="help/components/pages/article-3" name="sling:resourceType" />
  <meta content="true" name="jcr:isCheckedOut" />
  <meta content="carlino" name="cq:lastModifiedBy" />
  <meta content="Rendering Forms Based on Fragments" name="jcr:title" />
  <meta content="/etc/designs/help" name="cq:designPath" />
  <meta content="2017-10-03T06:52:24.079-0400" name="publishExternalDate" />
  <meta content="" name="jcr:primaryType" />
  <meta content="mix:versionable" name="jcr:mixinTypes" />
  <meta content="be548668-23ed-4020-aecb-43ae3d06112c" name="jcr:uuid" />
  <meta content="2018-04-03T08:32:20.478-0400" name="cq:lastReplicated" />
  <meta content="https://helpx.adobe.com/aem-forms/6-3/developing/rendering-forms-based-fragments.html" name="publishExternalURL" />
  <meta content="left" name="sideColumn" />
  <meta content="audience:developing" name="primaryAudienceTag" />
  <meta content="not_checked" name="acrolinxStatus" />
  <meta content="/apps/help/templates/article-3" name="cq:template" />
  <meta content="590ea0e5-3092-45db-bb3a-16095248ea58" name="jcr:predecessors" />
  <meta content="2017-11-21T06:59:43.379-0500" name="cq:lastModified" />
  <meta content="Rendering Forms Based on Fragments Rendering Forms Based on Fragments Rendering Forms Based on Fragments" name="navTitle" />
  <meta content="AEMForms/6.1/ProgramLC/WS624e3cba99b79e12e69a9941333732bac8-7e3d.2,AEMForms/6.1/ProgramLC/WSb2b0ce6418a1450d-5eacfd4a15a1c582236-8000,AEMForms/6.1/ProgramLC/WS624e3cba99b79e12287c5e5a1336a3526a9-7fff.2,AEMForms/6.1/ProgramLC/WS624e3cba99b79e12287c5e5a1336a3526a9-7ffe.2,AEMForms/6.1/ProgramLC/WS624e3cba99b79e12e69a9941333732bac8-7a54.2,AEMForms/6.1/ProgramLC/WS624e3cba99b79e12e69a9941333732bac8-7a53.2" name="cq:gepId" />
  <meta content="admin" name="jcr:createdBy" />
  <meta content="admin" name="contentOwner" />
  <meta content="2017-10-03T06:52:24.079-0400" name="lastPublishExternalDate" />
  <meta content="" name="jcr:baseVersion" />
  <meta content="carlino" name="cq:lastReplicatedBy" />
  <meta content="video" name="pageLayout" />
  <meta content="en_us" name="jcr:language" />
  <meta content="Activate" name="cq:lastReplicationAction" />
  <meta content="content_type:reference;geptopics:SG_AEMFORMS/categories/rendering_forms;products:SG_EXPERIENCEMANAGER/6.4/FORMS;topic_tags:operations" name="cq:tags" />
  <meta content="admin" name="lr_creator" />
  <meta content="false" name="doNotLocalize" />
  <meta content="khsingh@adobe.com" name="lr_lastReplicatedBy" />
  <meta content="2017-08-09T03:29:00.000-0400" name="topicBrowsingSortDate" />
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/FORMS" name="primaryProductTag" />
  <meta content="2017-08-09T03:29:44.767-0400" name="lr_lastModified" />
  <meta content="light" name="heroGradient" />
  <meta content="head1_20111213" name="gep_conversion_script_version" />
  <meta content="" name="jcr:versionHistory" />
  <meta content="2017-08-09T03:29:00.000-0400" name="sortDate" />
 </head>
 <body>
  <h2 id="rendering_forms_based_on_fragments">Rendering Forms Based on Fragments</h2>
  <p></p>
  <p>The Forms service can render forms that are based on fragments that you create using Designer. A <i>fragment</i> is a reusable part of a form and is saved as a separate XDP file that can be inserted into multiple form designs. For example, a fragment can include an address block or legal text.</p>
  <p>Using fragments simplifies and speeds up the creation and maintenance of large numbers of forms. When creating a new form, you insert a reference to the required fragment and the fragment appears in the form. The fragment reference contains a subform that points to the physical XDP file. For information about creating form designs based on fragments, see <a href="http://www.adobe.com/go/learn_aemforms_designer_63">Forms Designer</a></p>
  <p>A fragment can include several subforms that are wrapped in a choice subform set. Choice subform sets control the display of subforms based on the flow of data from a data connection. You use conditional statements to determine which subform from within the set appears in the delivered form. For example, each subform in a set can include information for a particular geographic location and the subform that is displayed can be determined based on the location of the user.</p>
  <p>A <i>script fragment</i> contains reusable JavaScript functions or values that are stored separately from any particular object, such as a date parser or a web service invocation. These fragments include a single script object that appears as a child of variables in the Hierarchy palette. Fragments cannot be created from scripts that are properties of other objects, such as event scripts like validate, calculate, or initialize.</p>
  <p>Here are advantages of using fragments:</p>
  <ul>
   <li><p><strong>Content reuse</strong>: You can use fragments to reuse content in multiple form designs. When you need to use some of the same content in multiple forms, it is faster and simpler to use a fragment than to copy or re-create the content. Using fragments also ensures that the frequently used parts of a form design have consistent content and appearance in all the referencing forms.</p></li>
   <li><p><strong>Global updates</strong>: You can use fragments to make global changes to multiple forms only once, in one file. You can change the content, script objects, data bindings, layout, or styles in a fragment, and all XDP forms that reference the fragment will reflect the changes. </p></li>
   <li><p>For example, a common element across many forms might be an address block that includes a drop-down list object for the country. If you need to update the values for the drop-down list object, you must open many forms to make the changes. If you include the address block in a fragment, you only need to open one fragment file to make the changes. </p></li>
   <li><p>To update a fragment in a PDF form, you must resave the form in Designer.</p></li>
   <li><p><strong>Shared form creation</strong>: You can use fragments to share the creation of forms among several resources. Form developers with expertise in scripting or other advanced features of Designer can develop and share fragments that take advantage of scripting and dynamic properties. Form designers can use those fragments to lay out form designs and to ensure that all parts of a form have a consistent appearance and functionality across multiple forms designed by multiple people.</p></li>
  </ul>
  <h3 id="assembling_a_form_design_assembled_using_fragments">Assembling a form design assembled using fragments</h3>
  <p></p>
  <p>You can assemble a form design to pass to the Forms service based on multiple fragments. To assemble multiple fragments, use the Assembler service. To see an example of using the Assemble service to create a form design which is used by another Forms services (the Output service), see <a href="/programming-with-aem-forms/creating-document-output-streams-creating creating-document-output-streams-creating#creating_pdf_documents_using_fragments">Creating PDF Documents Using Fragments</a>. Instead of using the Output service, you can perform the same workflow using the Forms service. </p>
  <p>When using the Assembler service, you are passing a form design that was assembled using fragments. The form design that was created does not reference other fragments. In contrast, this topic discusses passing a form design that references other fragments to the Forms service. However, the form design was not assembled by Assembler. It was created in Designer. </p>
  <note>
   <p>For more information about the Forms service, see<a href="http://www.adobe.com/go/learn_aemforms_services_63"> Services Reference for AEM Forms</a>.</p>
  </note>
  <note>
   <p>For information about creating a web-based application that renders forms based on fragments, see <a href="/programming-with-aem-forms/rendering-forms-rendering-forms creating-web-applications-renders-forms#creating_web_applications_that_renders_forms">Creating Web Applications that Renders Forms</a>.</p>
  </note>
  <h3 id="summary_of_steps">Summary of steps</h3>
  <p></p>
  <p>To render a form based on fragments, perform the following tasks:</p>
  <ol>
   <li><p>Include project files.</p></li>
   <li><p>Create a Forms Client API object.</p></li>
   <li><p>Specify URI values.</p></li>
   <li><p>Render the form.</p></li>
   <li><p>Write the form data stream to the client web browser.</p></li>
  </ol>
  <p><strong>Include project files</strong></p>
  <p>Include necessary files into your development project. If you are creating a client application using Java, include the necessary JAR files. If you are using web services, ensure that you include the proxy files.</p>
  <p><strong>Create a Forms Client API object </strong></p>
  <p>Before you can programmatically perform a Forms service Client API operation, you must create a Forms service client.</p>
  <p><strong>Specify URI values</strong></p>
  <p>To successfully render a form based on fragments, you must ensure that the Forms service can locate both the form and the fragments (the XDP files) that the form design references. For example, assume the form is named PO.xdp and this form uses two fragments named FooterUS.xdp and FooterCanada.xdp. In this situation, the Forms service must be able to locate all three XDP files. </p>
  <p>You can organize a form and its fragments by placing the form in one location and the fragments in another location, or you can place all XDP files in the same location. For the purposes of this section, assume that all XDP files are located in the AEM Forms repository. For information about placing XDP files in the AEM Forms repository, see <a href="/programming-with-aem-forms/aem-forms-repository-aem-forms writing-resources-writing-resources#writing_resources">Writing Resources</a>. </p>
  <p>When rendering a form based on fragments, you must reference only the form itself and not the fragments. For example, you must reference PO.xdp and not FooterUS.xdp or FooterCanada.xdp. Ensure that you place the fragments in a location where the Forms service can locate them.</p>
  <p><strong>Render the form</strong></p>
  <p>A form based on fragments can be rendered in the same manner as non-fragmented forms. That is, you can render the form as PDF, HTML, or form Guides (deprecated). The example in this section renders a form based on fragments as an interactive PDF form. (See <a href="/programming-with-aem-forms/rendering-forms-rendering-forms rendering-interactive-pdf-forms-rendering#rendering_interactive_pdf_forms">Rendering Interactive PDF Forms</a>.)</p>
  <p><strong>Write the form data stream to the client web browser</strong></p>
  <p>When the Forms service renders a form, it returns a form data stream that you must write to the client web browser. When written to the client web browser, the form is visible to the user.</p>
  <p><strong>See also</strong></p>
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms rendering-forms-based-fragments-rendering rendering-forms-based-fragments-rendering#render_forms_based_on_fragments_using_the_java_api">Render forms based on fragments using the Java API</a></p>
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms rendering-forms-based-fragments-rendering rendering-forms-based-fragments-rendering#render_forms_based_on_fragments_using_the_web_service_api">Render forms based on fragments using the web service API</a></p>
  <p><a href="#unresolvedlink-lc-in-invoke-using-java-iu.xml#ws624e3cba99b79e12e69a9941333732bac8-7b4b.2">Including AEM Forms Java library files</a></p>
  <p><a href="#unresolvedlink-lc-in-invoke-using-java-iu.xml#ws624e3cba99b79e12e69a9941333732bac8-7fd6.2">Setting connection properties</a></p>
  <p><a href="#unresolvedlink-lc-qs-forms-fo.xml#ws624e3cba99b79e12e69a9941333732bac8-7af6.2">Forms Service API Quick Starts</a></p>
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms rendering-interactive-pdf-forms-rendering#rendering_interactive_pdf_forms">Rendering Interactive PDF Forms</a></p>
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms creating-web-applications-renders-forms#creating_web_applications_that_renders_forms">Creating Web Applications that Renders Forms</a></p>
  <h3 id="render_forms_based_on_fragments_using_the_java_api">Render forms based on fragments using the Java API</h3>
  <p></p>
  <p>Render a form based on fragments by using the Forms API (Java):</p>
  <ol>
   <li><p>Include project files </p><p>Include client JAR files, such as adobe-forms-client.jar, in your Java project’s class path. </p></li>
   <li><p>Create a Forms Client API object </p>
    <ul>
     <li><p>Create a <span class="code">ServiceClientFactory</span> object that contains connection properties. </p></li>
     <li><p>Create an <span class="code">FormsServiceClient</span> object by using its constructor and passing the <span class="code">ServiceClientFactory</span> object. </p></li>
    </ul></li>
   <li><p>Specify URI values </p>
    <ul>
     <li><p>Create a <span class="code">URLSpec</span> object that stores URI values by using its constructor. </p></li>
     <li><p>Invoke the <span class="code">URLSpec</span> object’s <span class="code">setApplicationWebRoot</span> method and pass a string value that represents the application’s web root.</p></li>
     <li><p>Invoke the <span class="code">URLSpec</span> object’s <span class="code">setContentRootURI</span> method and pass a string value that specifies the content root URI value. Ensure that the form design and the fragments are located in the content root URI. If not, the Forms service throws an exception. To reference the repository, specify <span class="code">repository://</span>.</p></li>
     <li><p>Invoke the <span class="code">URLSpec</span> object’s <span class="code">setTargetURL</span> method and pass a string value that specifies the target URL value to where form data is posted. If you define the target URL in the form design, you can pass an empty string. You can also specify the URL to where a form is sent in order to perform calculations.</p></li>
    </ul></li>
   <li><p>Render the form </p><p>Invoke the <span class="code">FormsServiceClient</span> object’s <span class="code">renderPDFForm</span> method and pass the following values:</p>
    <ul>
     <li><p>A string value that specifies the form design name, including the file name extension. If you reference a form design that is part of a Forms application, ensure that you specify the complete path, such as <span class="code">Applications/FormsApplication/1.0/FormsFolder/Loan.xdp</span>.</p></li>
     <li><p>A <span class="code">com.adobe.idp.Document</span> object that contains data to merge with the form. If you do not want to merge data, pass an empty <span class="code">com.adobe.idp.Document</span> object. </p></li>
     <li><p>A <span class="code">PDFFormRenderSpec</span> object that stores run-time options. </p></li>
     <li><p>A <span class="code">URLSpec</span> object that contains URI values that are required by the Forms service to render a form based on fragments. </p></li>
     <li><p>A <span class="code">java.util.HashMap</span> object that stores file attachments. This is an optional parameter and you can specify <span class="code">null</span> if you do not want to attach files to the form.</p></li>
    </ul><p>The <span class="code">renderPDFForm</span> method returns a <span class="code">FormsResult</span> object that contains a form data stream that must be written to the client web browser.</p></li>
   <li><p>Write the form data stream to the client web browser </p>
    <ul>
     <li><p>Create a <span class="code">com.adobe.idp.Document</span> object by invoking the <span class="code">FormsResult</span> object ‘s <span class="code">getOutputContent</span> method.</p></li>
     <li><p>Get the content type of the <span class="code">com.adobe.idp.Document</span> object by invoking its <span class="code">getContentType</span> method.</p></li>
     <li><p>Set the <span class="code">javax.servlet.http.HttpServletResponse</span> object’s content type by invoking its <span class="code">setContentType</span> method and passing the content type of the <span class="code">com.adobe.idp.Document</span> object.</p></li>
     <li><p>Create a <span class="code">javax.servlet.ServletOutputStream</span> object used to write the form data stream to the client web browser by invoking the <span class="code">javax.servlet.http.HttpServletResponse</span> object’s <span class="code">getOutputStream</span> method.</p></li>
     <li><p>Create a <span class="code">java.io.InputStream</span> object by invoking the <span class="code">com.adobe.idp.Document</span> object’s <span class="code">getInputStream</span> method.</p></li>
     <li><p>Create a byte array populate it with the form data stream by invoking the <span class="code">InputStream</span> object’s <span class="code">read </span>method and passing the byte array as an argument. </p></li>
     <li><p>Invoke the <span class="code">javax.servlet.ServletOutputStream</span> object’s <span class="code">write</span> method to send the form data stream to the client web browser. Pass the byte array to the <span class="code">write</span> method.</p></li>
    </ul></li>
  </ol>
  <p><strong>See also</strong></p>
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms rendering-forms-based-fragments-rendering#rendering_forms_based_on_fragments">Rendering Forms Based on Fragments</a></p>
  <p><a href="#unresolvedlink-lc-qs-forms-fo.xml#ws624e3cba99b79e12e69a9941333732bac8-7e3c.2">Quick Start (SOAP mode): Rendering a form based on fragments using the Java API</a></p>
  <p><a href="#unresolvedlink-lc-in-invoke-using-java-iu.xml#ws624e3cba99b79e12e69a9941333732bac8-7b4b.2">Including AEM Forms Java library files</a></p>
  <p><a href="#unresolvedlink-lc-in-invoke-using-java-iu.xml#ws624e3cba99b79e12e69a9941333732bac8-7fd6.2">Setting connection properties</a></p>
  <h3 id="render_forms_based_on_fragments_using_the_web_service_api">Render forms based on fragments using the web service API</h3>
  <p></p>
  <p>Render a form based on fragments using the Forms API (web service):</p>
  <ol>
   <li><p>Include project files </p>
    <ul>
     <li><p>Create Java proxy classes that consume the Forms service WSDL. </p></li>
     <li><p>Include the Java proxy classes into your class path. </p></li>
    </ul></li>
   <li><p>Create a Forms Client API object </p><p>Create a <span class="code">FormsService</span> object and set authentication values.</p></li>
   <li><p>Specify URI values </p>
    <ul>
     <li><p>Create a <span class="code">URLSpec</span> object that store URI values by using its constructor. </p></li>
     <li><p>Invoke the <span class="code">URLSpec</span> object’s <span class="code">setApplicationWebRoot</span> method and pass a string value that represents the application’s web root.</p></li>
     <li><p>Invoke the <span class="code">URLSpec</span> object’s <span class="code">setContentRootURI</span> method and pass a string value that specifies the content root URI value. Ensure that the form design is located in the content root URI. If not, the Forms service throws an exception. To reference the repository, specify <span class="code">repository://</span>.</p></li>
     <li><p>Invoke the <span class="code">URLSpec</span> object’s <span class="code">setTargetURL</span> method and pass a string value that specifies the target URL value to where form data is posted. If you define the target URL in the form design, you can pass an empty string. You can also specify the URL to where a form is sent in order to perform calculations.</p></li>
    </ul></li>
   <li><p>Render the form </p><p>Invoke the <span class="code">FormsService</span> object’s <span class="code">renderPDFForm</span> method and pass the following values:</p>
    <ul>
     <li><p>A string value that specifies the form design name, including the file name extension. If you reference a form design that is part of a Forms application, ensure that you specify the complete path, such as <span class="code">Applications/FormsApplication/1.0/FormsFolder/Loan.xdp</span>.</p></li>
     <li><p>A <span class="code">BLOB</span> object that contains data to merge with the form. If you do not want to merge data, pass <span class="code">null</span>. </p></li>
     <li><p>A <span class="code">PDFFormRenderSpec</span> object that stores run-time options. Note that the tagged PDF option cannot be set if the input document is a PDF document. If the input file is an XDP file, the tagged PDF option can be set. </p></li>
     <li><p>A <span class="code">URLSpec</span> object that contains URI values required by the Forms service. </p></li>
     <li><p>A <span class="code">java.util.HashMap</span> object that stores file attachments. This is an optional parameter and you can specify <span class="code">null</span> if you do not want to attach files to the form.</p></li>
     <li><p>An empty <span class="code">com.adobe.idp.services.holders.BLOBHolder</span> object that is populated by the method. This parameter is used to store the rendered form. </p></li>
     <li><p>An empty <span class="code">javax.xml.rpc.holders.LongHolder</span> object that is populated by the method. This argument will store the number of pages in the form.</p></li>
     <li><p>An empty <span class="code">javax.xml.rpc.holders.StringHolder</span> object that is populated by the method. This argument will store the locale value.</p></li>
     <li><p>An empty <span class="code">com.adobe.idp.services.holders.FormsResultHolder</span> object that will contain the results of this operation.</p></li>
    </ul><p>The <span class="code">renderPDFForm</span> method populates the <span class="code">com.adobe.idp.services.holders.FormsResultHolder</span> object that is passed as the last argument value with a form data stream that must be written to the client web browser.</p></li>
   <li><p>Write the form data stream to the client web browser </p>
    <ul>
     <li><p>Create a <span class="code">FormResult</span> object by getting the value of the <span class="code">com.adobe.idp.services.holders.FormsResultHolder</span> object’s <span class="code">value</span> data member. </p></li>
     <li><p>Create a <span class="code">BLOB</span> object that contains form data by invoking the <span class="code">FormsResult</span> object’s <span class="code">getOutputContent</span> method. </p></li>
     <li><p>Get the content type of the <span class="code">BLOB</span> object by invoking its <span class="code">getContentType</span> method.</p></li>
     <li><p>Set the <span class="code">javax.servlet.http.HttpServletResponse</span> object’s content type by invoking its <span class="code">setContentType</span> method and passing the content type of the <span class="code">BLOB</span> object.</p></li>
     <li><p>Create a <span class="code">javax.servlet.ServletOutputStream</span> object used to write the form data stream to the client web browser by invoking the <span class="code">javax.servlet.http.HttpServletResponse</span> object’s <span class="code">getOutputStream</span> method.</p></li>
     <li><p>Create a byte array and populate it by invoking the <span class="code">BLOB</span> object’s <span class="code">getBinaryData</span> method. This task assigns the content of the <span class="code">FormsResult</span> object to the byte array. </p></li>
     <li><p>Invoke the <span class="code">javax.servlet.http.HttpServletResponse</span> object’s <span class="code">write</span> method to send the form data stream to the client web browser. Pass the byte array to the <span class="code">write</span> method.</p></li>
    </ul></li>
  </ol>
  <p><strong>See also</strong></p>
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms rendering-forms-based-fragments-rendering#rendering_forms_based_on_fragments">Rendering Forms Based on Fragments</a></p>
  <p><a href="#unresolvedlink-lc-qs-forms-fo.xml#ws624e3cba99b79e12e69a9941333732bac8-7e3b.2">Quick Start (Base64): Rendering a form based on fragments using the web service API</a></p>
  <p><a href="#unresolvedlink-lc-in-invoke-using-web-services-iu.xml#ws624e3cba99b79e12e69a9941333732bac8-7fca.2">Invoking AEM Forms using Base64 encoding</a></p>
 </body>
</html>