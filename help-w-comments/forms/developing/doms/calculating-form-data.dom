<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/FORMS" name="primaryProductTag" /> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="" name="jcr:primaryType" /> 
  <meta content="admin" name="lr_lastModifiedBy" /> 
  <meta content="not_checked" name="acrolinxStatus" /> 
  <meta content="light" name="heroGradient" /> 
  <meta content="video" name="pageLayout" /> 
  <meta content="Activate" name="cq:lastReplicationAction" /> 
  <meta content="2018-04-03T08:31:32.866-0400" name="cq:lastReplicated" /> 
  <meta content="50208f67-87df-463f-8de1-f59a939479e7" name="jcr:uuid" /> 
  <meta content="2017-10-03T06:52:10.137-0400" name="lastPublishExternalDate" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
  <meta content="false" name="doNotLocalize" /> 
  <meta content="2017-10-03T06:52:10.137-0400" name="publishExternalDate" /> 
  <meta content="head1_20111213" name="gep_conversion_script_version" /> 
  <meta content="AEMForms/6.1/ProgramLC/WS624e3cba99b79e12e69a9941333732bac8-7e22.2,AEMForms/6.1/ProgramLC/WS624e3cba99b79e122f982d5d1336a352f63-7fff.2,AEMForms/6.1/ProgramLC/WS624e3cba99b79e12e69a9941333732bac8-7990.2,AEMForms/6.1/ProgramLC/WS624e3cba99b79e12e69a9941333732bac8-798f.2" name="cq:gepId" /> 
  <meta content="true" name="jcr:isCheckedOut" /> 
  <meta content="content_type:reference;geptopics:SG_AEMFORMS/categories/rendering_forms;products:SG_EXPERIENCEMANAGER/6.4/FORMS;topic_tags:operations" name="cq:tags" /> 
  <meta content="2017-11-21T06:59:27.515-0500" name="cq:lastModified" /> 
  <meta content="khsingh@adobe.com" name="lr_lastReplicatedBy" /> 
  <meta content="cfe19f88-624a-44e6-87d0-f68f2339e8e9" name="jcr:predecessors" /> 
  <meta content="admin" name="contentOwner" /> 
  <meta content="2017-10-03T06:52:10.137-0400" name="firstPublishExternalDate" /> 
  <meta content="" name="jcr:baseVersion" /> 
  <meta content="carlino" name="cq:lastModifiedBy" /> 
  <meta content="Calculating Form Data" name="jcr:title" /> 
  <meta content="" name="jcr:versionHistory" /> 
  <meta content="2017-08-09T03:29:00.000-0400" name="topicBrowsingSortDate" /> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="admin" name="lr_creator" /> 
  <meta content="carlino" name="cq:lastReplicatedBy" /> 
  <meta content="2017-08-09T03:29:40.541-0400" name="lr_lastModified" /> 
  <meta content="audience:developing" name="primaryAudienceTag" /> 
  <meta content="left" name="sideColumn" /> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
  <meta content="2017-11-22T19:04:53.487-0500" name="jcr:created" /> 
  <meta content="2017-08-09T03:29:00.000-0400" name="sortDate" /> 
  <meta content="https://helpx.adobe.com/aem-forms/6-3/developing/calculating-form-data.html" name="publishExternalURL" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="mix:versionable" name="jcr:mixinTypes" /> 
  <meta content="Calculating Form Data Calculating Form Data Calculating Form Data" name="navTitle" /> 
 </head> 
 <body> 
  <p>The Forms service can calculate the values that a user enters into a form and display the results. To calculate form data, you must perform two tasks. First, you create a form design script that calculates form data. A form design supports three types of scripts. One script type runs on the client, another runs on the server, and the third type runs on both the server and the client. The script type discussed in this topic runs on the server. Server-side calculations are supported for HTML, PDF, and form Guide (deprecated) transformations.</p> 
  <p>As part of the form design process, you can make use of calculations and scripts to provide a richer user experience. Calculations and scripts can be added to most form fields and objects. You must create a form design script to perform calculation operations on data that a user enters into an interactive form. </p> 
  <p>The user enters values into the form and clicks the Calculate button to view the results. The following process describes an example application that enables a user to calculate data: </p> 
  <ul> 
   <li><p>The user accesses an HTML page named StartLoan.html that acts as the web application’s start page. This page invokes a Java Servlet named <span class="code">GetLoanForm</span>.</p></li> 
   <li><p>The <span class="code">GetLoanForm</span> servlet renders a loan form. This form contains a script, interactive fields, a calculate button, and a submit button.</p></li> 
   <li><p>The user enters values into the form’s fields and clicks the Calculate button. The form is sent to the <span class="code">CalculateData</span> Java Servlet where the script is executed. The form is sent back to the user with the calculation results displayed in the form.</p></li> 
   <li><p>The user continues entering and calculating values until a satisfactory result is displayed. When satisfied, the user clicks the Submit button to process the form. The form is sent to another Java Servlet named <span class="code">ProcessForm</span> that is responsible for retrieving submitted data. (See <a href="/programming-with-aem-forms/rendering-forms-rendering-forms handling-submitted-forms-handling-submitted#handling_submitted_forms">Handling Submitted Forms</a>.)</p></li> 
  </ul> 
  <p>The following diagram shows the application’s logic flow.</p> 
  <img alt="" src="assets/cf_cf_finsrv_loancalcapp_v1.png" /> 
  <p>The following table describes the steps in this diagram.</p> 
  <table cellpadding="4" cellspacing="0"> 
   <thead align="left"> 
    <tr> 
     <th class="cellrowborder" id="d19e70561" valign="top" width="NaN%"><p>Step</p></th> 
     <th class="cellrowborder" id="d19e70564" valign="top" width="NaN%"><p>Description</p></th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <td class="cellrowborder" headers="d19e70561 " valign="top" width="NaN%"><p>1</p></td> 
     <td class="cellrowborder" headers="d19e70564 " valign="top" width="NaN%"><p>The <span class="code">GetLoanForm</span> Java Servlet is invoked from the HTML start page. </p></td> 
    </tr> 
    <tr> 
     <td class="cellrowborder" headers="d19e70561 " valign="top" width="NaN%"><p>2</p></td> 
     <td class="cellrowborder" headers="d19e70564 " valign="top" width="NaN%"><p>The <span class="code">GetLoanForm</span> Java Servlet uses the Forms service Client API to render the loan form to the client web browser. The difference between rendering a form that contains a script configured to run on the server and rendering a form that does not contain a script is that you must specify the target location used to execute the script. If a target location is not specified, a script that is configured to run on the server is not executed. For example, consider the application introduced in this section. The <span class="code">CalculateData</span> Java Servlet is the target location where the script is executed.</p></td> 
    </tr> 
    <tr> 
     <td class="cellrowborder" headers="d19e70561 " valign="top" width="NaN%"><p>3</p></td> 
     <td class="cellrowborder" headers="d19e70564 " valign="top" width="NaN%"><p>The user enters data into interactive fields and clicks the Calculate button. The form is sent to the <span class="code">CalculateData</span> Java Servlet, where the script is executed. </p></td> 
    </tr> 
    <tr> 
     <td class="cellrowborder" headers="d19e70561 " valign="top" width="NaN%"><p>4</p></td> 
     <td class="cellrowborder" headers="d19e70564 " valign="top" width="NaN%"><p>The form is rendered back to the web browser with the calculation results displayed in the form. </p></td> 
    </tr> 
    <tr> 
     <td class="cellrowborder" headers="d19e70561 " valign="top" width="NaN%"><p>5</p></td> 
     <td class="cellrowborder" headers="d19e70564 " valign="top" width="NaN%"><p>The user clicks the Submit button when the values are satisfactory. The form is sent to another Java Servlet named <span class="code">ProcessForm</span>.</p></td> 
    </tr> 
   </tbody> 
  </table> 
  <p>Typically, a form that is submitted as PDF content contains scripts that are executed on the client. However, server-side calculations can also be executed. A Submit button cannot be used to calculate scripts. In this situation, calculations are not executed because the Forms service considers the interaction to be complete.</p> 
  <p>To illustrate the usage of a form design script, this section examines a simple interactive form that contains a script that is configured to run on the server. The following diagram shows a form design containing a script that adds values that a user enters into the first two fields and displays the result in the third field.</p> 
  <img alt="" src="assets/cf_cf_caldata.png" /> 
  <p><strong>A.</strong> A field named NumericField1 <strong>B.</strong> A field named NumericField2 <strong>C.</strong> A field named NumericField3</p> 
  <p>The syntax of the script located in this form design is as follows:</p> 
  <codeblock gutter="true" class="syntax as3">
     &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;NumericField3&amp;nbsp;=&amp;nbsp;NumericField2&amp;nbsp;+&amp;nbsp;NumericField1 
  </codeblock> 
  <p>In this form design, the Calculate button is a command button, and the script is located in this button’s <span class="code">Click</span> event. When a user enters values into the first two fields (NumericField1 and NumericField2) and clicks the Calculate button, the form is sent to the Forms service, where the script is executed. The Forms service renders the form back to the client device with the results of the calculation displayed in the NumericField3 field. </p> 
  <note> 
   <p>For information about creating a form design script, see <a href="http://www.adobe.com/go/learn_aemforms_designer_63">Forms Designer</a>.</p> 
  </note> 
  <note> 
   <p>For more information about the Forms service, see<a href="http://www.adobe.com/go/learn_aemforms_services_63"> Services Reference for AEM Forms</a>.</p> 
  </note> 
  <h2 id="summary_of_steps">Summary of steps</h2> 
  <p></p> 
  <p>To calculate form data, perform the following tasks:</p> 
  <ol> 
   <li><p>Include project files.</p></li> 
   <li><p>Create a Forms Client API object.</p></li> 
   <li><p>Retrieve a form containing a calculation script.</p></li> 
   <li><p>Write the form data stream back to the client web browser</p></li> 
  </ol> 
  <p><strong>Include project files</strong></p> 
  <p>Include necessary files into your development project. If you are creating a client application using Java, include the necessary JAR files. If you are using web services, ensure that you include the proxy files.</p> 
  <p><strong>Create a Forms Client API object</strong></p> 
  <p>Before you can programmatically perform a Forms service Client API operation, you must create a Forms service client. If you are using the Java API, create a <span class="code">FormsServiceClient</span> object. If you are using the Forms web service API, create a <span class="code">FormsServiceService</span> object. </p> 
  <p><strong>Retrieve a form containing a calculation script</strong></p> 
  <p>You use the Forms service Client API to create application logic that handles a form that contains a script configured to run on the server. The process is similar to handling a submitted form. (See <a href="/programming-with-aem-forms/rendering-forms-rendering-forms handling-submitted-forms-handling-submitted#handling_submitted_forms">Handling Submitted Forms</a>.) </p> 
  <p>Verify that the processing state associated with the submitted form is <span class="code">1</span><span class="code">(Calculate)</span>, which means that the Forms service is performing a calculation operation on the form data and the results must be written back to the user. In this situation, a script configured to run on the server is automatically executed.</p> 
  <p><strong>Write the form data stream back to the client web browser</strong></p> 
  <p>After you verify the processing state associated with a submitted form is <span class="code">1</span>, you must write the results back to the client web browser. When the form is displayed, the calculated value will appear in the appropriate field(s).</p> 
  <p><strong>See also</strong></p> 
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms calculating-form-data-calculating-form calculating-form-data-calculating-form#calculate_form_data_using_the_java_api">Calculate form data using the Java API</a></p> 
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms calculating-form-data-calculating-form calculating-form-data-calculating-form#calculate_form_data_using_the_web_service_api">Calculate form data using the web service API</a></p> 
  <p><a href="#unresolvedlink-lc-in-invoke-using-java-iu.xml#ws624e3cba99b79e12e69a9941333732bac8-7b4b.2">Including AEM Forms Java library files</a></p> 
  <p><a href="#unresolvedlink-lc-in-invoke-using-java-iu.xml#ws624e3cba99b79e12e69a9941333732bac8-7fd6.2">Setting connection properties</a></p> 
  <p><a href="#unresolvedlink-lc-qs-forms-fo.xml#ws624e3cba99b79e12e69a9941333732bac8-7af6.2">Forms Service API Quick Starts</a></p> 
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms rendering-interactive-pdf-forms-rendering#rendering_interactive_pdf_forms">Rendering Interactive PDF Forms</a></p> 
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms rendering-forms-html-rendering-forms rendering-forms-html-rendering-forms#rendering_forms_as_html">Rendering Forms as HTML</a></p> 
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms creating-web-applications-renders-forms#creating_web_applications_that_renders_forms">Creating Web Applications that Renders Forms</a></p> 
  <h2 id="calculate_form_data_using_the_java_api">Calculate form data using the Java API</h2> 
  <p></p> 
  <p>Calculate form data by using the Forms API (Java):</p> 
  <ol> 
   <li><p>Include project files </p><p>Include client JAR files, such as adobe-forms-client.jar in your Java project’s class path.</p></li> 
   <li><p>Create a Forms Client API object </p> 
    <ul> 
     <li><p>Create a <span class="code">ServiceClientFactory</span> object that contains connection properties. </p></li> 
     <li><p>Create an <span class="code">FormsServiceClient</span> object by using its constructor and passing the <span class="code">ServiceClientFactory</span> object. </p></li> 
    </ul></li> 
   <li><p>Retrieve a form containing a calculation script </p> 
    <ul> 
     <li><p>To retrieve form data that contains a calculation script, create a <span class="code">com.adobe.idp.Document</span> object by using its constructor and invoking the <span class="code">javax.servlet.http.HttpServletResponse</span> object’s <span class="code">getInputStream</span> method from within the constructor. </p></li> 
     <li><p>Invoke the <span class="code">FormsServiceClient</span> object’s <span class="code">processFormSubmission</span> method and pass the following values:</p> 
      <ul> 
       <li><p>The <span class="code">com.adobe.idp.Document</span> object that contains the form data. </p></li> 
       <li><p>A string value that specifies environment variables including all relevant HTTP headers. You must specify the content type to handle by specifying one or more values for the <span class="code">CONTENT_TYPE</span> environment variable. For example, to handle XML and PDF data, specify the following string value for this parameter: <span class="code">CONTENT_TYPE=application/xml&amp;CONTENT_TYPE=application/pdf</span></p></li> 
       <li><p>A string value that specifies the <span class="code">HTTP_USER_AGENT</span> header value; for example, <span class="code">Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)</span>.</p></li> 
       <li><p>A <span class="code">RenderOptionsSpec</span> object that stores run-time options. </p></li> 
      </ul><p>The <span class="code">processFormSubmission</span> method returns a <span class="code">FormsResult</span> object containing the results of the form submission.</p></li> 
     <li><p>Verify that the processing state associated with a submitted form is <span class="code">1</span> by invoking the <span class="code">FormsResult</span> object’s <span class="code">getAction</span> method. If this method returns the value <span class="code">1</span>, the calculation was performed and the data can be written back to the client web browser. </p></li> 
    </ul></li> 
   <li><p>Write the form data stream back to the client web browser </p> 
    <ul> 
     <li><p>Create a <span class="code">javax.servlet.ServletOutputStream</span> object used to send a form data stream to the client web browser. </p></li> 
     <li><p>Create a <span class="code">com.adobe.idp.Document</span> object by invoking the <span class="code">FormsResult</span> object ‘s <span class="code">getOutputContent</span> method. </p></li> 
     <li><p>Create a <span class="code">java.io.InputStream</span> object by invoking the <span class="code">com.adobe.idp.Document</span> object’s <span class="code">getInputStream</span> method. </p></li> 
     <li><p>Create a byte array and populate it with the form data stream by invoking the <span class="code">InputStream</span> object’s <span class="code">read</span> method and passing the byte array as an argument. </p></li> 
     <li><p>Invoke the <span class="code">javax.servlet.ServletOutputStream</span> object’s <span class="code">write</span> method to send the form data stream to the client web browser. Pass the byte array to the <span class="code">write</span> method. </p></li> 
    </ul></li> 
  </ol> 
  <p><strong>See also</strong></p> 
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms calculating-form-data-calculating-form calculating-form-data-calculating-form#calculating_form_data">Calculating Form Data</a></p> 
  <p><a href="#unresolvedlink-lc-qs-forms-fo.xml#ws624e3cba99b79e12e69a9941333732bac8-7e21.2">Quick Start (EJB mode): Handling a form containing a calculation script using the Java API</a></p> 
  <p><a href="#unresolvedlink-lc-in-invoke-using-java-iu.xml#ws624e3cba99b79e12e69a9941333732bac8-7b4b.2">Including AEM Forms Java library files</a></p> 
  <p><a href="#unresolvedlink-lc-in-invoke-using-java-iu.xml#ws624e3cba99b79e12e69a9941333732bac8-7fd6.2">Setting connection properties</a></p> 
  <h2 id="calculate_form_data_using_the_web_service_api">Calculate form data using the web service API</h2> 
  <p></p> 
  <p>Calculate form data by using the Forms API (web service):</p> 
  <ol> 
   <li><p>Include project files </p> 
    <ul> 
     <li><p>Create Java proxy classes that consume the Forms service WSDL.</p></li> 
     <li><p>Include the Java proxy classes into your class path. </p></li> 
    </ul></li> 
   <li><p>Create a Forms Client API object </p><p>Create a <span class="code">FormsService</span> object and set authentication values.</p></li> 
   <li><p>Retrieve a form containing a calculation script </p> 
    <ul> 
     <li><p>To retrieve form data that was posted to a Java Servlet, create a <span class="code">BLOB</span> object by using its constructor. </p></li> 
     <li><p>Create a <span class="code">java.io.InputStream</span> object by using the <span class="code">javax.servlet.http.HttpServletResponse</span> object’s <span class="code">getInputStream</span> method.</p></li> 
     <li><p>Create a <span class="code">java.io.ByteArrayOutputStream</span> object by using its constructor and passing the length of the <span class="code">java.io.InputStream</span> object.</p></li> 
     <li><p>Copy the contents of the <span class="code">java.io.InputStream</span> object into the <span class="code">java.io.ByteArrayOutputStream</span> object.</p></li> 
     <li><p>Create a byte array by invoking the <span class="code">java.io.ByteArrayOutputStream</span> object’s <span class="code">toByteArray</span> method.</p></li> 
     <li><p>Populate the <span class="code">BLOB</span> object by invoking its <span class="code">setBinaryData</span> method and passing the byte array as an argument. </p></li> 
     <li><p>Create a <span class="code">RenderOptionsSpec</span> object by using its constructor. Set the locale value by invoking the <span class="code">RenderOptionsSpec</span> object’s <span class="code">setLocale</span> method and passing a string value that specifies the locale value.</p></li> 
     <li><p>Invoke the <span class="code">FormsServiceClient</span> object’s <span class="code">processFormSubmission</span> method and pass the following values:</p> 
      <ul> 
       <li><p>The <span class="code">BLOB</span> object that contains the form data. </p></li> 
       <li><p>A string value that specifies environment variables included all relevant HTTP headers. For example, you can specify the following string value: <span class="code">HTTP_REFERER=referrer&amp;HTTP_CONNECTION=keep-alive&amp;CONTENT_TYPE=application/xml</span></p></li> 
       <li><p>A string value that specifies the <span class="code">HTTP_USER_AGENT</span> header value; for example, <span class="code">Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322)</span>.</p></li> 
       <li><p>A <span class="code">RenderOptionsSpec</span> object that stores run-time options. For more information, .</p></li> 
       <li><p>An empty <span class="code">BLOBHolder</span> object that is populated by the method.</p></li> 
       <li><p>An empty <span class="code">javax.xml.rpc.holders.StringHolder</span> object that is populated by the method.</p></li> 
       <li><p>An empty <span class="code">BLOBHolder</span> object that is populated by the method.</p></li> 
       <li><p>An empty <span class="code">BLOBHolder</span> object that is populated by the method.</p></li> 
       <li><p>An empty <span class="code">javax.xml.rpc.holders.ShortHolder</span> object that is populated by the method.</p></li> 
       <li><p>An empty <span class="code">MyArrayOf_xsd_anyTypeHolder</span> object that is populated by the method. This parameter is used to store file attachments that are submitted along with the form. </p></li> 
       <li><p>An empty <span class="code">FormsResultHolder</span> object that is populated by the method with the form that is submitted.</p></li> 
      </ul><p>The <span class="code">processFormSubmission</span> method populates the <span class="code">FormsResultHolder</span> parameter with the results of the form submission. The <span class="code">processFormSubmission</span> method returns a <span class="code">FormsResult</span> object containing the results of the form submission.</p></li> 
     <li><p>Verify that the processing state associated with a submitted form is <span class="code">1</span> by invoking the <span class="code">FormsResult</span> object’s <span class="code">getAction</span> method. If this method returns the value <span class="code">1</span>, the calculation was performed and the data can be written back to the client web browser. </p></li> 
    </ul></li> 
   <li><p>Write the form data stream back to the client web browser </p> 
    <ul> 
     <li><p>Create a <span class="code">javax.servlet.ServletOutputStream</span> object used to send a form data stream to the client web browser. </p></li> 
     <li><p>Create a <span class="code">BLOB</span> object that contains form data by invoking the <span class="code">FormsResult</span> object’s <span class="code">getOutputContent</span> method. </p></li> 
     <li><p>Create a byte array and populate it by invoking the <span class="code">BLOB</span> object’s <span class="code">getBinaryData</span> method. This task assigns the content of the <span class="code">FormsResult</span> object to the byte array. </p></li> 
     <li><p>Invoke the <span class="code">javax.servlet.http.HttpServletResponse</span> object’s <span class="code">write</span> method to send the form data stream to the client web browser. Pass the byte array to the <span class="code">write</span> method. </p></li> 
    </ul></li> 
  </ol> 
  <p><strong>See also</strong></p> 
  <p><a href="/programming-with-aem-forms/rendering-forms-rendering-forms calculating-form-data-calculating-form calculating-form-data-calculating-form#calculating_form_data">Calculating Form Data</a></p> 
  <p><a href="#unresolvedlink-lc-qs-forms-fo.xml#ws624e3cba99b79e12e69a9941333732bac8-7e20.2">Quick Start (Base64): Handling a form containing a calculation script using web service API</a></p> 
  <p><a href="#unresolvedlink-lc-in-invoke-using-web-services-iu.xml#ws624e3cba99b79e12e69a9941333732bac8-7fca.2">Invoking AEM Forms using Base64 encoding</a></p> 
 </body> 
</html>