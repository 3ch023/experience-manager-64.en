<?xml version="1.1" encoding="UTF-8" standalone="yes"?> 
<html> 
 <head> 
  <meta content="carlino" name="cq:lastModifiedBy" /> 
  <meta content="mix:versionable" name="jcr:mixinTypes" /> 
  <meta content="2017-10-12T21:46:58.665-0400" name="mwpw_migration_script_version" /> 
  <meta content="" name="jcr:primaryType" /> 
  <meta content="2018-04-03T07:37:49.505-0400" name="lastPublishExternalDate" /> 
  <meta content="2018-05-17T05:49:17.483-0400" name="locHandOffDate" /> 
  <meta content="carlino" name="cq:lastReplicatedBy" /> 
  <meta content="" name="jcr:versionHistory" /> 
  <meta content="How to Setup MongoDB for Demo" name="seoTitle" /> 
  <meta content="/etc/designs/help" name="cq:designPath" /> 
  <meta content="false" name="isReadyForLocalization" /> 
  <meta content="2017-12-01T19:04:02.774-0500" name="jcr:created" /> 
  <meta content="b61edc4e-d0aa-4104-97f8-1142aa11b49e" name="jcr:predecessors" /> 
  <meta content="true" name="jcr:isCheckedOut" /> 
  <meta content="/content/docs/en/aem/6-3/administer/communities/srp/msrp/demo-mongo" name="qaNotes" /> 
  <meta content="How to Setup MongoDB for Demo" name="jcr:title" /> 
  <meta content="admin" name="jcr:createdBy" /> 
  <meta content="2017-10-31T16:33:52.467-0400" name="firstPublishExternalDate" /> 
  <meta content="Activate" name="cq:lastReplicationAction" /> 
  <meta content="2018-05-17T05:49:17.484-0400" name="cq:lastModified" /> 
  <meta content="How to Setup MongoDB for Demo" name="navTitle" /> 
  <meta content="/apps/help/templates/article-3" name="cq:template" /> 
  <meta content="" name="jcr:baseVersion" /> 
  <meta content="https://helpx.adobe.com/experience-manager/6-4/communities/using/demo-mongo.html" name="publishExternalURL" /> 
  <meta content="carlino@adobe.com" name="lr_lastReplicatedBy" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/COMMUNITIES" name="primaryProductTag" /> 
  <meta content="How to setup MSRP for one author instance and one publish instance" name="seoDescription" /> 
  <meta content="2017-10-12T21:46:58.665-0400" name="qaDate" /> 
  <meta content="products:SG_EXPERIENCEMANAGER/6.4/COMMUNITIES;topic_tags:administering;content_type:reference" name="cq:tags" /> 
  <meta content="2018-04-03T07:37:51.466-0400" name="cq:lastReplicated" /> 
  <meta content="en_us" name="jcr:language" /> 
  <meta content="2018-04-03T07:37:49.505-0400" name="topicBrowsingSortDate" /> 
  <meta content="help/components/pages/article-3" name="sling:resourceType" /> 
  <meta content="c5919637-15fb-4642-9074-10eb85d499ee" name="jcr:uuid" /> 
  <meta content="Janice Kendall" name="contentOwner" /> 
  <meta content="2018-04-03T07:37:49.505-0400" name="publishExternalDate" /> 
 </head> 
 <body> 
  <h2>Introduction</h2> 
  <p>This tutorial describes how to setup <a href="../../communities/using/msrp.md">MSRP</a> for<i> one author </i>instance and <i>one publish</i> instance.</p> 
  <p>With this setup, the community content is accessible from both author and publish environments without needing to forward or reverse replicate user generated content (UGC).</p> 
  <p>This configuration is suitable for<i> non-production</i> environments such as for development and/or demonstration.</p> 
  <p><strong>A <i>production </i>environment should :</strong></p> 
  <ul> 
   <li>run MongoDB with a replica set</li> 
   <li>use SolrCloud</li> 
   <li>contain multiple publisher instances</li> 
  </ul> 
  <h2>MongoDB</h2> 
  <h3>Install MongoDB</h3> 
  <ul> 
   <li>Download MongoDB from <a href="http://www.mongodb.org/">http://www.mongodb.org/</a> 
    <ul> 
     <li>choice of OS : 
      <ul> 
       <li>Linux</li> 
       <li>Mac 10.8</li> 
       <li>Windows 7</li> 
      </ul> </li> 
     <li>choice of version : 
      <ul> 
       <li>at a minimum, use version 2.6</li> 
      </ul> </li> 
    </ul> </li> 
   <li>Basic configuration 
    <ul> 
     <li>follow the MongoDB install instructions</li> 
     <li>configure for mongod 
      <ul> 
       <li>no need to configure mongos or sharding</li> 
      </ul> </li> 
     <li>the installed MongoDB folder will be referred to as &amp;lt;mongo-install&amp;gt;</li> 
     <li>the defined data directory path will be referred to as &amp;lt;mongo-dbpath&amp;gt;</li> 
    </ul> </li> 
   <li>MongoDB may run on same host as AEM or run remotely</li> 
  </ul> 
  <h3>Start MongoDB</h3> 
  <ul> 
   <li>&amp;lt;mongo-install&amp;gt;/bin/mongod --dbpath &amp;lt;mongo-dbpath&amp;gt;</li> 
  </ul> 
  <p>This will start a MongoDB server using default port 27017.</p> 
  <ul> 
   <li>For Mac, increase ulimit with start arg 'ulimit -n 2048'</li> 
  </ul> 
  <note> 
   <p>If MongoDB is started <i>after </i>AEM, <strong>restart </strong>all <strong>AEM </strong>instances so they properly connect to MongoDB.</p> 
  </note> 
  <h3>Demo Production Option : Setup MongoDB Replica Set</h3> 
  <p>The following commands are an example of setting up a replica set with 3 nodes on localhost:</p> 
  <ul> 
   <li>bin/mongod --port 27017 --dbpath data --replSet rs0&amp;</li> 
   <li>bin/mongo 
    <ul> 
     <li>cfg = {"_id" : "rs0","version" : 1,"members" : [{"_id" : 0,"host" : "127.0.0.1:27017"}]}</li> 
     <li>rs.initiate(cfg)</li> 
    </ul> </li> 
   <li>bin/mongod --port 27018 --dbpath data1 --replSet rs0&amp;</li> 
   <li>bin/mongod --port 27019 --dbpath data2 --replSet rs0&amp;</li> 
   <li>bin/mongo 
    <ul> 
     <li>rs.add("127.0.0.1:27018")<br /> </li> 
     <li>rs.add("127.0.0.1:27019")</li> 
     <li>rs.status()</li> 
    </ul> </li> 
  </ul> 
  <h2>Solr</h2> 
  <h3>Install Solr</h3> 
  <ul> 
   <li>Download Solr from <a href="http://archive.apache.org/dist/lucene/solr/">Apache Lucene</a> : 
    <ul> 
     <li>suitable for any OS 
      <download /></li> 
     <li>use version 4.10 or version 5</li> 
     <li>Solr requires Java 1.7 or greater</li> 
    </ul> </li> 
   <li>Basic configuration 
    <ul> 
     <li>follow 'example' Solr setup</li> 
     <li>no service is needed</li> 
     <li>the installed Solr folder will be referred to as &amp;lt;solr-install&amp;gt;</li> 
    </ul> </li> 
  </ul> 
  <h3>Configure Solr for AEM Communities</h3> 
  <p>To configure a Solr collection for MSRP for demo, there are two decisions to be made (select the links to main documentation for details) :</p> 
  <ol> 
   <li>run Solr in standalone or <a href="../../communities/using/msrp.md#solrcloudmode">SolrCloud mode</a></li> 
   <li>install <a href="../../communities/using/msrp.md#installingstandardmls">standard</a> or <a href="../../communities/using/msrp.md#installingadvancedmls">advanced</a> multilingual search (MLS)</li> 
  </ol> 
  <h3>Standalone Solr</h3> 
  <p>The method for running Solr may differ depending on the version and manner of installation. The <a href="http://archive.apache.org/dist/lucene/solr/ref-guide/">Solr reference guide</a> is the authoritative documentation.</p> 
  <p>For simplicity, using version 4.10 as an example, start Solr in standalone mode :</p> 
  <ul> 
   <li>cd to &amp;lt;solrinstall&amp;gt;/example</li> 
   <li>java -jar start.jar</li> 
  </ul> 
  <p>This will start a Solr HTTP server using default port 8983. You can browse to the Solr Console to get a Solr console for testing.</p> 
  <ul> 
   <li>default Solr console : <a href="http://localhost:8983/solr/">http://localhost:8983/solr/</a></li> 
  </ul> 
  <note> 
   <p>If Solr Console is not available, check the logs under &amp;lt;solrinstall&amp;gt;/example/logs. Look to see if SOLR is trying to bind to a specific hostname that cannot be resolved (e.g. "user-macbook-pro").</p> 
   <p>If so, update etc/hosts file with a new entry for this hostname (e.g 127.0.0.1 user-macbook-pro) and Solr will start properly. </p> 
  </note> 
  <h3>SolrCloud</h3> 
  <p>To run a very basic (not production) solrCloud setup, start solr with :</p> 
  <ul> 
   <li>java -Dbootstrap_confdir=./solr/collection1/conf -Dbootstrap_conf=true -DzkRun -jar start.jar</li> 
  </ul> 
  <h2>Identify MongoDB as Common Store</h2> 
  <p>Launch the author and publish AEM instances, if necessary. </p> 
  <p>If AEM was running before MongoDB was started, then the AEM instances will need to be restarted.</p> 
  <p>Follow the instructions on the main documentation page : <a href="../../communities/using/msrp.md">MSRP - MongoDB Common Store</a></p> 
  <h2>Test</h2> 
  <p>To test and verify the MongoDB common store, post a comment on the publish instance and view it on the author instance, as well as view the UGC in MongoDB and Solr :</p> 
  <ol> 
   <li><p>on the publish instance, browse to the <a href="http://localhost:4503/content/community-components/en/comments.html">Community Components Guide</a> page and select the Comments component.</p> </li> 
   <li><p>sign in to post a comment :</p> </li> 
   <li><p>enter text in the comment text entry box and click <strong>Post</strong></p> <img imageRotate="0" src="assets/chlimage_1-198.png" /></li> 
   <li><p>Simply view the comment on the <a href="http://localhost:4502/content/community-components/en/comments.html">author instance</a> (likely still signed in as admin / admin).</p> <img imageRotate="0" src="assets/chlimage_1-199.png" /><p>Note : while there are JCR nodes under the <i>asipath </i>on author, these are for the SCF framework. The actual UGC is not in JCR, it is in the MongoDB.</p> </li> 
   <li><p>view the UGC in mongodb (communities &amp;gt; Collections &amp;gt; content)</p> <img imageRotate="0" src="assets/chlimage_1-200.png" /></li> 
   <li><p style="font-family: tahoma, arial, helvetica, sans-serif; font-size: 11.9999990463257px;">view the UGC in Solr :</p> 
    <ul style="font-family: tahoma, arial, helvetica, sans-serif; font-size: 11.9999990463257px;"> 
     <li>browse to Solr dashboard : <a href="http://localhost:8983/solr/">http://localhost:8983/solr/</a></li> 
     <li>user 'core selector' to select 'collection1'</li> 
     <li>select <span class="code">Query</span></li> 
     <li>select <span class="code">Execute Query</span></li> 
    </ul> <img imageRotate="0" src="assets/chlimage_1-201.png" /></li> 
  </ol> 
  <h2>Troubleshooting</h2> 
  <h3>No UGC Appears</h3> 
  <p>1) Make sure MongoDB is installed and running properly.</p> 
  <p>2) Make sure MSRP has been configured to be the default provider :</p> 
  <ul> 
   <li>On all author and publish AEM instances, revisit the <a href="../../communities/using/srp-config.md">Storage Configuration console</a><br /> or check the AEM repository : 
    <ul> 
     <li>in JCR, if <a href="http://localhost:4502/crx/de/index.jsp#/etc/socialconfig/">/etc/socialconfig</a> 
      <ul> 
       <li>does not contain an <a href="http://localhost:4502/crx/de/index.jsp#/etc/socialconfig/srpc">srpc</a> node, it means the storage provider is JSRP</li> 
       <li>if the srpc node exists and contains node <a href="http://localhost:4502/crx/de/index.jsp#/etc/socialconfig/srpc/defaultconfiguration">defaultconfiguration</a>, the defaultconfiguration's properties should define MSRP to be the default provider</li> 
      </ul> </li> 
    </ul> </li> 
  </ul> 
  <p>3) Make sure AEM was restarted after MSRP selected.</p> 
  <draft-comment type="draft"> 
   <h3>Reset</h3> 
  </draft-comment> 
  <draft-comment type="draft"> 
   <codeblock class="syntax shell">
     #&amp;nbsp;drop&amp;nbsp;Mongo&amp;nbsp;DB!!discoiqbr!!mongo&amp;nbsp;cq&amp;nbsp;--eval&amp;nbsp;"db.dropDatabase()"!!discoiqbr!!!!discoiqbr!!#&amp;nbsp;clear&amp;nbsp;Solr&amp;nbsp;index!!discoiqbr!!curl&amp;nbsp;http://localhost:8983/solr/update&amp;nbsp;-H&amp;nbsp;"Content-type:&amp;nbsp;text/xml"&amp;nbsp;--data-binary&amp;nbsp;"&lt;delete&gt;&lt;query&gt;*:*&lt;/query&gt;&lt;/delete&gt;"!!discoiqbr!!curl&amp;nbsp;http://localhost:8983/solr/update&amp;nbsp;-H&amp;nbsp;"Content-type:&amp;nbsp;text/xml"&amp;nbsp;--data-binary&amp;nbsp;&amp;nbsp;"&lt;commit&amp;nbsp;/&gt;"!!discoiqbr!!!!discoiqbr!!#&amp;nbsp;restart&amp;nbsp;AEM 
   </codeblock> 
  </draft-comment> 
 </body> 
</html>